function CanvasOverlay(e,n){for(this.top=0,this.left=0,this.width=e.width,this.height=e.height;window&&(this.width>window.innerWidth||this.height>window.innerHeight);)this.width/=2,this.height/=2;this.image_=e,this.map_=n,this.div_=null,this.canvas=null,this.ctx=null,this.angle=0,this.scale=1,this.latlng=n.getCenter(),this.new_left=0,this.new_top=0,this.setMap(n)}function deg2rad(e){return e*Math.PI/180}function rad2deg(e){return e/Math.PI*180}function getRotationDegrees(e){var n=e.css("-webkit-transform")||e.css("-moz-transform")||e.css("-ms-transform")||e.css("-o-transform")||e.css("transform");if("none"!==n)var i=n.split("(")[1].split(")")[0].split(","),o=i[0],t=i[1],a=(i[2],i[3],Math.sqrt(o*o+t*t),Math.round(Math.atan2(t,o)*(180/Math.PI)));else a=0;return a}(app=angular.module("anyArchitect",["ngCookies","angularjs-dropdown-multiselect","ui.bootstrap","ui.select","ngSanitize"])).service("GMapService",function(){this.gmap={};var n=this,e=document.getElementById("map-canvas");function i(e){this.tileSize=e}function o(e){this.tileSize=e}i.prototype.maxZoom=22,i.prototype.name="OSM",i.prototype.alt="Tile OSM Map Type",i.prototype.getTile=function(e,n,i){if(19<n)return null;var o=1<<n,t=e.x%o;t<0&&(t=o+t);var a=i.createElement("img");return a.src="http://tile.openstreetmap.org/"+n+"/"+t+"/"+e.y+".png",a.style.width=this.tileSize.width+"px",a.style.height=this.tileSize.height+"px",a},o.prototype.maxZoom=22,o.prototype.name="Carto Light",o.prototype.alt="Tile Carto Light Map Type",o.prototype.getTile=function(e,n,i){var o="https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png";o=o.replace("{x}",e.x).replace("{y}",e.y).replace("{z}",n);var t=i.createElement("img");return t.src=o,t.style.width=this.tileSize.width+"px",t.style.height=this.tileSize.height+"px",t};var t="OSM";"undefined"!=typeof Storage&&localStorage&&(localStorage.getItem("mapTypeId")?t=localStorage.getItem("mapTypeId"):localStorage.setItem("mapTypeId","OSM")),n.gmap=new google.maps.Map(e,{center:new google.maps.LatLng(57,21),zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!0,streetViewControl:!1,overviewMapControl:!0,zoom:3,mapTypeId:t,mapTypeControlOptions:{mapTypeIds:["OSM","CartoLight","roadmap","satellite"],style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.LEFT_CENTER}}),n.gmap.addListener("maptypeid_changed",function(){var e="roadmap"===n.gmap.getMapTypeId()||"satellite"===n.gmap.getMapTypeId();localStorage.setItem("mapTypeId",n.gmap.getMapTypeId()),n.gmap.setOptions({streetViewControl:e})}),n.gmap.mapTypes.set("OSM",new i(new google.maps.Size(256,256))),n.gmap.mapTypes.set("CartoLight",new o(new google.maps.Size(256,256)));var a=document.getElementById("pac-input");n.gmap.controls[google.maps.ControlPosition.TOP_LEFT].push(a),n.searchBox=new google.maps.places.SearchBox(a),google.maps.event.addListener(n.searchBox,"places_changed",function(){var e=n.searchBox.getPlaces();0!=e.length&&(n.gmap.panTo(e[0].geometry.location),n.gmap.setZoom(17))}),n.gmap.addListener(n.gmap,"bounds_changed",function(){var e=n.gmap.getBounds();n.searchBox.setBounds(e)})}),app.factory("AnyplaceService",function(){var e={selectedBuilding:void 0,selectedFloor:void 0,selectedPoi:void 0,selectedCampus:void 0,ShowShareProp:void 0,progress:void 0,allPois:{},allConnections:{},radioHeatmapRSSMode:!1,fingerPrintsTimeMode:!1,radioHeatmapRSSTimeMode:!1,alerts:[],jsonReq:{username:"username",password:"password"},BASE_URL:"https://ap.cs.ucy.ac.cy",getBuilding:function(){return this.selectedBuilding},getCampus:function(){return this.selectedCampus},getBuildingId:function(){if(this.selectedBuilding)return this.selectedBuilding.buid},getBuildingName:function(){return this.selectedBuilding?this.selectedBuilding.name:"N/A"},getCampusName:function(){return this.selectedCampus?this.selectedCampus.name:"N/A"},getFloor:function(){return this.selectedFloor},getFloorNumber:function(){return this.selectedFloor?String(this.selectedFloor.floor_number):"N/A"},getFloorName:function(){return this.selectedFloor.floor_name},setBuilding:function(e){this.selectedBuilding=e},setFloor:function(e){this.selectedFloor=e},addAlert:function(e,n){this.alerts[0]={msg:n,type:e}},closeAlert:function(e){this.alerts.splice(e,1)},getBuildingViewerUrl:function(){return this.selectedBuilding&&this.selectedBuilding.buid?this.selectedBuilding.buid:"N/A"},getBuildingViewerUrlEncoded:function(){return this.selectedBuilding&&this.selectedBuilding.buid?encodeURIComponent("https://ap.cs.ucy.ac.cy/viewer/?buid="+this.selectedBuilding.buid):"N/A"},getCampusViewerUrl:function(){return this.selectedCampus&&this.selectedCampus.cuid?"https://ap.cs.ucy.ac.cy/viewer/?cuid="+this.selectedCampus.cuid:"N/A"},getCampusViewerUrlEncoded:function(){return this.selectedCampus&&this.selectedCampus.cuid?encodeURIComponent("https://ap.cs.ucy.ac.cy/viewer/?cuid="+this.selectedCampus.cuid):"N/A"},setAllPois:function(e){this.allPois={},this.allPois=e},setAllConnection:function(e){this.allConnections={},this.allConnections=e},getAllPois:function(){return this.allPois?this.allPois:"N/A"},getAllConnections:function(){return this.allConnections?this.allConnections:"N/A"},clearAllData:function(){e.selectedPoi=void 0,e.selectedFloor=void 0,e.selectedBuilding=void 0,e.selectedCampus=void 0,e.ShowShareProp=void 0,e.allPois={},e.allConnections={}}};return e}),app.factory("Alerter",function(){var e={AlertCtrl:"-"};return e}),app.factory("formDataObject",function(){return function(e,n){var i=new FormData;return angular.forEach(e,function(e,n){i.append(n,e)}),delete n()["Content-Type"],i}}),app.config(["$locationProvider",function(e){e.html5Mode(!0)}]),app.filter("propsFilter",function(){return function(e,r){var l=[];return angular.isArray(e)?e.forEach(function(e){for(var n=!1,i=Object.keys(r),o=0;o<i.length;o++){var t=i[o],a=r[t].toLowerCase();if(-1!==e[t].toString().toLowerCase().indexOf(a)){n=!0;break}}n&&l.push(e)}):l=e,l}}),app.factory("myInterceptor",[function(){return{request:function(e){return void 0!==e.url&&0!==e.url.indexOf(AnyplaceAPI.FULL_SERVER)||e.data&&(e.data.access_token=app.access_token),e}}}]),app.config(["$httpProvider",function(e){e.interceptors.push("myInterceptor")}]),(AnyplaceAPI={}).FULL_SERVER="http://localhost:9000/anyplace",AnyplaceAPI.Mapping={},AnyplaceAPI.Mapping.RADIO_HEATMAP="/mapping/radio/heatmap_building_floor",AnyplaceAPI.Mapping.RADIO_HEATMAP_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS="/mapping/radio/heatmap_building_floor_avarage",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_1="/position/radio/heatmap_building_floor_average_1",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_1=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_1,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_2="/position/radio/heatmap_building_floor_average_2",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_2=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_2,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_3="/position/radio/heatmap_building_floor_average_3",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_3=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_3,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_3_TILES="/position/radio/heatmap_building_floor_average_3_tiles",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_3_TILES=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_3_TILES,AnyplaceAPI.Mapping.APs="/position/radio/APs_building_floor",AnyplaceAPI.Mapping.APs_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.APs,AnyplaceAPI.Mapping.FINGERPRINTS_DELETE="/position/radio/delete",AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FINGERPRINTS_DELETE,AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_TIME="/position/radio/delete/time",AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_TIME_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_TIME,AnyplaceAPI.Mapping.GET_APS_IDS="/position/radio/aps_ids",AnyplaceAPI.Mapping.GET_APS_IDS_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.GET_APS_IDS,AnyplaceAPI.Mapping.FINGERPRINTS_TIME="/position/radio/time",AnyplaceAPI.Mapping.FINGERPRINTS_TIME_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FINGERPRINTS_TIME,AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME="/position/radio/heatmap_building_floor_timestamp",AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME,AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_TILES="/position/radio/heatmap_building_floor_timestamp_tiles",AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_TILES_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_TILES,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_1="/position/radio/heatmap_building_floor_timestamp_average_1",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_1=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_1,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_2="/position/radio/heatmap_building_floor_timestamp_average_2",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_2=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_2,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_3="/position/radio/heatmap_building_floor_timestamp_average_3",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_3=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_3,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES="/position/radio/acces",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES,AnyplaceAPI.Mapping.RADIO_HEATMAP_POI="/mapping/radio/radio_heatmap_bbox",AnyplaceAPI.Mapping.RADIO_HEATMAP_URL_POI=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_POI,AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL="/position/radio_by_building_floor_all",AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL,AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT="/position/radio_by_building_floor_all_text",AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT,AnyplaceAPI.Mapping.BUILDING_ADD="/mapping/building/add",AnyplaceAPI.Mapping.BUILDING_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDING_ADD,AnyplaceAPI.Mapping.SHIP_ADD="/mapping/ship/add",AnyplaceAPI.Mapping.SHIP_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.SHIP_ADD,AnyplaceAPI.Mapping.CAMPUS_ALL="/mapping/campus/all_owner",AnyplaceAPI.Mapping.CAMPUS_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CAMPUS_ALL,AnyplaceAPI.Mapping.CAMPUS_UPDATE="/mapping/campus/update",AnyplaceAPI.Mapping.CAMPUS_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CAMPUS_UPDATE,AnyplaceAPI.Mapping.CAMPUS_DELETE="/mapping/campus/delete",AnyplaceAPI.Mapping.CAMPUS_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CAMPUS_DELETE,AnyplaceAPI.Mapping.BUILDINGSET_ADD="/mapping/campus/add",AnyplaceAPI.Mapping.BUILDINGSET_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDINGSET_ADD,AnyplaceAPI.Mapping.POISCATEGORY_ADD="/mapping/pois/add_category",AnyplaceAPI.Mapping.POISCATEGORY_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POISCATEGORY_ADD,AnyplaceAPI.Mapping.BUILDING_UPDATE="/mapping/building/update",AnyplaceAPI.Mapping.BUILDING_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDING_UPDATE,AnyplaceAPI.Mapping.RADIOMAP_DELETE="/position/radio/heatmap_building_floor_delete",AnyplaceAPI.Mapping.RADIOMAP_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIOMAP_DELETE,AnyplaceAPI.Mapping.BUILDING_ALL="/mapping/building/all_owner",AnyplaceAPI.Mapping.BUILDING_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDING_ALL,AnyplaceAPI.Mapping.FLOOR_ADD="/mapping/floor/add",AnyplaceAPI.Mapping.FLOOR_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_ADD,AnyplaceAPI.Mapping.FLOOR_UPDATE="/mapping/floor/update",AnyplaceAPI.Mapping.FLOOR_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_UPDATE,AnyplaceAPI.Mapping.FLOOR_DELETE="/mapping/floor/delete",AnyplaceAPI.Mapping.FLOOR_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_DELETE,AnyplaceAPI.Mapping.FLOOR_ALL="/mapping/floor/all",AnyplaceAPI.Mapping.FLOOR_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_ALL,AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD="/mapping/floor/uploadWithZoom",AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD,AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD="/floorplans64/",AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD,AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_ALL="/floorplans64all/",AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL_ALL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_ALL,AnyplaceAPI.Mapping.POIS_ADD="/mapping/pois/add",AnyplaceAPI.Mapping.POIS_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_ADD,AnyplaceAPI.Mapping.POIS_UPDATE="/mapping/pois/update",AnyplaceAPI.Mapping.POIS_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_UPDATE,AnyplaceAPI.Mapping.POIS_DELETE="/mapping/pois/delete",AnyplaceAPI.Mapping.POIS_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_DELETE,AnyplaceAPI.Mapping.POIS_ALL_FLOOR="/mapping/pois/all_floor",AnyplaceAPI.Mapping.POIS_ALL_FLOOR_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_ALL_FLOOR,AnyplaceAPI.Mapping.POIS_ALL_BUILDING="/mapping/pois/all_building",AnyplaceAPI.Mapping.POIS_ALL_BUILDING_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_ALL_BUILDING,AnyplaceAPI.Mapping.POIS_TYPES="/mapping/pois/types",AnyplaceAPI.Mapping.POIS_TYPES_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_TYPES,AnyplaceAPI.Mapping.CONNECTION_ADD="/mapping/connection/add",AnyplaceAPI.Mapping.CONNECTION_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_ADD,AnyplaceAPI.Mapping.CONNECTION_UPDATE="/mapping/connection/update",AnyplaceAPI.Mapping.CONNECTION_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_UPDATE,AnyplaceAPI.Mapping.CONNECTION_DELETE="/mapping/connection/delete",AnyplaceAPI.Mapping.CONNECTION_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_DELETE,AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR="/mapping/connection/all_floor",AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR,AnyplaceAPI.Mapping.SIGN="/mapping/accounts/sign",AnyplaceAPI.Mapping.SIGN_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.SIGN,app.factory("AnyplaceAPIService",["$http","$q","formDataObject",function(l,e,i){l.defaults.useXDomain=!0,delete l.defaults.headers.common["X-Requested-With"];var n={getRadioHeatmap:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSS:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSS_1:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_1,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSS_2:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_2,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSS_3:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_3,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSS_3_Tiles:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_3_TILES,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSSByTime_1:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_1,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSSByTime_2:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_2,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSSByTime_3:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_3,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSSByTime:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSSByTime_Tiles:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_TILES_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getAPs:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.APs_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getAPsIds:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.GET_APS_IDS_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteFingerprints:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteFingerprintsByTime:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_TIME_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getFingerprintsTime:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FINGERPRINTS_TIME_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getHeatmapAcces:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},retrievePoisTypes:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_TYPES_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},retrievePoisByBuilding:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_ALL_BUILDING_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapPoi:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_URL_POI,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioByBuildingFloorAll:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioByBuildingFloorTxt:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addBuilding:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addShip:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.SHIP_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addBuildingSet:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.BUILDINGSET_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addCategory:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POISCATEGORY_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},updateBuilding:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_UPDATE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},updateCampus:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CAMPUS_UPDATE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteBuilding:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteRadiomaps:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIOMAP_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteCampus:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CAMPUS_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},allBuildings:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_ALL_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},allCampus:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CAMPUS_ALL_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addFloor:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},updateFloor:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_UPDATE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteFloor:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},allBuildingFloors:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_ALL_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},uploadFloorPlan:function(e,n){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD_URL,headers:{"Content-Type":"multipart/form-data"},data:{floorplan:n,json:e},transformRequest:i}).success(function(e,n){return e}).error(function(e,n){return e})},uploadFloorPlan64:function(e,n){var i=n.replace("data:image/png;base64,",""),o=LPUtils.Base64Binary.decode(i),t=new Blob([o]);i="";for(var a=0;a<o.length;a++)i+=o[a];var r=new FormData;return r.append("json",e),r.append("floorplan",t),l.post(AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD_URL,r,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e,n){return e}).error(function(e,n){return e})},downloadFloorPlan:function(e,n,i){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL+n+"/"+i,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},downloadFloorPlanAll:function(e,n,i){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL_ALL+n+"/"+i,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getShipPosition:function(){return l({method:"GET",url:"services.marinetraffic.com/api/exportvessel/v:5/78e2e7fd31c8707894aca549b06823598368d250/timespan:20/protocol:jsono/mmsi:310627000"}).success(function(e,n){return e}).error(function(e,n){return e})},addPois:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},updatePois:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_UPDATE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deletePois:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},retrievePoisByBuildingFloor:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_ALL_FLOOR_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addConnection:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},updateConnection:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_UPDATE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteConnection:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},retrieveConnectionsByBuildingFloor:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},signAccount:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.SIGN_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})}};return n}]),CanvasOverlay.prototype=new google.maps.OverlayView,CanvasOverlay.prototype.onAdd=function(){var t,e=document.createElement("div");if(e.id="canvas_editor",e.style.border="none",e.style.borderWidth="0px",e.style.position="relative",e.style.top=this.top,e.style.left=this.left,null!=(t=this.getProjection())){var n=t.fromLatLngToDivPixel(this.latlng);e.style.top=n.y-this.height/2+"px",e.style.left=n.x-this.width/2+"px"}var a=this;function r(e){return parseInt(e,10)||0}function L(e){return isNaN(parseFloat(e))?0:parseFloat(e)}function O(e){return Math.round(100*(e+1e-5))/100}jQuery.getCorrection=function(e,n,i,o,t){t=t*Math.PI/180;var a,r=-e/2,l=(a=n/2)*Math.sin(t)+r*Math.cos(t)-r,s=a*Math.cos(t)-r*Math.sin(t)-a;r=-(e+i)/2;return{left:(a=(n+o)/2)*Math.sin(t)+r*Math.cos(t)-r-l,top:a*Math.cos(t)-r*Math.sin(t)-a-s}},jQuery.ui.resizable.prototype._mouseStart=function(e){var n,i,o,t=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),n=r(this.helper.css("left")),i=r(this.helper.css("top")),t.containment&&(n+=$(t.containment).scrollLeft()||0,i+=$(t.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:i},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:n,top:i},this.originalMousePosition={left:e.pageX,top:e.pageY},this.lastData=this.originalPosition,this.aspectRatio="number"==typeof t.aspectRatio?t.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=$(".ui-resizable-"+this.axis).css("cursor"),$("body").css("cursor","auto"===o?this.axis+"-resize":o),a.addClass("ui-resizable-resizing"),this._propagate("start",e),!0},jQuery.ui.resizable.prototype._mouseDrag=function(e){var n,i=function(e){var n=window.getComputedStyle(e,null),i=n.getPropertyValue("-webkit-transform")||n.getPropertyValue("-moz-transform")||n.getPropertyValue("-ms-transform")||n.getPropertyValue("-o-transform")||n.getPropertyValue("transform")||null;{if(i&&"none"!=i){for(var o=i.split("(")[1],t=(o=(o=o.split(")")[0]).split(","))[0],a=o[1],r=Math.round(Math.atan2(a,t)*(180/Math.PI));360<=r;)r=360-r;for(;r<0;)r=360+r;return r}return 0}}(this.element[0]),o=i*Math.PI/180,t=this.helper,a={},r=this.originalMousePosition,l=this.axis,s=this.position.top,d=this.position.left,c=this.size.width,p=this.size.height,u=e.pageX-r.left||0,g=e.pageY-r.top||0,m=this._change[l],f=this.size.width,h=this.size.height;if(!m)return!1;var y=Math.cos(o),_=Math.sin(o),P=g*y-u*_;u=u*y+g*_,g=P,n=m.apply(this,[e,u,g]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(n=this._updateRatio(n,e)),n=this._respectSize(n,e);var v={left:this.position.left,top:this.position.top};this._updateCache(n),this.position={left:v.left,top:v.top};var S=L(n.left||this.lastData.left)-L(this.lastData.left),A=L(n.top||this.lastData.top)-L(this.lastData.top),b={};b.left=S*y-A*_,b.top=A*y+S*_,b.left=O(b.left),b.top=O(b.top),this.position.left+=b.left,this.position.top+=b.top,this.lastData={left:L(n.left||this.lastData.left),top:L(n.top||this.lastData.top)},this._propagate("resize",e);var I=f-this.size.width,M=h-this.size.height,w=$.getCorrection(f,h,I,M,i);return this.position.left+=w.left,this.position.top-=w.top,this.position.top!==s&&(a.top=this.position.top+"px"),this.position.left!==d&&(a.left=this.position.left+"px"),this.size.width!==c&&(a.width=this.size.width+"px"),this.size.height!==p&&(a.height=this.size.height+"px"),t.css(a),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),$.isEmptyObject(a)||this._trigger("resize",e,this.ui()),!1},jQuery(e).resizable({ghost:!0,handles:"sw, se, nw, ne",helper:"resizable-helper",aspectRatio:!1,stop:function(e,n){a.ctx.clearRect(0,0,a.ctx.canvas.width,a.ctx.canvas.height),a.width=n.size.width,a.height=n.size.height,a.setCanvasSize(),a.ctx.save(),a.ctx.translate(a.ctx.canvas.width/2,a.ctx.canvas.height/2),a.ctx.drawImage(a.image_,-a.width/2,-a.height/2,a.width,a.height),a.ctx.restore()}}).rotatable({stop:function(e,n){}}),jQuery(e).draggable({stop:function(e,n){if(null!=t){var i=$(this).position().left,o=$(this).position().top;a.latlng=t.fromDivPixelToLatLng(new google.maps.Point(i,o),!0)}}});var i=document.createElement("canvas");i.id="canvas",e.appendChild(i),this.div_=e,this.canvas=i,this.ctx=i.getContext("2d"),this.initImage(),this.getPanes().overlayImage.appendChild(this.div_);var o=this,l=e;return google.maps.event.addDomListener(this.get("map").getDiv(),"mouseleave",function(){google.maps.event.trigger(l,"mouseup")}),google.maps.event.addDomListener(l,"mousedown",function(e){this.style.cursor="move",o.map.set("draggable",!1),o.set("origin",e)}),google.maps.event.addDomListener(l,"mouseup",function(){o.map.set("draggable",!0),this.style.cursor="default",google.maps.event.removeListener(o.moveHandler)}),this},CanvasOverlay.prototype.draw=function(){this.div_;null==this.canvas&&alert("error creating the canvas")},CanvasOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_)},CanvasOverlay.prototype.hide=function(){this.div_&&(this.div_.style.visibility="hidden")},CanvasOverlay.prototype.show=function(){this.div_&&(this.div_.style.visibility="visible")},CanvasOverlay.prototype.toggle=function(){this.div_&&("hidden"==this.div_.style.visibility?this.show():this.hide())},CanvasOverlay.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(this.map_)},CanvasOverlay.prototype.getCanvas=function(){return this.canvas},CanvasOverlay.prototype.getContext2d=function(){return this.ctx},CanvasOverlay.prototype.setCanvasSize=function(){this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.div_.style.width=this.width+"px",this.div_.style.height=this.height+"px"},CanvasOverlay.prototype.initImage=function(){this.setCanvasSize(),this.ctx.save(),this.ctx.translate(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.ctx.rotate(this.angle),this.ctx.drawImage(this.image_,-this.width/2,-this.height/2,this.width,this.height),this.ctx.restore()},CanvasOverlay.prototype.drawBoundingCanvas=function(){var e=getRotationDegrees($("#canvas_editor")),n=deg2rad(e);$("#canvas_editor").css({"-moz-transform":"rotate(0deg)","-webkit-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)","-o-transform":"rotate(0deg)",transform:"rotate(0deg)"});var i,o=getPositionData($("#canvas_editor")),t=o.left,a=o.top,r=t+this.width/2,l=a+this.height/2,s=r+(t-r)*Math.cos(n)+(a-l)*Math.sin(n),d=l-(t-r)*Math.sin(n)+(a-l)*Math.cos(n),c=r+(t+this.width-r)*Math.cos(n)+(a-l)*Math.sin(n),p=l-(t+this.width-r)*Math.sin(n)+(a-l)*Math.cos(n),u=r+(t-r)*Math.cos(n)+(a+this.height-l)*Math.sin(n),g=l-(t-r)*Math.sin(n)+(a+this.height-l)*Math.cos(n),m=r+(t+this.width-r)*Math.cos(n)+(a+this.height-l)*Math.sin(n),f=l-(t+this.width-r)*Math.sin(n)+(a+this.height-l)*Math.cos(n),h=Math.max(s,c,u,m),y=Math.max(d,p,g,f),_=Math.min(s,c,u,m),P=Math.min(d,p,g,f),v=P,S=_,A=h-_,b=y-P;$("#canvas_editor").css({top:v+"px",left:S+"px"}),this.ctx.canvas.width=A,this.ctx.canvas.height=b,this.ctx.save(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.translate(r-S,l-v),this.ctx.rotate(n),this.ctx.drawImage(this.image_,-this.width/2,-this.height/2,this.width,this.height),this.ctx.restore(),this.top=v,this.left=S,null!=(i=this.getProjection())&&(this.bottom_left_coords=i.fromContainerPixelToLatLng(new google.maps.Point(this.left,this.top+b),!0),this.top_right_coords=i.fromContainerPixelToLatLng(new google.maps.Point(this.left+A,this.top),!0))};var app,AnyplaceAPI,getPositionData=function(e){return $.extend({width:e.outerWidth(!1),height:e.outerHeight(!1)},e.offset())};function hexToBase64(e){return btoa(String.fromCharCode.apply(null,e.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")))}function base64_encode(e){var n,i,o,t,a,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,s=0,d="",c=[];if(!e)return e;for(;n=(a=e.charCodeAt(l++)<<16|e.charCodeAt(l++)<<8|e.charCodeAt(l++))>>18&63,i=a>>12&63,o=a>>6&63,t=63&a,c[s++]=r.charAt(n)+r.charAt(i)+r.charAt(o)+r.charAt(t),l<e.length;);d=c.join("");var p=e.length%3;return(p?d.slice(0,p-3):d)+"===".slice(p||3)}function USGSOverlay(e,n,i){this.bounds_=e,this.image_=n,this.image64=n,this.map_=i,this.div_=null,this.setMap(i)}function CanvasOverlay(e,n){for(this.top=0,this.left=0,this.width=e.width,this.height=e.height;window&&(this.width>window.innerWidth||this.height>window.innerHeight);)this.width/=2,this.height/=2;this.image_=e,this.map_=n,this.div_=null,this.canvas=null,this.ctx=null,this.angle=0,this.scale=1,this.latlng=n.getCenter(),this.new_left=0,this.new_top=0,this.setMap(n)}function deg2rad(e){return e*Math.PI/180}function rad2deg(e){return e/Math.PI*180}function getRotationDegrees(e){var n=e.css("-webkit-transform")||e.css("-moz-transform")||e.css("-ms-transform")||e.css("-o-transform")||e.css("transform");if("none"!==n)var i=n.split("(")[1].split(")")[0].split(","),o=i[0],t=i[1],a=(i[2],i[3],Math.sqrt(o*o+t*t),Math.round(Math.atan2(t,o)*(180/Math.PI)));else a=0;return a}(LPUtils={}).isNullOrUndefined=function(e){return null==e},LPUtils.isStringEmptyNullUndefined=function(e){return!e||0===e.length},LPUtils.isStringBlankNullUndefined=function(e){return!e||/^\s*$/.test(e)},LPUtils.alert=function(e){document.getElementById("notification_panel").innerHTML='<alert type="error" close="LPUtils.closeAlert()">'+e+"</alert>"},LPUtils.closeAlert=function(){document.getElementById("notification_panel").getEl.innerHTML=""},LPUtils.success=function(e){document.getElementById("notification_panel").innerHTML='<alert type="success">'+e+"</alert>"},LPUtils.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var n,i,o,t,a,r,l,s="",d=0;for(e=LPUtils.Base64._utf8_encode(e);d<e.length;)t=(n=e.charCodeAt(d++))>>2,a=(3&n)<<4|(i=e.charCodeAt(d++))>>4,r=(15&i)<<2|(o=e.charCodeAt(d++))>>6,l=63&o,isNaN(i)?r=l=64:isNaN(o)&&(l=64),s=s+this._keyStr.charAt(t)+this._keyStr.charAt(a)+this._keyStr.charAt(r)+this._keyStr.charAt(l);return s},decode:function(e){var n,i,o,t,a,r,l="",s=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<e.length;)n=this._keyStr.indexOf(e.charAt(s++))<<2|(t=this._keyStr.indexOf(e.charAt(s++)))>>4,i=(15&t)<<4|(a=this._keyStr.indexOf(e.charAt(s++)))>>2,o=(3&a)<<6|(r=this._keyStr.indexOf(e.charAt(s++))),l+=String.fromCharCode(n),64!=a&&(l+=String.fromCharCode(i)),64!=r&&(l+=String.fromCharCode(o));return l=LPUtils.Base64._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var n="",i=0;i<e.length;i++){var o=e.charCodeAt(i);o<128?n+=String.fromCharCode(o):(127<o&&o<2048?n+=String.fromCharCode(o>>6|192):(n+=String.fromCharCode(o>>12|224),n+=String.fromCharCode(o>>6&63|128)),n+=String.fromCharCode(63&o|128))}return n},_utf8_decode:function(e){for(var n="",i=0;i<e.length;){var o=e.charCodeAt(i);if(o<128)n+=String.fromCharCode(o),i++;else if(191<o&&o<224){var t=e.charCodeAt(i+1);n+=String.fromCharCode((31&o)<<6|63&t),i+=2}else{t=e.charCodeAt(i+1);var a=e.charCodeAt(i+2);n+=String.fromCharCode((15&o)<<12|(63&t)<<6|63&a),i+=3}}return n}},LPUtils.Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var n=e.length/4*3,i=new ArrayBuffer(n);return this.decode(e,i),i},decode:function(e,n){var i,o,t,a,r,l,s,d=this._keyStr.indexOf(e.charAt(e.length-1)),c=this._keyStr.indexOf(e.charAt(e.length-2)),p=e.length/4*3;64==d&&p--,64==c&&p--;var u=0,g=0;for(i=n?new Uint8Array(n):new Uint8Array(p),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),u=0;u<p;u+=3)o=this._keyStr.indexOf(e.charAt(g++))<<2|(r=this._keyStr.indexOf(e.charAt(g++)))>>4,t=(15&r)<<4|(l=this._keyStr.indexOf(e.charAt(g++)))>>2,a=(3&l)<<6|(s=this._keyStr.indexOf(e.charAt(g++))),i[u]=o,64!=l&&(i[u+1]=t),64!=s&&(i[u+2]=a);return i}},USGSOverlay.prototype=new google.maps.OverlayView,USGSOverlay.prototype.onAdd=function(){var e=document.createElement("div");e.id="ground_overlay",e.style.borderStyle="none",e.style.borderWidth="0px",e.style.position="absolute";var n=document.createElement("img");n.src=this.image64,n.style.width="100%",n.style.height="100%",n.style.position="absolute",e.appendChild(n),this.div_=e,this.getPanes().overlayLayer.appendChild(e)},USGSOverlay.prototype.draw=function(){var e=this.getProjection(),n=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),i=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),o=this.div_;o.style.left=n.x+"px",o.style.top=i.y+"px",o.style.width=i.x-n.x+"px",o.style.height=n.y-i.y+"px"},USGSOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},app.controller("AlertController",["$rootScope","$scope","AnyplaceService",function(e,n,i){n.anyService=i,n.alerts=i.alerts,n.closeable=!0}]),app.controller("BuildingController",["$cookieStore","$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(e,m,l,d,s,g){function n(){return(65536*(1+Math.random())|0).toString(16).substring(1)}m.myMarkers={},m.myMarkerId=0,m.laship=33,m.loship=33,m.moveShip=0,m.ShipInterval,m.gmapService=d,m.anyService=s,m.anyAPI=g,m.example9model=[],m.example9data=[],m.example9settings={enableSearch:!0,scrollable:!0},m.example9modeledit=[],m.example9dataedit=[],m.example9settingsedit={enableSearch:!0,scrollable:!0},m.myBuildings=[],m.myShips=[],m.myBuildingsHashT={},m.myCampus=[],m.old_campus=[],m.crudTabSelected=1,m.fileToUpload="",m.logfile="",m.poisTypes={},m.catTypes={},m.pageLoad=!1,m.crudTabSelected=1,m.setCrudTabSelected=function(e){if(m.crudTabSelected=e,m.anyService.getBuilding()){var n=m.myBuildingsHashT[m.anyService.getBuildingId()];if(n){var i=n.marker;i&&(2===e?i.setDraggable(!0):i.setDraggable(!1))}}else h("No building is selected.")},m.isCrudTabSelected=function(e){return m.crudTabSelected===e},m.$on("loggedIn",function(e,n){m.fetchAllBuildings(),m.fetchAllCampus()}),m.$on("loggedOff",function(e,n){t(),m.myMarkers={},m.myMarkerId=0,m.myBuildings=[],m.myBuildingsHashT={}});var i=(n()+n()+"-"+n()+"-4"+n().substr(0,3)+"-"+n()+"-"+n()+n()+n()).toLowerCase(),o=new Date;document.getElementById("CampusID").value="cuid_"+i+"_"+o.getTime(),$("#input-logo").change(function(e){var n=new FileReader;n.onload=function(e){(new Image).src=e.target.result},n.readAsDataURL(e.target.files[0])}),m.setLogoPlan=function(e){var n={is_published:"true",cuid:e,logo:String(m.newFloorNumber),description:String(m.newFloorNumber),floor_number:String(m.newFloorNumber)};m.myFloors[m.myFloorId]=n,m.myFloorId++,canvasOverlay.drawBoundingCanvas();var i=canvasOverlay.bottom_left_coords,o=canvasOverlay.top_right_coords;m.data.floor_plan_coords.bottom_left_lat=i.lat(),m.data.floor_plan_coords.bottom_left_lng=i.lng(),m.data.floor_plan_coords.top_right_lat=o.lat(),m.data.floor_plan_coords.top_right_lng=o.lng(),m.data.floor_plan_coords.zoom=d.gmap.getZoom()+"";var t=canvasOverlay.getCanvas().toDataURL("image/png");m.data.floor_plan_base64_data=t;var a=new google.maps.LatLngBounds(new google.maps.LatLng(i.lat(),i.lng()),new google.maps.LatLng(o.lat(),o.lng()));if(m.data.floor_plan_groundOverlay=new USGSOverlay(a,t,d.gmap),canvasOverlay.setMap(null),$("#input-floor-plan").prop("disabled",!1),m.isCanvasOverlayActive=!1,_floorNoExists(m.newFloorNumber))for(var r=0;r<m.xFloors.length;r++){var l=m.xFloors[r];if(!LPUtils.isNullOrUndefined(l)&&l.floor_number===String(m.newFloorNumber)){m.uploadFloorPlanBase64(m.anyService.selectedBuilding,l,m.data);break}}else m.addFloorObject(n,m.anyService.selectedBuilding,m.data)},m.$watch("anyService.selectedBuilding",function(e,n){e&&e.coordinates_lat&&e.coordinates_lon&&(m.gmapService.gmap.panTo(c(e)),m.gmapService.gmap.setZoom(19),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastBuilding",e.buid)),m.poisTypes=["Disabled Toilets","Elevator","Entrance","Fire Extinguisher","First Aid/AED","Kitchen","Office","Ramp","Room","Security/Guard","Stair","Toilets","Other"]}),m.$watch("anyService.selectedCampus",function(e,n){e&&e.cuid&&"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastCampus",e.cuid)});function f(e){m.anyService.addAlert("success",e)}var t=function(){for(var e in m.myBuildingsHashT)m.myBuildingsHashT.hasOwnProperty(e)&&(m.myBuildingsHashT[e].marker.setMap(null),delete m.myBuildingsHashT[e])},h=function(e){m.anyService.addAlert("danger",e)},c=function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}};m.fetchAllPoisTypes=function(){var e={};(e.username=m.creds.username,e.password=m.creds.password,e.access_token=m.gAuth.access_token,e.owner_id=m.owner_id,e.owner_id)?m.anyAPI.retrievePoisTypes(e).then(function(e){var n=e.data;m.catTypes=n.poistypes},function(e){e.data;h("Something went wrong while fetching POIs types")}):h("Could nor authorize user. Please refresh.1")},m.fetchAllBuildings=function(){var e={};(e.username=m.creds.username,e.password=m.creds.password,e.owner_id=m.owner_id,e.owner_id)?m.anyAPI.allBuildings(e).then(function(e){var n=e.data;for(var i in m.myBuildings=[],m.myShips=[],n.buildings){"ship"==n.buildings[i].buid.split("_",1)?m.myShips.push(n.buildings[i]):m.myBuildings.push(n.buildings[i])}var t=new google.maps.InfoWindow({content:"-",maxWidth:500}),o=-1,a=void 0;"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastBuilding")&&(a=localStorage.getItem("lastBuilding"));for(i=0;i<n.buildings.length;i++){var r=n.buildings[i];if(m.example9data[i]={id:r.buid,label:r.name},m.example9dataedit[i]={id:r.buid,label:r.name},a&&a===r.buid&&(o=i),"true"===r.is_published||1==r.is_published?r.is_published=!0:r.is_published=!1,"ship"==r.buid.split("_",1))var l=new google.maps.Marker({position:c(r),map:d.gmap,icon:new google.maps.MarkerImage("build/images/ship_icon.png",null,null,null,new google.maps.Size(54,54)),draggable:!1}),s='<div class="infowindow-scroll-fix"><h5>Ship:</h5><span>'+r.name+'</span><h5>Description:</h5><textarea class="infowindow-text-area"  rows="3" readonly>'+r.description+"</textarea></div>";else l=new google.maps.Marker({position:c(r),map:d.gmap,icon:new google.maps.MarkerImage("build/images/building-icon.png",null,null,null,new google.maps.Size(54,54)),draggable:!1}),s='<div class="infowindow-scroll-fix"><h5>Building:</h5><span>'+r.name+'</span><h5>Description:</h5><textarea class="infowindow-text-area"  rows="3" readonly>'+r.description+"</textarea></div>";l.infoContent=s,l.building=r,m.myBuildingsHashT[r.buid]={marker:l,model:r},google.maps.event.addListener(l,"click",function(){t.setContent(this.infoContent),t.open(d.gmap,this);m.anyService.selectedBuilding=this.building;var i=this.building.buid;if("ship"==i.split("_",1)){function e(){var e=m.myBuildingsHashT[i].marker;m.laship=parseFloat(m.laship)+1e-4,m.loship=parseFloat(m.loship)+1e-4;var n={lat:parseFloat(m.laship),lng:parseFloat(m.loship)};e.setPosition(n),console.log("its work")}if(0==m.moveShip?(m.moveShip=1,console.log("stop")):m.moveShip=0,0==m.moveShip){clearInterval(m.ShipInterval);var n=m.myBuildingsHashT[i];console.log(m.myBuildingsHashT[i]),console.log(n.model.coordinates_lat);var o={lat:parseFloat(n.model.coordinates_lat),lng:parseFloat(n.model.coordinates_lon)};console.log(o),n.marker.setPosition(o)}else e(),m.ShipInterval=setInterval(function(){e()},1e4)}}),console.log("dfgg ")}0<=o?m.anyService.selectedBuilding=m.myBuildings[o]:m.myBuildings[0]&&(m.anyService.selectedBuilding=m.myBuildings[0])},function(e){e.data;h("Something went wrong while fetching buildings.")}):h("Could nor authorize user. Please refresh.")},m.addNewBuilding=function(i){if(m.myMarkers[i]&&m.myMarkers[i].marker){var e,o,t=m.myMarkers[i].model;if(t.owner_id=m.owner_id,!t.owner_id)return void h("Could not authorize user. Please refresh.");if(t.coordinates_lat=String(m.myMarkers[i].marker.position.lat()),t.coordinates_lon=String(m.myMarkers[i].marker.position.lng()),void 0===t.coordinates_lat||null===t.coordinates_lat)return void h("Invalid building latitude.");if(void 0===t.coordinates_lon||null===t.coordinates_lon)return void h("Invalid building longitude.");if(!0===t.is_published?t.is_published="true":t.is_published="false",t.description||(t.description="-"),t.owner_id&&t.name&&t.description&&t.is_published&&t.url&&t.address)o=0==shipselect?(e=m.anyAPI.addBuilding(t),1):(e=m.anyAPI.addShip(t),0),e.then(function(e){var n=e.data;console.log("new buid: "+n.buid),t.buid=n.buid,"true"===t.is_published||1==t.is_published?t.is_published=!0:t.is_published=!1,0==shipselect?(m.myBuildings.push(t),m.anyService.selectedBuilding=m.myBuildings[m.myBuildings.length-1]):m.myShips.push(t),m.myMarkers[i].marker.setDraggable(!1),m.myBuildingsHashT[t.buid]={marker:m.myMarkers[i].marker,model:t},m.myMarkers[i].infowindow&&(m.myMarkers[i].infowindow.setContent(m.myMarkers[i].marker.tpl2[0]),m.myMarkers[i].infowindow.close()),f(o?"Building added successfully.":"Ship added successfully.")},function(e){var n=e.data;h("Something went wrong while adding the building. "+n.message)});else h("Some required fields are missing.")}},m.deleteBuilding=function(){var t=m.anyService.getBuilding(),e=m.creds;m.owner_id?(e.owner_id=m.owner_id,console.log(e.owner_id),t&&t.buid?(e.buid=t.buid,m.anyAPI.deleteBuilding(e).then(function(e){e.data;console.log("building deleted: ",t),m.myBuildingsHashT[t.buid].marker.setMap(null),delete m.myBuildingsHashT[t.buid];for(var n=m.myBuildings,i=n.length,o=0;o<i;o++)if(n[o].buid==t.buid){n.splice(o,1);break}m.myBuildings&&0<m.myBuildings.length&&(m.anyService.selectedBuilding=m.myBuildings[0]),m.setCrudTabSelected(1),f("Successfully deleted building.")},function(e){e.data;h("Something went wrong. It's likely that everything related to the building is deleted but please refresh to make sure or try again.")})):h("No building selected for deletion.")):h("Could not identify user. Please refresh and sign in again.")},m.deleteRadiomaps=function(){var e={buid:m.anyService.getBuildingId(),floor:m.anyService.getFloorNumber()};e.username=m.creds.username,e.password=m.creds.password,m.anyAPI.deleteRadiomaps(e).then(function(e){f("Successfully Delete floor radiomap")},function(e){e.data;h("Something went wrong.The file is not exist ")})},m.updateBuilding=function(){var n=m.anyService.getBuilding();if(LPUtils.isNullOrUndefined(n)||LPUtils.isNullOrUndefined(n.buid))h("No building selected found.");else{var e={};if(e=m.creds,m.owner_id){e.owner_id=m.owner_id,e.buid=n.buid,n.description&&(e.description=n.description),n.name&&(e.name=n.name),!0===n.is_published||"true"==n.is_published?e.is_published="true":e.is_published="false",n.bucode&&(e.bucode=n.bucode);var i=m.myBuildingsHashT[n.buid].marker;if(i){var o=i.position;o&&o.lat()&&o.lng()&&(e.coordinates_lat=String(o.lat()),e.coordinates_lon=String(o.lng()))}m.anyAPI.updateBuilding(e).then(function(e){e.data;"true"===n.is_published||1==n.is_published?n.is_published=!0:n.is_published=!1,f("Successfully updated building.")},function(e){var n=e.data;h("Something went wrong while updating building. "+n.message)})}else h("Could not identify user. Please refresh and sign in again.")}},m.fetchAllCampus=function(){var e={};(e.username=m.creds.username,e.password=m.creds.password,e.owner_id=m.owner_id,m.myCampus=[],e.owner_id)?m.anyAPI.allCampus(e).then(function(e){var n=e.data;m.myCampus=n.buildingsets;var i=-1,o=void 0;"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastCampus")&&(o=localStorage.getItem("lastCampus"));for(var t=0;t<m.myCampus.length;t++){var a=m.myCampus[t];o&&o===a.cuid&&(i=t)}0<=i?m.anyService.selectedCampus=m.myCampus[i]:m.myCampus[0]&&(m.anyService.selectedCampus=m.myCampus[0])},function(e){e.data;h("Something went wrong while fetching buildings.")}):h("Could nor authorize user. Please refresh.")},m.updateCampus=function(){var e=m.anyService.getCampus();if(LPUtils.isNullOrUndefined(e)||LPUtils.isNullOrUndefined(e.cuid))h("No campus selected found.");else{var n={};if(n=m.creds,m.owner_id){n.owner_id=m.owner_id,n.cuid=e.cuid,e.description&&(n.description=e.description),e.name&&(n.name=e.name),e.newcuid&&(n.newcuid=e.newcuid);var i=m.example9modeledit.length;if(0!=i){for(var o='"buids":[',t=i-1;0<t;t--)o=o+'"'+m.example9modeledit[t].id+'",';o=o+'"'+m.example9modeledit[0].id+'"]',n.greeklish=document.getElementById("Greeklish-OnOffedit").checked,n.buids=o,m.anyAPI.updateCampus(n).then(function(e){e.data;document.getElementById("CampusIDeditnew").value="",f("Successfully updated campus.")},function(e){var n=e.data;h("Something went wrong while updating campus. "+n.message)})}else h("No buildings selected.")}else h("Could not identify user. Please refresh and sign in again.")}},m.deleteCampus=function(){var t=m.anyService.getCampus(),e=m.creds;m.owner_id?(e.owner_id=m.owner_id,t&&t.cuid?(e.cuid=t.cuid,m.anyAPI.deleteCampus(e).then(function(e){e.data;console.log("campus deleted: ",t);for(var n=m.myCampus,i=n.length,o=0;o<i;o++)if(n[o].cuid==t.cuid){n.splice(o,1);break}m.myCampus&&0<m.myCampus.length?m.anyService.selectedCampus=m.myCampus[0]:0==m.myCampus.length&&(m.anyService.selectedCampus=void 0),m.setCrudTabSelected(1),f("Successfully deleted campus.")},function(e){e.data;h("Something went wrong. It's likely that everything related to the campus is deleted but please refresh to make sure or try again.")})):h("No Campus selected for deletion.")):h("Could not identify user. Please refresh and sign in again.")},m.addCampus=function(){var e='"name":"'+document.getElementById("CampusName").value+'"';0==document.getElementById("CampusDescription").value.localeCompare("")&&(document.getElementById("CampusDescription").value="-");var n='"description":"'+(n=document.getElementById("CampusDescription")).value+'"',i='"cuid":"'+(i=document.getElementById("CampusID")).value+'"',o=document.getElementById("Greeklish-OnOff").checked;o='"greeklish":"'+o+'"';var t=m.example9model.length;if(0!=t){for(var r='"buids":[',a=t-1;0<a;a--)r=r+'"'+m.example9model[a].id+'",';var l="{"+o+","+(r=r+'"'+m.example9model[0].id+'"]')+","+i+","+n+","+e+',"owner_id":"'+m.owner_id+'","access_token":"'+m.gAuth.access_token+'"}';m.anyAPI.addBuildingSet(l).then(function(e){var n=e.data,i={};function o(){return(65536*(1+Math.random())|0).toString(16).substring(1)}i.name=document.getElementById("CampusName").value,i.buids=r.buids,i.description=document.getElementById("CampusDescription").value,i.cuid=n.cuid,m.myCampus.push(i),m.anyService.selectedCampus=m.myCampus[m.myCampus.length-1],f("Successfully added campus.");var t=(o()+o()+"-"+o()+"-4"+o().substr(0,3)+"-"+o()+"-"+o()+o()+o()).toLowerCase(),a=new Date;document.getElementById("CampusID").value="cuid_"+t+"_"+a.getTime()},function(e){var n=e.data;h("Something went wrong while adding the building. "+n.message)})}else h("No buildings selected.")};var a=new google.maps.OverlayView;if(a.draw=function(){},a.setMap(d.gmap),$("#draggable-building").draggable({helper:"clone",stop:function(e){var n=new google.maps.Point(e.pageX,e.pageY),i=a.getProjection().fromContainerPixelToLatLng(n);m.placeMarker(i),shipselect=0}}),$("#draggable-ship").draggable({helper:"clone",stop:function(e){var n=new google.maps.Point(e.pageX,e.pageY),i=a.getProjection().fromContainerPixelToLatLng(n);m.placeMarkership(i),shipselect=1}}),m.placeMarkership=function(e){var n=m.myMarkers[m.myMarkerId-1];if(n&&n.marker&&n.marker.getMap()&&n.marker.getDraggable())console.log("there is a building pending, please add 1 at a time");else{var i=new google.maps.Marker({position:e,map:d.gmap,icon:"build/images/ship_icon.png",draggable:!0}),o=new google.maps.InfoWindow({content:"-",maxWidth:500});m.$apply(function(){i.myId=m.myMarkerId,m.myMarkers[i.myId]={},m.myMarkers[i.myId].model={description:"",name:void 0,is_published:!0,address:"-",url:"-",bucode:""},m.myMarkers[i.myId].marker=i,m.myMarkers[i.myId].infowindow=o,m.myMarkerId++});var t='<form name="buildingForm" class="infowindow-scroll-fix"><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.bucode" id="building-code" type="text" class="form-control" placeholder="Building Code (Optional)"/></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.name" id="building-name" type="text" class="form-control" placeholder="Building Name *"/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+i.myId+'].model.description" id="building-description" type="text" class="form-control" placeholder="Building Description (Optional)"></textarea></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.is_published" id="building-published" type="checkbox"><span> Make building public to view.</span></fieldset><fieldset class="form-group"></fieldset class="form-group"><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addNewBuilding('+i.myId+')"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempBuilding('+i.myId+')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form>',a='<div class="infowindow-scroll-fix"><h5 style="margin: 0">Building:</h5><span>{{myMarkers['+i.myId+'].model.name}}</span><h5 style="margin: 8px 0 0 0">Description:</h5><span>{{myMarkers['+i.myId+"].model.description}}</span></div>",r=l(t)(m);i.tpl2=l(a)(m),o.setContent(r[0]),o.open(d.gmap,i),google.maps.event.addListener(i,"click",function(){o.getMap()||o.open(d.gmap,i)})}},m.placeMarker=function(e){var n=m.myMarkers[m.myMarkerId-1];if(n&&n.marker&&n.marker.getMap()&&n.marker.getDraggable())console.log("there is a building pending, please add 1 at a time");else{var i=new google.maps.Marker({position:e,map:d.gmap,icon:"build/images/building-icon.png",draggable:!0}),o=new google.maps.InfoWindow({content:"-",maxWidth:500});m.$apply(function(){i.myId=m.myMarkerId,m.myMarkers[i.myId]={},m.myMarkers[i.myId].model={description:"",name:void 0,is_published:!0,address:"-",url:"-",bucode:""},m.myMarkers[i.myId].marker=i,m.myMarkers[i.myId].infowindow=o,m.myMarkerId++});var t='<form name="buildingForm" class="infowindow-scroll-fix"><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.bucode" id="building-code" type="text" class="form-control" placeholder="Building Code (Optional)"/></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.name" id="building-name" type="text" class="form-control" placeholder="Building Name *"/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+i.myId+'].model.description" id="building-description" type="text" class="form-control" placeholder="Building Description (Optional)"></textarea></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.is_published" id="building-published" type="checkbox"><span> Make building public to view.</span></fieldset><fieldset class="form-group"></fieldset class="form-group"><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addNewBuilding('+i.myId+')"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempBuilding('+i.myId+')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form>',a='<div class="infowindow-scroll-fix"><h5 style="margin: 0">Building:</h5><span>{{myMarkers['+i.myId+'].model.name}}</span><h5 style="margin: 8px 0 0 0">Description:</h5><span>{{myMarkers['+i.myId+"].model.description}}</span></div>",r=l(t)(m);i.tpl2=l(a)(m),o.setContent(r[0]),o.open(d.gmap,i),google.maps.event.addListener(i,"click",function(){o.getMap()||o.open(d.gmap,i)})}},m.deleteTempBuilding=function(e){var n=m.myMarkers[e];n&&n.marker&&n.marker.setMap(null)},m.exportBuildingToJson=function(){var c={building:{floors:[]}},p=m.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(p))h("No building selected");else{c.building.buid=p.buid,c.building.name=p.name,c.building.description=p.description,c.building.coordinates_lat=p.coordinates_lat,c.building.coordinates_lon=p.coordinates_lon;var e=s.jsonReq;e.buid=p.buid;var u=0;g.allBuildingFloors(e).then(function(e){var n,s=e.data.floors,d=[];if(s)for(var i=0;i<s.length;i++)n={buid:p.buid,floor_number:s[i].floor_number},g.retrievePoisByBuildingFloor(n).then(function(e){var n=e.data.pois;if(n){for(var i=[],o=n[0].floor_number,t=0;t<n.length;t++){var a=n[t];if("None"!=a.pois_type){if(a.overwrite)var r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:a.overwrite};else r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:"false"};i.push(r)}}if(d.push({floor_number:o,pois:i}),++u===s.length){c.building.floors=d,f("Successfully exported "+p.name+" to JSON.");var l=new Blob([JSON.stringify(c,null,4)],{type:"text/plain;charset=utf-8"});saveAs(l,p.name.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt")}}},function(e){var n=e.data;console.log(n.message)})},function(e){console.log(e.data.message)})}},m.exportCampusToJson=function(){var e={campus:{buids:[]}},n=m.anyService.selectedCampus;if(LPUtils.isNullOrUndefined(n))h("No campus selected");else{e.campus.name=n.name,e.campus.description=n.description,e.campus.buids=n.buids,f("Successfully exported "+n.name+" to JSON.");var i=new Blob([JSON.stringify(e,null,4)],{type:"text/plain;charset=utf-8"});saveAs(i,n.name.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt")}},document.getElementById("file-input").addEventListener("change",function(e){var n=e.target.files[0];if(n){var i=new FileReader;i.onload=function(e){var n=e.target.result;m.fileToUpload=n},i.readAsText(n)}},!1),m.anyService.downloadlogfile=!1,m.importBuildingFromJson=function(){var e,n,i=m.anyService.progress=0,o=0;""==m.fileToUpload&&h("Something went wrong no file selected");var t=JSON.parse(m.fileToUpload);for(e=0;e<t.building.floors.length;e++)for(n=0;n<t.building.floors[e].pois.length;n++)"true"==t.building.floors[e].pois[n].overwrite&&i++;for(0==i&&h("Something went wrong no pois to update"),e=0;e<t.building.floors.length;e++)for(n=0;n<t.building.floors[e].pois.length;n++)"true"==t.building.floors[e].pois[n].overwrite&&(o++,m.updatePoifromFile(t.building.floors[e].pois[n].puid,t.building.floors[e].pois[n].coordinates_lat,t.building.floors[e].pois[n].coordinates_lon,t.building.floors[e].pois[n].name,t.building.floors[e].pois[n].description,t.building.floors[e].pois[n].pois_type,t.building.floors[e].pois[n].overwrite,t.building.buid,e,n,i,o,t.building.name))},m.allpois={},m.pois={},m.importBuildingFromExcel=function(e){m.anyService.progress=0;var n=document.getElementById("my_file_input").files[0];m.fileToUpload=n.name;var i=new FileReader;i.onload=function(e){var n=e.target.result,i=XLS.CFB.read(n,{type:"binary"}),o=XLS.parse_xlscfb(i);o.SheetNames.forEach(function(e){var n=XLS.utils.sheet_to_row_object_array(o.Sheets[e]);m.uploadloop(0,n,"")})},i.readAsBinaryString(n)},m.uploadloop=function(e,n,i){for(var o=e;o<n.length;o++){if(i!=n[o].buid&&null!=n[o].buid)return m.pois={},i=n[o].buid,void m.fetchAllPoisForBuilding(n[o].buid,n,o,i);var t="";null!=n[o].des3&&""!=n[o].des3&&null!=n[o].des3?null!=n[o].des4&&""!=n[o].des4&&null!=n[o].des4?t=t+n[o].des3+" "+n[o].des4:t+=n[o].des3:null!=n[o].des4&&""!=n[o].des4&&null!=n[o].des4&&(t+=n[o].des4),null!=n[o].des1&&""!=n[o].des1&&null!=n[o].des1&&(""!=t?t=t+"\n"+n[o].des1:t+=n[o].des1),null!=n[o].des2&&""!=n[o].des2&&null!=n[o].des2&&(""!=t?t=t+"\n"+n[o].des2:t+=n[o].des2),m.anyService.progress=o/(n.length-1)*100,n.length-1==0&&(m.anyService.progress=100),m.pois[n[o].name]?m.updatePoifromExcel(m.pois[n[o].name].puid,m.pois[n[o].name].coordinates_lat,m.pois[n[o].name].coordinates_lon,m.pois[n[o].name].is_building_entrance,n[o].name,t,m.pois[n[o].name].pois_type,m.pois[n[o].name].overwrite,m.pois[n[o].name].buid,""):m.updatePoifromExcel("","","","",n[o].name,t,"","","","")}},m.fetchAllPoisForBuilding=function(e,t,a,r){var n=s.jsonReq;n.buid=e,g.retrievePoisByBuilding(n).then(function(e){var n=e.data;m.myPois=n.pois;for(var i=m.myPois.length-1;0<=i;i--){var o=m.myPois[i].name;m.pois[o]=m.myPois[i]}m.uploadloop(a,t,r)},function(e){e.data;h("Something went wrong while fetching POIs")})},m.logfile={pois:[]},m.updatePoifromExcel=function(i,e,n,o,t,a,r,l,s,d){var c={};c.username=m.creds.username,c.password=m.creds.password,c.owner_id=m.owner_id,c.coordinates_lat=e,c.coordinates_lon=n,c.is_building_entrance=o,c.name=t,c.puid=i,c.description=a,c.pois_type=r,c.overwrite="false",c.buid=s,m.anyAPI.updatePois(c).then(function(e){e.data;if(100==m.anyService.progress)if(m.anyService.downloadlogfile){m.anyService.downloadlogfile=!1,f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(m.fileToUpload+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),setTimeout(function(){m.anyService.progress=void 0},2500)}else f("Successfully updated POIs."),setTimeout(function(){m.anyService.progress=void 0,location.reload()},2500)},function(e){e.data;if(m.logfile.pois.push({name:t,puid:i,description:a,status:"Something went wrong while updating POI."}),m.anyService.downloadlogfile=!0,100==m.anyService.progress){m.anyService.downloadlogfile=!1,f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(m.fileToUpload+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),m.logfile.pois=[],setTimeout(function(){m.anyService.progress=void 0},2500)}})},m.updatePoifromFile=function(i,e,n,o,t,a,r,l,s,d,c,p,u){var g={};g.username=m.creds.username,g.password=m.creds.password,g.owner_id=m.owner_id,g.coordinates_lat=e,g.coordinates_lon=n,g.name=o,g.puid=i,g.description=t,g.pois_type=a,g.overwrite="false",g.buid=l,m.anyAPI.updatePois(g).then(function(e){e.data;if(m.anyService.progress=p/c*100,100==m.anyService.progress)if(m.anyService.downloadlogfile){f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(u+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),setTimeout(function(){m.anyService.progress=void 0},2500)}else f("Successfully updated POIs."),setTimeout(function(){m.anyService.progress=void 0,location.reload()},2500)},function(e){e.data;if(m.logfile.pois.push({name:o,puid:i,description:t,status:"Something went wrong while updating POI."}),m.anyService.downloadlogfile=!0,m.anyService.progress=p/c*100,100==m.anyService.progress)if(m.anyService.downloadlogfile){f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(u+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),m.logfile.pois=[],setTimeout(function(){m.anyService.progress=void 0},2500)}else f("Successfully updated POIs."),setTimeout(function(){m.anyService.progress=void 0,location.reload()},2500)})},m.Poisresult={building:{floors:[]}},m.Connectionsresult={building:{}},m.zip=new JSZip,m.DownloadBackup=function(){var o=m.anyService.selectedBuilding,l=[],e=s.jsonReq;e.buid=o.buid,m.anyService.progress=0,g.allBuildingFloors(e).then(function(e){l=e.data.floors;for(var a="",n=0;n<l.length;n++)a=0==n?l[n].floor_number:a+" "+l[n].floor_number;m.anyService.progress=10;var r=o.buid,i=s.jsonReq;g.downloadFloorPlanAll(i,r,a).then(function(e){for(var n=e.data,i=m.zip.folder("floor_plans"),o=0;o<n.all_floors.length;o++)""!=n.all_floors[o]&&i.file(l[o].floor_number+".png",n.all_floors[o],{base64:!0});m.anyService.progress=25;var t=s.jsonReq;t.buid=r,t.floor=a,g.getRadioByBuildingFloorAll(t).then(function(e){var n=e.data,i=m.zip.folder("radiomaps");if(n.rss_log_files)for(var o=0;o<n.rss_log_files.length;o++)i.file(l[o].floor_number+"-radiomap.txt",n.rss_log_files[o]);m.anyService.progress=70,m.exportPoisBuildingToJson()},function(e){})},function(e){})},function(e){console.log(e.data.message),h("Something went wrong while fetching all floors")})},m.exportPoisBuildingToJson=function(){var o=m.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(o))h("No building selected");else{m.Poisresult.building.buid=o.buid,m.Poisresult.building.name=o.name,m.Poisresult.building.description=o.description,m.Poisresult.building.coordinates_lat=o.coordinates_lat,m.Poisresult.building.coordinates_lon=o.coordinates_lon;var e=s.jsonReq;e.buid=o.buid;var d=0;g.allBuildingFloors(e).then(function(e){var n,l=e.data.floors,s=[];if(m.anyService.progress=80,l)for(var i=0;i<l.length;i++)n={buid:o.buid,floor_number:l[i].floor_number},g.retrievePoisByBuildingFloor(n).then(function(e){var n=e.data.pois;if(n){var i=[];if(null!=n[0]){for(var o=n[0].floor_number,t=0;t<n.length;t++){var a=n[t];if("None"!=a.pois_type){if(a.overwrite)var r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:a.overwrite};else r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:"false"};"true"==a.is_building_entrance?r.is_building_entrance="true":r.is_building_entrance="false",i.push(r)}}s.push({floor_number:o,pois:i})}++d===l.length&&(m.Poisresult.building.floors=s,m.zip.file("allpois.json",JSON.stringify(m.Poisresult,null,4)),m.anyService.progress=90,m.exportConnectionBuildingToJson())}},function(e){var n=e.data;console.log(n.message)})},function(e){console.log(e.data.message)})}},m.exportConnectionBuildingToJson=function(){var d=m.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(d))h("No building selected");else{m.Connectionsresult.building.buid=d.buid,m.Connectionsresult.building.name=d.name,m.Connectionsresult.building.description=d.description,m.Connectionsresult.building.coordinates_lat=d.coordinates_lat,m.Connectionsresult.building.coordinates_lon=d.coordinates_lon;var e=s.jsonReq;e.buid=d.buid;var c=0;g.allBuildingFloors(e).then(function(e){var n,l=e.data.floors,s=[];if(l)for(var i=0;i<l.length;i++)n={buid:d.buid,floor_number:l[i].floor_number},g.retrieveConnectionsByBuildingFloor(n).then(function(e){m.anyService.progress=100;var n=e.data.connections;if(n){var i=[];if(null!=n[0]){for(var o=n[0].floor_a,t=0;t<n.length;t++){var a=n[t],r={name:a.name,description:a.description,cuid:a.puid,weight:a.weight,pois_a:a.pois_a,pois_b:a.pois_b,floor_a:a.floor_a,floor_b:a.floor_b,is_published:a.is_published,buid_a:a.buid_a,buid_b:a.buid_b};i.push(r)}s.push({floor_number:o,connections:i})}++c===l.length&&(m.Connectionsresult.building.floors=s,m.zip.file("allconnections.json",JSON.stringify(m.Connectionsresult,null,4)),m.zip.generateAsync({type:"blob"}).then(function(e){saveAs(e,d.buid+".zip")}),m.anyService.progress=void 0)}},function(e){var n=e.data;console.log(n.message)})},function(e){console.log(e.data.message)})}},$("#dismiss").on("click",function(){"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("dismissClicked","YES")}),"YES"!==localStorage.getItem("dismissClicked")){window.onload=function(){$("#myModal_Welcome").modal("show")}}}]),app.controller("ControlBarController",["$scope","$rootScope","AnyplaceService","GMapService","AnyplaceAPIService",function(o,e,n,t,i){o.anyService=n,o.gmapService=t,o.isAuthenticated=!1,o.signInType="google",o.gAuth={},o.person=void 0,o.creds={username:"username",password:"password"},o.owner_id=void 0,o.displayName=void 0;o.setAuthenticated=function(e){o.isAuthenticated=e},o.showFullControls=!0,o.toggleFullControls=function(){o.showFullControls=!o.showFullControls};o.showGoogleID=function(){o.person&&n.addAlert("success","Your Google ID is: "+o.person.id)},o.showGoogleAuth=function(){o.gAuth&&n.addAlert("success","access_token: "+o.gAuth.access_token)},o.onSignIn=function(e){""===o.getCookie("username")&&(o.setCookie("username","true",365),location.reload()),o.setAuthenticated(!0),o.gAuth=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse(),o.gAuth.access_token=o.gAuth.id_token,app.access_token=o.gAuth.id_token,o.personLookUp(e)},o.onSignInFailure=function(){console.log("Sign-in state: Error")},window.onSignIn=o.onSignIn,window.onSignInFailure=o.onSignInFailure,o.personLookUp=function(e){o.person=e.getBasicProfile(),o.person.image=o.person.getImageUrl(),o.person.id=o.person.getId(),o.person.displayName=o.person.getName(),o.owner_id=o.person.id+"_"+o.signInType,o.displayName=o.person.displayName,o.person&&o.person.id&&o.$broadcast("loggedIn",[]),i.signAccount({name:o.person.displayName,type:"google"}).then(function(e){},function(e){})},o.signOut=function(){o.setCookie("username","",365),gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out.")}),o.isAuthenticated=!1,o.$broadcast("loggedOff",[]),o.gAuth={},o.owner_id=void 0,o.person=void 0},o.getCookie=function(e){for(var n=e+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(var t=i[o];" "==t.charAt(0);)t=t.substring(1);if(0==t.indexOf(n))return t.substring(n.length,t.length)}return""},o.setCookie=function(e,n,i){var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3);var t="expires="+o.toUTCString();document.cookie=e+"="+n+"; "+t},o.tab=1,o.setTab=function(e){o.tab=e},o.isTabSet=function(e){return o.tab===e},o.tab=1,o.setTab=function(e){o.tab=e},o.isTabSet=function(e){return o.tab===e};function a(e){o.anyService.addAlert("danger",e)}var r=void 0;o.userPosition=void 0;var l=!1;o.isUserLocVisible=!1,o.getIsUserLocVisible=function(){return o.isUserLocVisible},o.panToUserLocation=function(){o.userPosition&&(t.gmap.panTo(o.userPosition),t.gmap.setZoom(20))},o.displayMyLocMarker=function(e){r&&r.getMap()&&r.setPosition(e)},o.displayMyLocMarker=function(e){if(r&&r.getMap())r.setPosition(e);else{var n=new google.maps.Size(20,20);o.isFirefox&&(n=new google.maps.Size(48,48)),r=new google.maps.Marker({position:e,map:t.gmap,draggable:!1,icon:{url:"build/images/location-radius-centre.png",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,10),size:n,scaledSize:new google.maps.Size(20,20)}})}},o.hideUserLocation=function(){r&&r.setMap(null),o.isUserLocVisible=!1},o.showUserLocation=function(){if(o.getIsUserLocVisible())return o.hideUserLocation(),void(navigator.geolocation&&navigator.geolocation.clearWatch(watchPosNum));navigator.geolocation?watchPosNum=navigator.geolocation.watchPosition(function(e){var n={lat:e.coords.latitude,lng:e.coords.longitude};o.userPosition=n,o.displayMyLocMarker(n);var i=new google.maps.InfoWindow({content:"Your current location.",maxWidth:500});google.maps.event.addListener(r,"click",function(){var e=this;o.$apply(function(){i.open(t.gmap,e)})}),o.isUserLocVisible||o.$apply(function(){o.isUserLocVisible=!0}),l||(t.gmap.panTo(n),t.gmap.setZoom(19),l=!0)},function(e){o.$apply(function(){1==e.code?a("Permission denied. Anyplace was not able to retrieve your Geolocation."):2==e.code?a("Position unavailable. The network is down or the positioning satellites couldn't be contacted."):3==e.code?a("Timeout. The request for retrieving your Geolocation was timed out."):a("There was an error while retrieving your Geolocation. Please try again.")})}):a("The Geolocation feature is not supported by this browser.")},o.centerViewToSelectedItem=function(){if(null!=o.anyService.selectedBuilding&&null!=o.anyService.selectedBuilding){var e={};if(o.anyService.selectedPoi){var n=o.anyService.selectedPoi;e={lat:parseFloat(n.coordinates_lat),lng:parseFloat(n.coordinates_lon)}}else{if(!o.anyService.selectedBuilding)return void a("No building is selected.");var i=o.anyService.selectedBuilding;e={lat:parseFloat(i.coordinates_lat),lng:parseFloat(i.coordinates_lon)}}o.gmapService.gmap.panTo(e),o.gmapService.gmap.setZoom(20)}else a("You have to select a building first")}}]),(app=angular.module("anyArchitect",["ngCookies","angularjs-dropdown-multiselect","ui.bootstrap","ui.select","ngSanitize"])).service("GMapService",function(){this.gmap={};var n=this,e=document.getElementById("map-canvas");function i(e){this.tileSize=e}function o(e){this.tileSize=e}i.prototype.maxZoom=22,i.prototype.name="OSM",i.prototype.alt="Tile OSM Map Type",i.prototype.getTile=function(e,n,i){if(19<n)return null;var o=1<<n,t=e.x%o;t<0&&(t=o+t);var a=i.createElement("img");return a.src="http://tile.openstreetmap.org/"+n+"/"+t+"/"+e.y+".png",a.style.width=this.tileSize.width+"px",a.style.height=this.tileSize.height+"px",a},o.prototype.maxZoom=22,o.prototype.name="Carto Light",o.prototype.alt="Tile Carto Light Map Type",o.prototype.getTile=function(e,n,i){var o="https://cartodb-basemaps-a.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png";o=o.replace("{x}",e.x).replace("{y}",e.y).replace("{z}",n);var t=i.createElement("img");return t.src=o,t.style.width=this.tileSize.width+"px",t.style.height=this.tileSize.height+"px",t};var t="OSM";"undefined"!=typeof Storage&&localStorage&&(localStorage.getItem("mapTypeId")?t=localStorage.getItem("mapTypeId"):localStorage.setItem("mapTypeId","OSM")),n.gmap=new google.maps.Map(e,{center:new google.maps.LatLng(57,21),zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!0,streetViewControl:!1,overviewMapControl:!0,zoom:3,mapTypeId:t,mapTypeControlOptions:{mapTypeIds:["OSM","CartoLight","roadmap","satellite"],style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.LEFT_CENTER}}),n.gmap.addListener("maptypeid_changed",function(){var e="roadmap"===n.gmap.getMapTypeId()||"satellite"===n.gmap.getMapTypeId();localStorage.setItem("mapTypeId",n.gmap.getMapTypeId()),n.gmap.setOptions({streetViewControl:e})}),n.gmap.mapTypes.set("OSM",new i(new google.maps.Size(256,256))),n.gmap.mapTypes.set("CartoLight",new o(new google.maps.Size(256,256)));var a=document.getElementById("pac-input");n.gmap.controls[google.maps.ControlPosition.TOP_LEFT].push(a),n.searchBox=new google.maps.places.SearchBox(a),google.maps.event.addListener(n.searchBox,"places_changed",function(){var e=n.searchBox.getPlaces();0!=e.length&&(n.gmap.panTo(e[0].geometry.location),n.gmap.setZoom(17))}),n.gmap.addListener(n.gmap,"bounds_changed",function(){var e=n.gmap.getBounds();n.searchBox.setBounds(e)})}),app.factory("AnyplaceService",function(){var e={selectedBuilding:void 0,selectedFloor:void 0,selectedPoi:void 0,selectedCampus:void 0,ShowShareProp:void 0,progress:void 0,allPois:{},allConnections:{},radioHeatmapRSSMode:!1,radioHeatmapLocalization:!1,fingerPrintsTimeMode:!1,radioHeatmapRSSTimeMode:!1,alerts:[],jsonReq:{username:"username",password:"password"},BASE_URL:"https://ap.cs.ucy.ac.cy",getBuilding:function(){return this.selectedBuilding},getCampus:function(){return this.selectedCampus},getBuildingId:function(){if(this.selectedBuilding)return this.selectedBuilding.buid},getBuildingName:function(){return this.selectedBuilding?this.selectedBuilding.name:"N/A"},getCampusName:function(){return this.selectedCampus?this.selectedCampus.name:"N/A"},getFloor:function(){return this.selectedFloor},getFloorNumber:function(){return this.selectedFloor?String(this.selectedFloor.floor_number):"N/A"},getFloorName:function(){return this.selectedFloor.floor_name},setBuilding:function(e){this.selectedBuilding=e},setFloor:function(e){this.selectedFloor=e},addAlert:function(e,n){this.alerts[0]={msg:n,type:e}},closeAlert:function(e){this.alerts.splice(e,1)},getBuildingViewerUrl:function(){return this.selectedBuilding&&this.selectedBuilding.buid?this.selectedBuilding.buid:"N/A"},getBuildingViewerUrlEncoded:function(){return this.selectedBuilding&&this.selectedBuilding.buid?encodeURIComponent("https://ap.cs.ucy.ac.cy/viewer/?buid="+this.selectedBuilding.buid):"N/A"},getCampusViewerUrl:function(){return this.selectedCampus&&this.selectedCampus.cuid?"https://ap.cs.ucy.ac.cy/viewer/?cuid="+this.selectedCampus.cuid:"N/A"},getCampusViewerUrlEncoded:function(){return this.selectedCampus&&this.selectedCampus.cuid?encodeURIComponent("https://ap.cs.ucy.ac.cy/viewer/?cuid="+this.selectedCampus.cuid):"N/A"},setAllPois:function(e){this.allPois={},this.allPois=e},setAllConnection:function(e){this.allConnections={},this.allConnections=e},getAllPois:function(){return this.allPois?this.allPois:"N/A"},getAllConnections:function(){return this.allConnections?this.allConnections:"N/A"},clearAllData:function(){e.selectedPoi=void 0,e.selectedFloor=void 0,e.selectedBuilding=void 0,e.selectedCampus=void 0,e.ShowShareProp=void 0,e.allPois={},e.allConnections={}}};return e}),app.factory("Alerter",function(){var e={AlertCtrl:"-"};return e}),app.factory("formDataObject",function(){return function(e,n){var i=new FormData;return angular.forEach(e,function(e,n){i.append(n,e)}),delete n()["Content-Type"],i}}),app.config(["$locationProvider",function(e){e.html5Mode(!0)}]),app.filter("propsFilter",function(){return function(e,r){var l=[];return angular.isArray(e)?e.forEach(function(e){for(var n=!1,i=Object.keys(r),o=0;o<i.length;o++){var t=i[o],a=r[t].toLowerCase();if(-1!==e[t].toString().toLowerCase().indexOf(a)){n=!0;break}}n&&l.push(e)}):l=e,l}}),app.factory("myInterceptor",[function(){return{request:function(e){return void 0!==e.url&&0!==e.url.indexOf(AnyplaceAPI.FULL_SERVER)||e.data&&(e.data.access_token=app.access_token),e}}}]),app.config(["$httpProvider",function(e){e.interceptors.push("myInterceptor")}]),(AnyplaceAPI={}).FULL_SERVER="http://localhost:9000/anyplace",AnyplaceAPI.Mapping={},AnyplaceAPI.Mapping.RADIO_HEATMAP="/mapping/radio/heatmap_building_floor",AnyplaceAPI.Mapping.RADIO_HEATMAP_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS="/mapping/radio/heatmap_building_floor_avarage",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_1="/position/radio/heatmap_building_floor_average_1",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_1=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_1,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_2="/position/radio/heatmap_building_floor_average_2",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_2=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_2,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_3="/position/radio/heatmap_building_floor_average_3",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_3=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_3,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_3_TILES="/position/radio/heatmap_building_floor_average_3_tiles",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_3_TILES=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_3_TILES,AnyplaceAPI.Mapping.APs="/position/radio/APs_building_floor",AnyplaceAPI.Mapping.APs_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.APs,AnyplaceAPI.Mapping.FINGERPRINTS_DELETE="/position/radio/delete",AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FINGERPRINTS_DELETE,AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_TIME="/position/radio/delete/time",AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_TIME_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_TIME,AnyplaceAPI.Mapping.GET_APS_IDS="/position/radio/aps_ids",AnyplaceAPI.Mapping.GET_APS_IDS_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.GET_APS_IDS,AnyplaceAPI.Mapping.FINGERPRINTS_TIME="/position/radio/time",AnyplaceAPI.Mapping.FINGERPRINTS_TIME_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FINGERPRINTS_TIME,AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME="/position/radio/heatmap_building_floor_timestamp",AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME,AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_TILES="/position/radio/heatmap_building_floor_timestamp_tiles",AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_TILES_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_TILES,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_1="/position/radio/heatmap_building_floor_timestamp_average_1",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_1=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_1,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_2="/position/radio/heatmap_building_floor_timestamp_average_2",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_2=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_2,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_3="/position/radio/heatmap_building_floor_timestamp_average_3",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_3=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_3,AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES="/position/radio/acces",AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES,AnyplaceAPI.Mapping.RADIO_HEATMAP_POI="/mapping/radio/radio_heatmap_bbox",AnyplaceAPI.Mapping.RADIO_HEATMAP_URL_POI=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_HEATMAP_POI,AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL="/position/radio_by_building_floor_all",AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL,AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT="/position/radio_by_building_floor_all_text",AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT,AnyplaceAPI.Mapping.BUILDING_ADD="/mapping/building/add",AnyplaceAPI.Mapping.BUILDING_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDING_ADD,AnyplaceAPI.Mapping.SHIP_ADD="/mapping/ship/add",AnyplaceAPI.Mapping.SHIP_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.SHIP_ADD,AnyplaceAPI.Mapping.CAMPUS_ALL="/mapping/campus/all_owner",AnyplaceAPI.Mapping.CAMPUS_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CAMPUS_ALL,AnyplaceAPI.Mapping.CAMPUS_UPDATE="/mapping/campus/update",AnyplaceAPI.Mapping.CAMPUS_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CAMPUS_UPDATE,AnyplaceAPI.Mapping.CAMPUS_DELETE="/mapping/campus/delete",AnyplaceAPI.Mapping.CAMPUS_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CAMPUS_DELETE,AnyplaceAPI.Mapping.BUILDINGSET_ADD="/mapping/campus/add",AnyplaceAPI.Mapping.BUILDINGSET_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDINGSET_ADD,AnyplaceAPI.Mapping.POISCATEGORY_ADD="/mapping/pois/add_category",AnyplaceAPI.Mapping.POISCATEGORY_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POISCATEGORY_ADD,AnyplaceAPI.Mapping.BUILDING_UPDATE="/mapping/building/update",AnyplaceAPI.Mapping.BUILDING_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDING_UPDATE,AnyplaceAPI.Mapping.RADIOMAP_DELETE="/position/radio/heatmap_building_floor_delete",AnyplaceAPI.Mapping.RADIOMAP_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.RADIOMAP_DELETE,AnyplaceAPI.Mapping.BUILDING_ALL="/mapping/building/all_owner",AnyplaceAPI.Mapping.BUILDING_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.BUILDING_ALL,AnyplaceAPI.Mapping.FLOOR_ADD="/mapping/floor/add",AnyplaceAPI.Mapping.FLOOR_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_ADD,AnyplaceAPI.Mapping.FLOOR_UPDATE="/mapping/floor/update",AnyplaceAPI.Mapping.FLOOR_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_UPDATE,AnyplaceAPI.Mapping.FLOOR_DELETE="/mapping/floor/delete",AnyplaceAPI.Mapping.FLOOR_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_DELETE,AnyplaceAPI.Mapping.FLOOR_ALL="/mapping/floor/all",AnyplaceAPI.Mapping.FLOOR_ALL_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_ALL,AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD="/mapping/floor/uploadWithZoom",AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD,AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD="/floorplans64/",AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD,AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_ALL="/floorplans64all/",AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL_ALL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_ALL,AnyplaceAPI.Mapping.POIS_ADD="/mapping/pois/add",AnyplaceAPI.Mapping.POIS_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_ADD,AnyplaceAPI.Mapping.POIS_UPDATE="/mapping/pois/update",AnyplaceAPI.Mapping.POIS_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_UPDATE,AnyplaceAPI.Mapping.POIS_DELETE="/mapping/pois/delete",AnyplaceAPI.Mapping.POIS_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_DELETE,AnyplaceAPI.Mapping.POIS_ALL_FLOOR="/mapping/pois/all_floor",AnyplaceAPI.Mapping.POIS_ALL_FLOOR_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_ALL_FLOOR,AnyplaceAPI.Mapping.POIS_ALL_BUILDING="/mapping/pois/all_building",AnyplaceAPI.Mapping.POIS_ALL_BUILDING_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_ALL_BUILDING,AnyplaceAPI.Mapping.POIS_TYPES="/mapping/pois/types",AnyplaceAPI.Mapping.POIS_TYPES_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.POIS_TYPES,AnyplaceAPI.Mapping.CONNECTION_ADD="/mapping/connection/add",AnyplaceAPI.Mapping.CONNECTION_ADD_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_ADD,AnyplaceAPI.Mapping.CONNECTION_UPDATE="/mapping/connection/update",AnyplaceAPI.Mapping.CONNECTION_UPDATE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_UPDATE,AnyplaceAPI.Mapping.CONNECTION_DELETE="/mapping/connection/delete",AnyplaceAPI.Mapping.CONNECTION_DELETE_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_DELETE,AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR="/mapping/connection/all_floor",AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR,AnyplaceAPI.Mapping.SIGN="/mapping/accounts/sign",AnyplaceAPI.Mapping.SIGN_URL=AnyplaceAPI.FULL_SERVER+AnyplaceAPI.Mapping.SIGN,app.factory("AnyplaceAPIService",["$http","$q","formDataObject",function(l,e,i){l.defaults.useXDomain=!0,delete l.defaults.headers.common["X-Requested-With"];var n={getRadioHeatmap:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSS:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSS_1:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_1,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSS_2:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_2,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSS_3:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_3,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSS_3_Tiles:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_URL_3_TILES,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSSByTime_1:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_1,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSSByTime_2:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_2,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSSByTime_3:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_BY_TIME_URL_3,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSSByTime:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapRSSByTime_Tiles:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_BY_TIME_TILES_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getAPs:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.APs_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getAPsIds:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.GET_APS_IDS_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteFingerprints:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteFingerprintsByTime:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FINGERPRINTS_DELETE_TIME_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getFingerprintsTime:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FINGERPRINTS_TIME_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getHeatmapAcces:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_RSS_ACCES_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},retrievePoisTypes:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_TYPES_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},retrievePoisByBuilding:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_ALL_BUILDING_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioHeatmapPoi:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_HEATMAP_URL_POI,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioByBuildingFloorAll:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getRadioByBuildingFloorTxt:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIO_BY_BUILDING_FLOOR_ALL_TXT_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addBuilding:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addShip:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.SHIP_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addBuildingSet:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.BUILDINGSET_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addCategory:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POISCATEGORY_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},updateBuilding:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_UPDATE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},updateCampus:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CAMPUS_UPDATE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteBuilding:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteRadiomaps:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.RADIOMAP_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteCampus:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CAMPUS_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},allBuildings:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.BUILDING_ALL_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},allCampus:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CAMPUS_ALL_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addFloor:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},updateFloor:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_UPDATE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteFloor:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},allBuildingFloors:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_ALL_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},uploadFloorPlan:function(e,n){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD_URL,headers:{"Content-Type":"multipart/form-data"},data:{floorplan:n,json:e},transformRequest:i}).success(function(e,n){return e}).error(function(e,n){return e})},uploadFloorPlan64:function(e,n){var i=n.replace("data:image/png;base64,",""),o=LPUtils.Base64Binary.decode(i),t=new Blob([o]);i="";for(var a=0;a<o.length;a++)i+=o[a];var r=new FormData;return r.append("json",e),r.append("floorplan",t),l.post(AnyplaceAPI.Mapping.FLOOR_PLAN_UPLOAD_URL,r,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e,n){return e}).error(function(e,n){return e})},downloadFloorPlan:function(e,n,i){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL+n+"/"+i,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},downloadFloorPlanAll:function(e,n,i){return l({method:"POST",url:AnyplaceAPI.Mapping.FLOOR_PLAN_DOWNLOAD_URL_ALL+n+"/"+i,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},getShipPosition:function(){return l({method:"GET",url:"services.marinetraffic.com/api/exportvessel/v:5/78e2e7fd31c8707894aca549b06823598368d250/timespan:20/protocol:jsono/mmsi:310627000"}).success(function(e,n){return e}).error(function(e,n){return e})},addPois:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},updatePois:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_UPDATE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deletePois:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},retrievePoisByBuildingFloor:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.POIS_ALL_FLOOR_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},addConnection:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_ADD_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},updateConnection:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_UPDATE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},deleteConnection:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_DELETE_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},retrieveConnectionsByBuildingFloor:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.CONNECTION_ALL_FLOOR_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})},signAccount:function(e){return l({method:"POST",url:AnyplaceAPI.Mapping.SIGN_URL,data:e}).success(function(e,n){return e}).error(function(e,n){return e})}};return n}]),CanvasOverlay.prototype=new google.maps.OverlayView,CanvasOverlay.prototype.onAdd=function(){var t,e=document.createElement("div");if(e.id="canvas_editor",e.style.border="none",e.style.borderWidth="0px",e.style.position="relative",e.style.top=this.top,e.style.left=this.left,null!=(t=this.getProjection())){var n=t.fromLatLngToDivPixel(this.latlng);e.style.top=n.y-this.height/2+"px",e.style.left=n.x-this.width/2+"px"}var a=this;function r(e){return parseInt(e,10)||0}function L(e){return isNaN(parseFloat(e))?0:parseFloat(e)}function O(e){return Math.round(100*(e+1e-5))/100}jQuery.getCorrection=function(e,n,i,o,t){t=t*Math.PI/180;var a,r=-e/2,l=(a=n/2)*Math.sin(t)+r*Math.cos(t)-r,s=a*Math.cos(t)-r*Math.sin(t)-a;r=-(e+i)/2;return{left:(a=(n+o)/2)*Math.sin(t)+r*Math.cos(t)-r-l,top:a*Math.cos(t)-r*Math.sin(t)-a-s}},jQuery.ui.resizable.prototype._mouseStart=function(e){var n,i,o,t=this.options,a=this.element;return this.resizing=!0,this._renderProxy(),n=r(this.helper.css("left")),i=r(this.helper.css("top")),t.containment&&(n+=$(t.containment).scrollLeft()||0,i+=$(t.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:i},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalPosition={left:n,top:i},this.originalMousePosition={left:e.pageX,top:e.pageY},this.lastData=this.originalPosition,this.aspectRatio="number"==typeof t.aspectRatio?t.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=$(".ui-resizable-"+this.axis).css("cursor"),$("body").css("cursor","auto"===o?this.axis+"-resize":o),a.addClass("ui-resizable-resizing"),this._propagate("start",e),!0},jQuery.ui.resizable.prototype._mouseDrag=function(e){var n,i=function(e){var n=window.getComputedStyle(e,null),i=n.getPropertyValue("-webkit-transform")||n.getPropertyValue("-moz-transform")||n.getPropertyValue("-ms-transform")||n.getPropertyValue("-o-transform")||n.getPropertyValue("transform")||null;{if(i&&"none"!=i){for(var o=i.split("(")[1],t=(o=(o=o.split(")")[0]).split(","))[0],a=o[1],r=Math.round(Math.atan2(a,t)*(180/Math.PI));360<=r;)r=360-r;for(;r<0;)r=360+r;return r}return 0}}(this.element[0]),o=i*Math.PI/180,t=this.helper,a={},r=this.originalMousePosition,l=this.axis,s=this.position.top,d=this.position.left,c=this.size.width,p=this.size.height,u=e.pageX-r.left||0,g=e.pageY-r.top||0,m=this._change[l],f=this.size.width,h=this.size.height;if(!m)return!1;var y=Math.cos(o),_=Math.sin(o),P=g*y-u*_;u=u*y+g*_,g=P,n=m.apply(this,[e,u,g]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(n=this._updateRatio(n,e)),n=this._respectSize(n,e);var v={left:this.position.left,top:this.position.top};this._updateCache(n),this.position={left:v.left,top:v.top};var S=L(n.left||this.lastData.left)-L(this.lastData.left),A=L(n.top||this.lastData.top)-L(this.lastData.top),b={};b.left=S*y-A*_,b.top=A*y+S*_,b.left=O(b.left),b.top=O(b.top),this.position.left+=b.left,this.position.top+=b.top,this.lastData={left:L(n.left||this.lastData.left),top:L(n.top||this.lastData.top)},this._propagate("resize",e);var I=f-this.size.width,M=h-this.size.height,w=$.getCorrection(f,h,I,M,i);return this.position.left+=w.left,this.position.top-=w.top,this.position.top!==s&&(a.top=this.position.top+"px"),this.position.left!==d&&(a.left=this.position.left+"px"),this.size.width!==c&&(a.width=this.size.width+"px"),this.size.height!==p&&(a.height=this.size.height+"px"),t.css(a),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),$.isEmptyObject(a)||this._trigger("resize",e,this.ui()),!1},jQuery(e).resizable({ghost:!0,handles:"sw, se, nw, ne",helper:"resizable-helper",aspectRatio:!1,stop:function(e,n){a.ctx.clearRect(0,0,a.ctx.canvas.width,a.ctx.canvas.height),a.width=n.size.width,a.height=n.size.height,a.setCanvasSize(),a.ctx.save(),a.ctx.translate(a.ctx.canvas.width/2,a.ctx.canvas.height/2),a.ctx.drawImage(a.image_,-a.width/2,-a.height/2,a.width,a.height),a.ctx.restore()}}).rotatable({stop:function(e,n){}}),jQuery(e).draggable({stop:function(e,n){if(null!=t){var i=$(this).position().left,o=$(this).position().top;a.latlng=t.fromDivPixelToLatLng(new google.maps.Point(i,o),!0)}}});var i=document.createElement("canvas");i.id="canvas",e.appendChild(i),this.div_=e,this.canvas=i,this.ctx=i.getContext("2d"),this.initImage(),this.getPanes().overlayImage.appendChild(this.div_);var o=this,l=e;return google.maps.event.addDomListener(this.get("map").getDiv(),"mouseleave",function(){google.maps.event.trigger(l,"mouseup")}),google.maps.event.addDomListener(l,"mousedown",function(e){this.style.cursor="move",o.map.set("draggable",!1),o.set("origin",e)}),google.maps.event.addDomListener(l,"mouseup",function(){o.map.set("draggable",!0),this.style.cursor="default",google.maps.event.removeListener(o.moveHandler)}),this},CanvasOverlay.prototype.draw=function(){this.div_;null==this.canvas&&alert("error creating the canvas")},CanvasOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_)},CanvasOverlay.prototype.hide=function(){this.div_&&(this.div_.style.visibility="hidden")},CanvasOverlay.prototype.show=function(){this.div_&&(this.div_.style.visibility="visible")},CanvasOverlay.prototype.toggle=function(){this.div_&&("hidden"==this.div_.style.visibility?this.show():this.hide())},CanvasOverlay.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(this.map_)},CanvasOverlay.prototype.getCanvas=function(){return this.canvas},CanvasOverlay.prototype.getContext2d=function(){return this.ctx},CanvasOverlay.prototype.setCanvasSize=function(){this.ctx.canvas.width=this.width,this.ctx.canvas.height=this.height,this.div_.style.width=this.width+"px",this.div_.style.height=this.height+"px"},CanvasOverlay.prototype.initImage=function(){this.setCanvasSize(),this.ctx.save(),this.ctx.translate(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.ctx.rotate(this.angle),this.ctx.drawImage(this.image_,-this.width/2,-this.height/2,this.width,this.height),this.ctx.restore()},CanvasOverlay.prototype.drawBoundingCanvas=function(){var e=getRotationDegrees($("#canvas_editor")),n=deg2rad(e);$("#canvas_editor").css({"-moz-transform":"rotate(0deg)","-webkit-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)","-o-transform":"rotate(0deg)",transform:"rotate(0deg)"});var i,o=getPositionData($("#canvas_editor")),t=o.left,a=o.top,r=t+this.width/2,l=a+this.height/2,s=r+(t-r)*Math.cos(n)+(a-l)*Math.sin(n),d=l-(t-r)*Math.sin(n)+(a-l)*Math.cos(n),c=r+(t+this.width-r)*Math.cos(n)+(a-l)*Math.sin(n),p=l-(t+this.width-r)*Math.sin(n)+(a-l)*Math.cos(n),u=r+(t-r)*Math.cos(n)+(a+this.height-l)*Math.sin(n),g=l-(t-r)*Math.sin(n)+(a+this.height-l)*Math.cos(n),m=r+(t+this.width-r)*Math.cos(n)+(a+this.height-l)*Math.sin(n),f=l-(t+this.width-r)*Math.sin(n)+(a+this.height-l)*Math.cos(n),h=Math.max(s,c,u,m),y=Math.max(d,p,g,f),_=Math.min(s,c,u,m),P=Math.min(d,p,g,f),v=P,S=_,A=h-_,b=y-P;$("#canvas_editor").css({top:v+"px",left:S+"px"}),this.ctx.canvas.width=A,this.ctx.canvas.height=b,this.ctx.save(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.translate(r-S,l-v),this.ctx.rotate(n),this.ctx.drawImage(this.image_,-this.width/2,-this.height/2,this.width,this.height),this.ctx.restore(),this.top=v,this.left=S,null!=(i=this.getProjection())&&(this.bottom_left_coords=i.fromContainerPixelToLatLng(new google.maps.Point(this.left,this.top+b),!0),this.top_right_coords=i.fromContainerPixelToLatLng(new google.maps.Point(this.left+A,this.top),!0))};var LPUtils;getPositionData=function(e){return $.extend({width:e.outerWidth(!1),height:e.outerHeight(!1)},e.offset())};function hexToBase64(e){return btoa(String.fromCharCode.apply(null,e.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")))}function base64_encode(e){var n,i,o,t,a,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=0,s=0,d="",c=[];if(!e)return e;for(;n=(a=e.charCodeAt(l++)<<16|e.charCodeAt(l++)<<8|e.charCodeAt(l++))>>18&63,i=a>>12&63,o=a>>6&63,t=63&a,c[s++]=r.charAt(n)+r.charAt(i)+r.charAt(o)+r.charAt(t),l<e.length;);d=c.join("");var p=e.length%3;return(p?d.slice(0,p-3):d)+"===".slice(p||3)}function USGSOverlay(e,n,i){this.bounds_=e,this.image_=n,this.image64=n,this.map_=i,this.div_=null,this.setMap(i)}(LPUtils={}).isNullOrUndefined=function(e){return null==e},LPUtils.isStringEmptyNullUndefined=function(e){return!e||0===e.length},LPUtils.isStringBlankNullUndefined=function(e){return!e||/^\s*$/.test(e)},LPUtils.alert=function(e){document.getElementById("notification_panel").innerHTML='<alert type="error" close="LPUtils.closeAlert()">'+e+"</alert>"},LPUtils.closeAlert=function(){document.getElementById("notification_panel").getEl.innerHTML=""},LPUtils.success=function(e){document.getElementById("notification_panel").innerHTML='<alert type="success">'+e+"</alert>"},LPUtils.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var n,i,o,t,a,r,l,s="",d=0;for(e=LPUtils.Base64._utf8_encode(e);d<e.length;)t=(n=e.charCodeAt(d++))>>2,a=(3&n)<<4|(i=e.charCodeAt(d++))>>4,r=(15&i)<<2|(o=e.charCodeAt(d++))>>6,l=63&o,isNaN(i)?r=l=64:isNaN(o)&&(l=64),s=s+this._keyStr.charAt(t)+this._keyStr.charAt(a)+this._keyStr.charAt(r)+this._keyStr.charAt(l);return s},decode:function(e){var n,i,o,t,a,r,l="",s=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");s<e.length;)n=this._keyStr.indexOf(e.charAt(s++))<<2|(t=this._keyStr.indexOf(e.charAt(s++)))>>4,i=(15&t)<<4|(a=this._keyStr.indexOf(e.charAt(s++)))>>2,o=(3&a)<<6|(r=this._keyStr.indexOf(e.charAt(s++))),l+=String.fromCharCode(n),64!=a&&(l+=String.fromCharCode(i)),64!=r&&(l+=String.fromCharCode(o));return l=LPUtils.Base64._utf8_decode(l)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var n="",i=0;i<e.length;i++){var o=e.charCodeAt(i);o<128?n+=String.fromCharCode(o):(127<o&&o<2048?n+=String.fromCharCode(o>>6|192):(n+=String.fromCharCode(o>>12|224),n+=String.fromCharCode(o>>6&63|128)),n+=String.fromCharCode(63&o|128))}return n},_utf8_decode:function(e){for(var n="",i=0;i<e.length;){var o=e.charCodeAt(i);if(o<128)n+=String.fromCharCode(o),i++;else if(191<o&&o<224){var t=e.charCodeAt(i+1);n+=String.fromCharCode((31&o)<<6|63&t),i+=2}else{t=e.charCodeAt(i+1);var a=e.charCodeAt(i+2);n+=String.fromCharCode((15&o)<<12|(63&t)<<6|63&a),i+=3}}return n}},LPUtils.Base64Binary={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",decodeArrayBuffer:function(e){var n=e.length/4*3,i=new ArrayBuffer(n);return this.decode(e,i),i},decode:function(e,n){var i,o,t,a,r,l,s,d=this._keyStr.indexOf(e.charAt(e.length-1)),c=this._keyStr.indexOf(e.charAt(e.length-2)),p=e.length/4*3;64==d&&p--,64==c&&p--;var u=0,g=0;for(i=n?new Uint8Array(n):new Uint8Array(p),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),u=0;u<p;u+=3)o=this._keyStr.indexOf(e.charAt(g++))<<2|(r=this._keyStr.indexOf(e.charAt(g++)))>>4,t=(15&r)<<4|(l=this._keyStr.indexOf(e.charAt(g++)))>>2,a=(3&l)<<6|(s=this._keyStr.indexOf(e.charAt(g++))),i[u]=o,64!=l&&(i[u+1]=t),64!=s&&(i[u+2]=a);return i}},USGSOverlay.prototype=new google.maps.OverlayView,USGSOverlay.prototype.onAdd=function(){var e=document.createElement("div");e.id="ground_overlay",e.style.borderStyle="none",e.style.borderWidth="0px",e.style.position="absolute";var n=document.createElement("img");n.src=this.image64,n.style.width="100%",n.style.height="100%",n.style.position="absolute",e.appendChild(n),this.div_=e,this.getPanes().overlayLayer.appendChild(e)},USGSOverlay.prototype.draw=function(){var e=this.getProjection(),n=e.fromLatLngToDivPixel(this.bounds_.getSouthWest()),i=e.fromLatLngToDivPixel(this.bounds_.getNorthEast()),o=this.div_;o.style.left=n.x+"px",o.style.top=i.y+"px",o.style.width=i.x-n.x+"px",o.style.height=n.y-i.y+"px"},USGSOverlay.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_),this.div_=null},app.controller("AlertController",["$rootScope","$scope","AnyplaceService",function(e,n,i){n.anyService=i,n.alerts=i.alerts,n.closeable=!0}]),app.controller("BuildingController",["$cookieStore","$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(e,m,l,d,s,g){function n(){return(65536*(1+Math.random())|0).toString(16).substring(1)}m.myMarkers={},m.myMarkerId=0,m.laship=33,m.loship=33,m.moveShip=0,m.ShipInterval,m.gmapService=d,m.anyService=s,m.anyAPI=g,m.example9model=[],m.example9data=[],m.example9settings={enableSearch:!0,scrollable:!0},m.example9modeledit=[],m.example9dataedit=[],m.example9settingsedit={enableSearch:!0,scrollable:!0},m.myBuildings=[],m.myShips=[],m.myBuildingsHashT={},m.myCampus=[],m.old_campus=[],m.crudTabSelected=1,m.fileToUpload="",m.logfile="",m.poisTypes={},m.catTypes={},m.pageLoad=!1,m.crudTabSelected=1,m.setCrudTabSelected=function(e){if(m.crudTabSelected=e,m.anyService.getBuilding()){var n=m.myBuildingsHashT[m.anyService.getBuildingId()];if(n){var i=n.marker;i&&(2===e?i.setDraggable(!0):i.setDraggable(!1))}}else h("No building is selected.")},m.isCrudTabSelected=function(e){return m.crudTabSelected===e},m.$on("loggedIn",function(e,n){m.fetchAllBuildings(),m.fetchAllCampus()}),m.$on("loggedOff",function(e,n){t(),m.myMarkers={},m.myMarkerId=0,m.myBuildings=[],m.myBuildingsHashT={}});var i=(n()+n()+"-"+n()+"-4"+n().substr(0,3)+"-"+n()+"-"+n()+n()+n()).toLowerCase(),o=new Date;document.getElementById("CampusID").value="cuid_"+i+"_"+o.getTime(),$("#input-logo").change(function(e){var n=new FileReader;n.onload=function(e){(new Image).src=e.target.result},n.readAsDataURL(e.target.files[0])}),m.setLogoPlan=function(e){var n={is_published:"true",cuid:e,logo:String(m.newFloorNumber),description:String(m.newFloorNumber),floor_number:String(m.newFloorNumber)};m.myFloors[m.myFloorId]=n,m.myFloorId++,canvasOverlay.drawBoundingCanvas();var i=canvasOverlay.bottom_left_coords,o=canvasOverlay.top_right_coords;m.data.floor_plan_coords.bottom_left_lat=i.lat(),m.data.floor_plan_coords.bottom_left_lng=i.lng(),m.data.floor_plan_coords.top_right_lat=o.lat(),m.data.floor_plan_coords.top_right_lng=o.lng(),m.data.floor_plan_coords.zoom=d.gmap.getZoom()+"";var t=canvasOverlay.getCanvas().toDataURL("image/png");m.data.floor_plan_base64_data=t;var a=new google.maps.LatLngBounds(new google.maps.LatLng(i.lat(),i.lng()),new google.maps.LatLng(o.lat(),o.lng()));if(m.data.floor_plan_groundOverlay=new USGSOverlay(a,t,d.gmap),canvasOverlay.setMap(null),$("#input-floor-plan").prop("disabled",!1),m.isCanvasOverlayActive=!1,_floorNoExists(m.newFloorNumber))for(var r=0;r<m.xFloors.length;r++){var l=m.xFloors[r];if(!LPUtils.isNullOrUndefined(l)&&l.floor_number===String(m.newFloorNumber)){m.uploadFloorPlanBase64(m.anyService.selectedBuilding,l,m.data);break}}else m.addFloorObject(n,m.anyService.selectedBuilding,m.data)},m.$watch("anyService.selectedBuilding",function(e,n){e&&e.coordinates_lat&&e.coordinates_lon&&(m.gmapService.gmap.panTo(c(e)),m.gmapService.gmap.setZoom(19),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastBuilding",e.buid)),m.poisTypes=["Disabled Toilets","Elevator","Entrance","Fire Extinguisher","First Aid/AED","Kitchen","Office","Ramp","Room","Security/Guard","Stair","Toilets","Other"]}),m.$watch("anyService.selectedCampus",function(e,n){e&&e.cuid&&"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastCampus",e.cuid)});function f(e){m.anyService.addAlert("success",e)}var t=function(){for(var e in m.myBuildingsHashT)m.myBuildingsHashT.hasOwnProperty(e)&&(m.myBuildingsHashT[e].marker.setMap(null),delete m.myBuildingsHashT[e])},h=function(e){m.anyService.addAlert("danger",e)},c=function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}};m.fetchAllPoisTypes=function(){var e={};(e.username=m.creds.username,e.password=m.creds.password,e.access_token=m.gAuth.access_token,e.owner_id=m.owner_id,e.owner_id)?m.anyAPI.retrievePoisTypes(e).then(function(e){var n=e.data;m.catTypes=n.poistypes},function(e){e.data;h("Something went wrong while fetching POIs types")}):h("Could nor authorize user. Please refresh.1")},m.fetchAllBuildings=function(){var e={};(e.username=m.creds.username,e.password=m.creds.password,e.owner_id=m.owner_id,e.owner_id)?m.anyAPI.allBuildings(e).then(function(e){var n=e.data;for(var i in m.myBuildings=[],m.myShips=[],n.buildings){"ship"==n.buildings[i].buid.split("_",1)?m.myShips.push(n.buildings[i]):m.myBuildings.push(n.buildings[i])}var t=new google.maps.InfoWindow({content:"-",maxWidth:500}),o=-1,a=void 0;"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastBuilding")&&(a=localStorage.getItem("lastBuilding"));for(i=0;i<n.buildings.length;i++){var r=n.buildings[i];if(m.example9data[i]={id:r.buid,label:r.name},m.example9dataedit[i]={id:r.buid,label:r.name},a&&a===r.buid&&(o=i),"true"===r.is_published||1==r.is_published?r.is_published=!0:r.is_published=!1,"ship"==r.buid.split("_",1))var l=new google.maps.Marker({position:c(r),map:d.gmap,icon:new google.maps.MarkerImage("build/images/ship_icon.png",null,null,null,new google.maps.Size(54,54)),draggable:!1}),s='<div class="infowindow-scroll-fix"><h5>Ship:</h5><span>'+r.name+'</span><h5>Description:</h5><textarea class="infowindow-text-area"  rows="3" readonly>'+r.description+"</textarea></div>";else l=new google.maps.Marker({position:c(r),map:d.gmap,icon:new google.maps.MarkerImage("build/images/building-icon.png",null,null,null,new google.maps.Size(54,54)),draggable:!1}),s='<div class="infowindow-scroll-fix"><h5>Building:</h5><span>'+r.name+'</span><h5>Description:</h5><textarea class="infowindow-text-area"  rows="3" readonly>'+r.description+"</textarea></div>";l.infoContent=s,l.building=r,m.myBuildingsHashT[r.buid]={marker:l,model:r},google.maps.event.addListener(l,"click",function(){t.setContent(this.infoContent),t.open(d.gmap,this);m.anyService.selectedBuilding=this.building;var i=this.building.buid;if("ship"==i.split("_",1)){function e(){var e=m.myBuildingsHashT[i].marker;m.laship=parseFloat(m.laship)+1e-4,m.loship=parseFloat(m.loship)+1e-4;var n={lat:parseFloat(m.laship),lng:parseFloat(m.loship)};e.setPosition(n),console.log("its work")}if(0==m.moveShip?(m.moveShip=1,console.log("stop")):m.moveShip=0,0==m.moveShip){clearInterval(m.ShipInterval);var n=m.myBuildingsHashT[i];console.log(m.myBuildingsHashT[i]),console.log(n.model.coordinates_lat);var o={lat:parseFloat(n.model.coordinates_lat),lng:parseFloat(n.model.coordinates_lon)};console.log(o),n.marker.setPosition(o)}else e(),m.ShipInterval=setInterval(function(){e()},1e4)}}),console.log("dfgg ")}0<=o?m.anyService.selectedBuilding=m.myBuildings[o]:m.myBuildings[0]&&(m.anyService.selectedBuilding=m.myBuildings[0])},function(e){e.data;h("Something went wrong while fetching buildings.")}):h("Could nor authorize user. Please refresh.")},m.addNewBuilding=function(i){if(m.myMarkers[i]&&m.myMarkers[i].marker){var e,o,t=m.myMarkers[i].model;if(t.owner_id=m.owner_id,!t.owner_id)return void h("Could not authorize user. Please refresh.");if(t.coordinates_lat=String(m.myMarkers[i].marker.position.lat()),t.coordinates_lon=String(m.myMarkers[i].marker.position.lng()),void 0===t.coordinates_lat||null===t.coordinates_lat)return void h("Invalid building latitude.");if(void 0===t.coordinates_lon||null===t.coordinates_lon)return void h("Invalid building longitude.");if(!0===t.is_published?t.is_published="true":t.is_published="false",t.description||(t.description="-"),t.owner_id&&t.name&&t.description&&t.is_published&&t.url&&t.address)o=0==shipselect?(e=m.anyAPI.addBuilding(t),1):(e=m.anyAPI.addShip(t),0),e.then(function(e){var n=e.data;console.log("new buid: "+n.buid),t.buid=n.buid,"true"===t.is_published||1==t.is_published?t.is_published=!0:t.is_published=!1,0==shipselect?(m.myBuildings.push(t),m.anyService.selectedBuilding=m.myBuildings[m.myBuildings.length-1]):m.myShips.push(t),m.myMarkers[i].marker.setDraggable(!1),m.myBuildingsHashT[t.buid]={marker:m.myMarkers[i].marker,model:t},m.myMarkers[i].infowindow&&(m.myMarkers[i].infowindow.setContent(m.myMarkers[i].marker.tpl2[0]),m.myMarkers[i].infowindow.close()),f(o?"Building added successfully.":"Ship added successfully.")},function(e){var n=e.data;h("Something went wrong while adding the building. "+n.message)});else h("Some required fields are missing.")}},m.deleteBuilding=function(){var t=m.anyService.getBuilding(),e=m.creds;m.owner_id?(e.owner_id=m.owner_id,console.log(e.owner_id),t&&t.buid?(e.buid=t.buid,m.anyAPI.deleteBuilding(e).then(function(e){e.data;console.log("building deleted: ",t),m.myBuildingsHashT[t.buid].marker.setMap(null),delete m.myBuildingsHashT[t.buid];for(var n=m.myBuildings,i=n.length,o=0;o<i;o++)if(n[o].buid==t.buid){n.splice(o,1);break}m.myBuildings&&0<m.myBuildings.length&&(m.anyService.selectedBuilding=m.myBuildings[0]),m.setCrudTabSelected(1),f("Successfully deleted building.")},function(e){e.data;h("Something went wrong. It's likely that everything related to the building is deleted but please refresh to make sure or try again.")})):h("No building selected for deletion.")):h("Could not identify user. Please refresh and sign in again.")},m.deleteRadiomaps=function(){var e={buid:m.anyService.getBuildingId(),floor:m.anyService.getFloorNumber()};e.username=m.creds.username,e.password=m.creds.password,m.anyAPI.deleteRadiomaps(e).then(function(e){f("Successfully Delete floor radiomap")},function(e){e.data;h("Something went wrong.The file is not exist ")})},m.updateBuilding=function(){var n=m.anyService.getBuilding();if(LPUtils.isNullOrUndefined(n)||LPUtils.isNullOrUndefined(n.buid))h("No building selected found.");else{var e={};if(e=m.creds,m.owner_id){e.owner_id=m.owner_id,e.buid=n.buid,n.description&&(e.description=n.description),n.name&&(e.name=n.name),!0===n.is_published||"true"==n.is_published?e.is_published="true":e.is_published="false",n.bucode&&(e.bucode=n.bucode);var i=m.myBuildingsHashT[n.buid].marker;if(i){var o=i.position;o&&o.lat()&&o.lng()&&(e.coordinates_lat=String(o.lat()),e.coordinates_lon=String(o.lng()))}m.anyAPI.updateBuilding(e).then(function(e){e.data;"true"===n.is_published||1==n.is_published?n.is_published=!0:n.is_published=!1,f("Successfully updated building.")},function(e){var n=e.data;h("Something went wrong while updating building. "+n.message)})}else h("Could not identify user. Please refresh and sign in again.")}},m.fetchAllCampus=function(){var e={};(e.username=m.creds.username,e.password=m.creds.password,e.owner_id=m.owner_id,m.myCampus=[],e.owner_id)?m.anyAPI.allCampus(e).then(function(e){var n=e.data;m.myCampus=n.buildingsets;var i=-1,o=void 0;"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastCampus")&&(o=localStorage.getItem("lastCampus"));for(var t=0;t<m.myCampus.length;t++){var a=m.myCampus[t];o&&o===a.cuid&&(i=t)}0<=i?m.anyService.selectedCampus=m.myCampus[i]:m.myCampus[0]&&(m.anyService.selectedCampus=m.myCampus[0])},function(e){e.data;h("Something went wrong while fetching buildings.")}):h("Could nor authorize user. Please refresh.")},m.updateCampus=function(){var e=m.anyService.getCampus();if(LPUtils.isNullOrUndefined(e)||LPUtils.isNullOrUndefined(e.cuid))h("No campus selected found.");else{var n={};if(n=m.creds,m.owner_id){n.owner_id=m.owner_id,n.cuid=e.cuid,e.description&&(n.description=e.description),e.name&&(n.name=e.name),e.newcuid&&(n.newcuid=e.newcuid);var i=m.example9modeledit.length;if(0!=i){for(var o='"buids":[',t=i-1;0<t;t--)o=o+'"'+m.example9modeledit[t].id+'",';o=o+'"'+m.example9modeledit[0].id+'"]',n.greeklish=document.getElementById("Greeklish-OnOffedit").checked,n.buids=o,m.anyAPI.updateCampus(n).then(function(e){e.data;document.getElementById("CampusIDeditnew").value="",f("Successfully updated campus.")},function(e){var n=e.data;h("Something went wrong while updating campus. "+n.message)})}else h("No buildings selected.")}else h("Could not identify user. Please refresh and sign in again.")}},m.deleteCampus=function(){var t=m.anyService.getCampus(),e=m.creds;m.owner_id?(e.owner_id=m.owner_id,t&&t.cuid?(e.cuid=t.cuid,m.anyAPI.deleteCampus(e).then(function(e){e.data;console.log("campus deleted: ",t);for(var n=m.myCampus,i=n.length,o=0;o<i;o++)if(n[o].cuid==t.cuid){n.splice(o,1);break}m.myCampus&&0<m.myCampus.length?m.anyService.selectedCampus=m.myCampus[0]:0==m.myCampus.length&&(m.anyService.selectedCampus=void 0),m.setCrudTabSelected(1),f("Successfully deleted campus.")},function(e){e.data;h("Something went wrong. It's likely that everything related to the campus is deleted but please refresh to make sure or try again.")})):h("No Campus selected for deletion.")):h("Could not identify user. Please refresh and sign in again.")},m.addCampus=function(){var e='"name":"'+document.getElementById("CampusName").value+'"';0==document.getElementById("CampusDescription").value.localeCompare("")&&(document.getElementById("CampusDescription").value="-");var n='"description":"'+(n=document.getElementById("CampusDescription")).value+'"',i='"cuid":"'+(i=document.getElementById("CampusID")).value+'"',o=document.getElementById("Greeklish-OnOff").checked;o='"greeklish":"'+o+'"';var t=m.example9model.length;if(0!=t){for(var r='"buids":[',a=t-1;0<a;a--)r=r+'"'+m.example9model[a].id+'",';var l="{"+o+","+(r=r+'"'+m.example9model[0].id+'"]')+","+i+","+n+","+e+',"owner_id":"'+m.owner_id+'","access_token":"'+m.gAuth.access_token+'"}';m.anyAPI.addBuildingSet(l).then(function(e){var n=e.data,i={};function o(){return(65536*(1+Math.random())|0).toString(16).substring(1)}i.name=document.getElementById("CampusName").value,i.buids=r.buids,i.description=document.getElementById("CampusDescription").value,i.cuid=n.cuid,m.myCampus.push(i),m.anyService.selectedCampus=m.myCampus[m.myCampus.length-1],f("Successfully added campus.");var t=(o()+o()+"-"+o()+"-4"+o().substr(0,3)+"-"+o()+"-"+o()+o()+o()).toLowerCase(),a=new Date;document.getElementById("CampusID").value="cuid_"+t+"_"+a.getTime()},function(e){var n=e.data;h("Something went wrong while adding the building. "+n.message)})}else h("No buildings selected.")};var a=new google.maps.OverlayView;if(a.draw=function(){},a.setMap(d.gmap),$("#draggable-building").draggable({helper:"clone",stop:function(e){var n=new google.maps.Point(e.pageX,e.pageY),i=a.getProjection().fromContainerPixelToLatLng(n);m.placeMarker(i),shipselect=0}}),$("#draggable-ship").draggable({helper:"clone",stop:function(e){var n=new google.maps.Point(e.pageX,e.pageY),i=a.getProjection().fromContainerPixelToLatLng(n);m.placeMarkership(i),shipselect=1}}),m.placeMarkership=function(e){var n=m.myMarkers[m.myMarkerId-1];if(n&&n.marker&&n.marker.getMap()&&n.marker.getDraggable())console.log("there is a building pending, please add 1 at a time");else{var i=new google.maps.Marker({position:e,map:d.gmap,icon:"build/images/ship_icon.png",draggable:!0}),o=new google.maps.InfoWindow({content:"-",maxWidth:500});m.$apply(function(){i.myId=m.myMarkerId,m.myMarkers[i.myId]={},m.myMarkers[i.myId].model={description:"",name:void 0,is_published:!0,address:"-",url:"-",bucode:""},m.myMarkers[i.myId].marker=i,m.myMarkers[i.myId].infowindow=o,m.myMarkerId++});var t='<form name="buildingForm" class="infowindow-scroll-fix"><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.bucode" id="building-code" type="text" class="form-control" placeholder="Building Code (Optional)"/></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.name" id="building-name" type="text" class="form-control" placeholder="Building Name *"/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+i.myId+'].model.description" id="building-description" type="text" class="form-control" placeholder="Building Description (Optional)"></textarea></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.is_published" id="building-published" type="checkbox"><span> Make building public to view.</span></fieldset><fieldset class="form-group"></fieldset class="form-group"><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addNewBuilding('+i.myId+')"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempBuilding('+i.myId+')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form>',a='<div class="infowindow-scroll-fix"><h5 style="margin: 0">Building:</h5><span>{{myMarkers['+i.myId+'].model.name}}</span><h5 style="margin: 8px 0 0 0">Description:</h5><span>{{myMarkers['+i.myId+"].model.description}}</span></div>",r=l(t)(m);i.tpl2=l(a)(m),o.setContent(r[0]),o.open(d.gmap,i),google.maps.event.addListener(i,"click",function(){o.getMap()||o.open(d.gmap,i)})}},m.placeMarker=function(e){var n=m.myMarkers[m.myMarkerId-1];if(n&&n.marker&&n.marker.getMap()&&n.marker.getDraggable())console.log("there is a building pending, please add 1 at a time");else{var i=new google.maps.Marker({position:e,map:d.gmap,icon:"build/images/building-icon.png",draggable:!0}),o=new google.maps.InfoWindow({content:"-",maxWidth:500});m.$apply(function(){i.myId=m.myMarkerId,m.myMarkers[i.myId]={},m.myMarkers[i.myId].model={description:"",name:void 0,is_published:!0,address:"-",url:"-",bucode:""},m.myMarkers[i.myId].marker=i,m.myMarkers[i.myId].infowindow=o,m.myMarkerId++});var t='<form name="buildingForm" class="infowindow-scroll-fix"><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.bucode" id="building-code" type="text" class="form-control" placeholder="Building Code (Optional)"/></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.name" id="building-name" type="text" class="form-control" placeholder="Building Name *"/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+i.myId+'].model.description" id="building-description" type="text" class="form-control" placeholder="Building Description (Optional)"></textarea></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.is_published" id="building-published" type="checkbox"><span> Make building public to view.</span></fieldset><fieldset class="form-group"></fieldset class="form-group"><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addNewBuilding('+i.myId+')"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempBuilding('+i.myId+')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form>',a='<div class="infowindow-scroll-fix"><h5 style="margin: 0">Building:</h5><span>{{myMarkers['+i.myId+'].model.name}}</span><h5 style="margin: 8px 0 0 0">Description:</h5><span>{{myMarkers['+i.myId+"].model.description}}</span></div>",r=l(t)(m);i.tpl2=l(a)(m),o.setContent(r[0]),o.open(d.gmap,i),google.maps.event.addListener(i,"click",function(){o.getMap()||o.open(d.gmap,i)})}},m.deleteTempBuilding=function(e){var n=m.myMarkers[e];n&&n.marker&&n.marker.setMap(null)},m.exportBuildingToJson=function(){var c={building:{floors:[]}},p=m.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(p))h("No building selected");else{c.building.buid=p.buid,c.building.name=p.name,c.building.description=p.description,c.building.coordinates_lat=p.coordinates_lat,c.building.coordinates_lon=p.coordinates_lon;var e=s.jsonReq;e.buid=p.buid;var u=0;g.allBuildingFloors(e).then(function(e){var n,s=e.data.floors,d=[];if(s)for(var i=0;i<s.length;i++)n={buid:p.buid,floor_number:s[i].floor_number},g.retrievePoisByBuildingFloor(n).then(function(e){var n=e.data.pois;if(n){for(var i=[],o=n[0].floor_number,t=0;t<n.length;t++){var a=n[t];if("None"!=a.pois_type){if(a.overwrite)var r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:a.overwrite};else r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:"false"};i.push(r)}}if(d.push({floor_number:o,pois:i}),++u===s.length){c.building.floors=d,f("Successfully exported "+p.name+" to JSON.");var l=new Blob([JSON.stringify(c,null,4)],{type:"text/plain;charset=utf-8"});saveAs(l,p.name.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt")}}},function(e){var n=e.data;console.log(n.message)})},function(e){console.log(e.data.message)})}},m.exportCampusToJson=function(){var e={campus:{buids:[]}},n=m.anyService.selectedCampus;if(LPUtils.isNullOrUndefined(n))h("No campus selected");else{e.campus.name=n.name,e.campus.description=n.description,e.campus.buids=n.buids,f("Successfully exported "+n.name+" to JSON.");var i=new Blob([JSON.stringify(e,null,4)],{type:"text/plain;charset=utf-8"});saveAs(i,n.name.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt")}},document.getElementById("file-input").addEventListener("change",function(e){var n=e.target.files[0];if(n){var i=new FileReader;i.onload=function(e){var n=e.target.result;m.fileToUpload=n},i.readAsText(n)}},!1),m.anyService.downloadlogfile=!1,m.importBuildingFromJson=function(){var e,n,i=m.anyService.progress=0,o=0;""==m.fileToUpload&&h("Something went wrong no file selected");var t=JSON.parse(m.fileToUpload);for(e=0;e<t.building.floors.length;e++)for(n=0;n<t.building.floors[e].pois.length;n++)"true"==t.building.floors[e].pois[n].overwrite&&i++;for(0==i&&h("Something went wrong no pois to update"),e=0;e<t.building.floors.length;e++)for(n=0;n<t.building.floors[e].pois.length;n++)"true"==t.building.floors[e].pois[n].overwrite&&(o++,m.updatePoifromFile(t.building.floors[e].pois[n].puid,t.building.floors[e].pois[n].coordinates_lat,t.building.floors[e].pois[n].coordinates_lon,t.building.floors[e].pois[n].name,t.building.floors[e].pois[n].description,t.building.floors[e].pois[n].pois_type,t.building.floors[e].pois[n].overwrite,t.building.buid,e,n,i,o,t.building.name))},m.allpois={},m.pois={},m.importBuildingFromExcel=function(e){m.anyService.progress=0;var n=document.getElementById("my_file_input").files[0];m.fileToUpload=n.name;var i=new FileReader;i.onload=function(e){var n=e.target.result,i=XLS.CFB.read(n,{type:"binary"}),o=XLS.parse_xlscfb(i);o.SheetNames.forEach(function(e){var n=XLS.utils.sheet_to_row_object_array(o.Sheets[e]);m.uploadloop(0,n,"")})},i.readAsBinaryString(n)},m.uploadloop=function(e,n,i){for(var o=e;o<n.length;o++){if(i!=n[o].buid&&null!=n[o].buid)return m.pois={},i=n[o].buid,void m.fetchAllPoisForBuilding(n[o].buid,n,o,i);var t="";null!=n[o].des3&&""!=n[o].des3&&null!=n[o].des3?null!=n[o].des4&&""!=n[o].des4&&null!=n[o].des4?t=t+n[o].des3+" "+n[o].des4:t+=n[o].des3:null!=n[o].des4&&""!=n[o].des4&&null!=n[o].des4&&(t+=n[o].des4),null!=n[o].des1&&""!=n[o].des1&&null!=n[o].des1&&(""!=t?t=t+"\n"+n[o].des1:t+=n[o].des1),null!=n[o].des2&&""!=n[o].des2&&null!=n[o].des2&&(""!=t?t=t+"\n"+n[o].des2:t+=n[o].des2),m.anyService.progress=o/(n.length-1)*100,n.length-1==0&&(m.anyService.progress=100),m.pois[n[o].name]?m.updatePoifromExcel(m.pois[n[o].name].puid,m.pois[n[o].name].coordinates_lat,m.pois[n[o].name].coordinates_lon,m.pois[n[o].name].is_building_entrance,n[o].name,t,m.pois[n[o].name].pois_type,m.pois[n[o].name].overwrite,m.pois[n[o].name].buid,""):m.updatePoifromExcel("","","","",n[o].name,t,"","","","")}},m.fetchAllPoisForBuilding=function(e,t,a,r){var n=s.jsonReq;n.buid=e,g.retrievePoisByBuilding(n).then(function(e){var n=e.data;m.myPois=n.pois;for(var i=m.myPois.length-1;0<=i;i--){var o=m.myPois[i].name;m.pois[o]=m.myPois[i]}m.uploadloop(a,t,r)},function(e){e.data;h("Something went wrong while fetching POIs")})},m.logfile={pois:[]},m.updatePoifromExcel=function(i,e,n,o,t,a,r,l,s,d){var c={};c.username=m.creds.username,c.password=m.creds.password,c.owner_id=m.owner_id,c.coordinates_lat=e,c.coordinates_lon=n,c.is_building_entrance=o,c.name=t,c.puid=i,c.description=a,c.pois_type=r,c.overwrite="false",c.buid=s,m.anyAPI.updatePois(c).then(function(e){e.data;if(100==m.anyService.progress)if(m.anyService.downloadlogfile){m.anyService.downloadlogfile=!1,f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(m.fileToUpload+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),setTimeout(function(){m.anyService.progress=void 0},2500)}else f("Successfully updated POIs."),setTimeout(function(){m.anyService.progress=void 0,location.reload()},2500)},function(e){e.data;if(m.logfile.pois.push({name:t,puid:i,description:a,status:"Something went wrong while updating POI."}),m.anyService.downloadlogfile=!0,100==m.anyService.progress){m.anyService.downloadlogfile=!1,f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(m.fileToUpload+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),m.logfile.pois=[],setTimeout(function(){m.anyService.progress=void 0},2500)}})},m.updatePoifromFile=function(i,e,n,o,t,a,r,l,s,d,c,p,u){var g={};g.username=m.creds.username,g.password=m.creds.password,g.owner_id=m.owner_id,g.coordinates_lat=e,g.coordinates_lon=n,g.name=o,g.puid=i,g.description=t,g.pois_type=a,g.overwrite="false",g.buid=l,m.anyAPI.updatePois(g).then(function(e){e.data;if(m.anyService.progress=p/c*100,100==m.anyService.progress)if(m.anyService.downloadlogfile){f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(u+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),setTimeout(function(){m.anyService.progress=void 0},2500)}else f("Successfully updated POIs."),setTimeout(function(){m.anyService.progress=void 0,location.reload()},2500)},function(e){e.data;if(m.logfile.pois.push({name:o,puid:i,description:t,status:"Something went wrong while updating POI."}),m.anyService.downloadlogfile=!0,m.anyService.progress=p/c*100,100==m.anyService.progress)if(m.anyService.downloadlogfile){f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(u+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),m.logfile.pois=[],setTimeout(function(){m.anyService.progress=void 0},2500)}else f("Successfully updated POIs."),setTimeout(function(){m.anyService.progress=void 0,location.reload()},2500)})},m.Poisresult={building:{floors:[]}},m.Connectionsresult={building:{}},m.zip=new JSZip,m.DownloadBackup=function(){var o=m.anyService.selectedBuilding,l=[],e=s.jsonReq;e.buid=o.buid,m.anyService.progress=0,g.allBuildingFloors(e).then(function(e){l=e.data.floors;for(var a="",n=0;n<l.length;n++)a=0==n?l[n].floor_number:a+" "+l[n].floor_number;m.anyService.progress=10;var r=o.buid,i=s.jsonReq;g.downloadFloorPlanAll(i,r,a).then(function(e){for(var n=e.data,i=m.zip.folder("floor_plans"),o=0;o<n.all_floors.length;o++)""!=n.all_floors[o]&&i.file(l[o].floor_number+".png",n.all_floors[o],{base64:!0});m.anyService.progress=25;var t=s.jsonReq;t.buid=r,t.floor=a,g.getRadioByBuildingFloorAll(t).then(function(e){var n=e.data,i=m.zip.folder("radiomaps");if(n.rss_log_files)for(var o=0;o<n.rss_log_files.length;o++)i.file(l[o].floor_number+"-radiomap.txt",n.rss_log_files[o]);m.anyService.progress=70,m.exportPoisBuildingToJson()},function(e){})},function(e){})},function(e){console.log(e.data.message),h("Something went wrong while fetching all floors")})},m.exportPoisBuildingToJson=function(){var o=m.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(o))h("No building selected");else{m.Poisresult.building.buid=o.buid,m.Poisresult.building.name=o.name,m.Poisresult.building.description=o.description,m.Poisresult.building.coordinates_lat=o.coordinates_lat,m.Poisresult.building.coordinates_lon=o.coordinates_lon;var e=s.jsonReq;e.buid=o.buid;var d=0;g.allBuildingFloors(e).then(function(e){var n,l=e.data.floors,s=[];if(m.anyService.progress=80,l)for(var i=0;i<l.length;i++)n={buid:o.buid,floor_number:l[i].floor_number},g.retrievePoisByBuildingFloor(n).then(function(e){var n=e.data.pois;if(n){var i=[];if(null!=n[0]){for(var o=n[0].floor_number,t=0;t<n.length;t++){var a=n[t];if("None"!=a.pois_type){if(a.overwrite)var r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:a.overwrite};else r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:"false"};"true"==a.is_building_entrance?r.is_building_entrance="true":r.is_building_entrance="false",i.push(r)}}s.push({floor_number:o,pois:i})}++d===l.length&&(m.Poisresult.building.floors=s,m.zip.file("allpois.json",JSON.stringify(m.Poisresult,null,4)),m.anyService.progress=90,m.exportConnectionBuildingToJson())}},function(e){var n=e.data;console.log(n.message)})},function(e){console.log(e.data.message)})}},m.exportConnectionBuildingToJson=function(){var d=m.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(d))h("No building selected");else{m.Connectionsresult.building.buid=d.buid,m.Connectionsresult.building.name=d.name,m.Connectionsresult.building.description=d.description,m.Connectionsresult.building.coordinates_lat=d.coordinates_lat,m.Connectionsresult.building.coordinates_lon=d.coordinates_lon;var e=s.jsonReq;e.buid=d.buid;var c=0;g.allBuildingFloors(e).then(function(e){var n,l=e.data.floors,s=[];if(l)for(var i=0;i<l.length;i++)n={buid:d.buid,floor_number:l[i].floor_number},g.retrieveConnectionsByBuildingFloor(n).then(function(e){m.anyService.progress=100;var n=e.data.connections;if(n){var i=[];if(null!=n[0]){for(var o=n[0].floor_a,t=0;t<n.length;t++){var a=n[t],r={name:a.name,description:a.description,cuid:a.puid,weight:a.weight,pois_a:a.pois_a,pois_b:a.pois_b,floor_a:a.floor_a,floor_b:a.floor_b,is_published:a.is_published,buid_a:a.buid_a,buid_b:a.buid_b};i.push(r)}s.push({floor_number:o,connections:i})}++c===l.length&&(m.Connectionsresult.building.floors=s,m.zip.file("allconnections.json",JSON.stringify(m.Connectionsresult,null,4)),m.zip.generateAsync({type:"blob"}).then(function(e){saveAs(e,d.buid+".zip")}),m.anyService.progress=void 0)}},function(e){var n=e.data;console.log(n.message)})},function(e){console.log(e.data.message)})}},$("#dismiss").on("click",function(){"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("dismissClicked","YES")}),"YES"!==localStorage.getItem("dismissClicked")){window.onload=function(){$("#myModal_Welcome").modal("show")}}}]),app.controller("ControlBarController",["$scope","$rootScope","AnyplaceService","GMapService","AnyplaceAPIService",function(o,e,n,t,i){o.anyService=n,o.gmapService=t,o.isAuthenticated=!1,o.signInType="google",o.gAuth={},o.person=void 0,o.creds={username:"username",password:"password"},o.owner_id=void 0,o.displayName=void 0;o.setAuthenticated=function(e){o.isAuthenticated=e},o.showFullControls=!0,o.toggleFullControls=function(){o.showFullControls=!o.showFullControls};o.showGoogleID=function(){o.person&&n.addAlert("success","Your Google ID is: "+o.person.id)},o.showGoogleAuth=function(){o.gAuth&&n.addAlert("success","access_token: "+o.gAuth.access_token)},o.onSignIn=function(e){""===o.getCookie("username")&&(o.setCookie("username","true",365),location.reload()),o.setAuthenticated(!0),o.gAuth=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse(),o.gAuth.access_token=o.gAuth.id_token,app.access_token=o.gAuth.id_token,o.personLookUp(e)},o.onSignInFailure=function(){console.log("Sign-in state: Error")},window.onSignIn=o.onSignIn,window.onSignInFailure=o.onSignInFailure,o.personLookUp=function(e){o.person=e.getBasicProfile(),o.person.image=o.person.getImageUrl(),o.person.id=o.person.getId(),o.person.displayName=o.person.getName(),o.owner_id=o.person.id+"_"+o.signInType,o.displayName=o.person.displayName,o.person&&o.person.id&&o.$broadcast("loggedIn",[]),i.signAccount({name:o.person.displayName,type:"google"}).then(function(e){},function(e){})},o.signOut=function(){o.setCookie("username","",365),gapi.auth2.getAuthInstance().signOut().then(function(){console.log("User signed out.")}),o.isAuthenticated=!1,o.$broadcast("loggedOff",[]),o.gAuth={},o.owner_id=void 0,o.person=void 0},o.getCookie=function(e){for(var n=e+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(var t=i[o];" "==t.charAt(0);)t=t.substring(1);if(0==t.indexOf(n))return t.substring(n.length,t.length)}return""},o.setCookie=function(e,n,i){var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3);var t="expires="+o.toUTCString();document.cookie=e+"="+n+"; "+t},o.tab=1,o.setTab=function(e){o.tab=e},o.isTabSet=function(e){return o.tab===e},o.tab=1,o.setTab=function(e){o.tab=e},o.isTabSet=function(e){return o.tab===e};function a(e){o.anyService.addAlert("danger",e)}var r=void 0;o.userPosition=void 0;var l=!1;o.isUserLocVisible=!1,o.getIsUserLocVisible=function(){return o.isUserLocVisible},o.panToUserLocation=function(){o.userPosition&&(t.gmap.panTo(o.userPosition),t.gmap.setZoom(20))},o.displayMyLocMarker=function(e){r&&r.getMap()&&r.setPosition(e)},o.displayMyLocMarker=function(e){if(r&&r.getMap())r.setPosition(e);else{var n=new google.maps.Size(20,20);o.isFirefox&&(n=new google.maps.Size(48,48)),r=new google.maps.Marker({position:e,map:t.gmap,draggable:!1,icon:{url:"build/images/location-radius-centre.png",origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,10),size:n,scaledSize:new google.maps.Size(20,20)}})}},o.hideUserLocation=function(){r&&r.setMap(null),o.isUserLocVisible=!1},o.showUserLocation=function(){if(o.getIsUserLocVisible())return o.hideUserLocation(),void(navigator.geolocation&&navigator.geolocation.clearWatch(watchPosNum));navigator.geolocation?watchPosNum=navigator.geolocation.watchPosition(function(e){var n={lat:e.coords.latitude,lng:e.coords.longitude};o.userPosition=n,o.displayMyLocMarker(n);var i=new google.maps.InfoWindow({content:"Your current location.",maxWidth:500});google.maps.event.addListener(r,"click",function(){var e=this;o.$apply(function(){i.open(t.gmap,e)})}),o.isUserLocVisible||o.$apply(function(){o.isUserLocVisible=!0}),l||(t.gmap.panTo(n),t.gmap.setZoom(19),l=!0)},function(e){o.$apply(function(){1==e.code?a("Permission denied. Anyplace was not able to retrieve your Geolocation."):2==e.code?a("Position unavailable. The network is down or the positioning satellites couldn't be contacted."):3==e.code?a("Timeout. The request for retrieving your Geolocation was timed out."):a("There was an error while retrieving your Geolocation. Please try again.")})}):a("The Geolocation feature is not supported by this browser.")},o.centerViewToSelectedItem=function(){if(null!=o.anyService.selectedBuilding&&null!=o.anyService.selectedBuilding){var e={};if(o.anyService.selectedPoi){var n=o.anyService.selectedPoi;e={lat:parseFloat(n.coordinates_lat),lng:parseFloat(n.coordinates_lon)}}else{if(!o.anyService.selectedBuilding)return void a("No building is selected.");var i=o.anyService.selectedBuilding;e={lat:parseFloat(i.coordinates_lat),lng:parseFloat(i.coordinates_lon)}}o.gmapService.gmap.panTo(e),o.gmapService.gmap.setZoom(20)}else a("You have to select a building first")}}]);var changedfloor=!1;app.controller("FloorController",["$scope","AnyplaceService","GMapService","AnyplaceAPIService",function(l,s,d,i){var t;l.anyService=s,l.anyAPI=i,l.gmapService=d,l.xFloors=[],l.myFloors={},l.myFloorId=0;l.newFloorNumber=0;l.crudTabSelected=1,l.setCrudTabSelected=function(e){l.crudTabSelected=e},l.isCrudTabSelected=function(e){return l.crudTabSelected===e},l.data={floor_plan_coords:{},floor_plan_base64_data:{},floor_plan_groundOverlay:null},l.$on("loggedOff",function(e,n){o()});var o=function(){l.removeFloorPlan(),l.xFloors=[],l.myFloorId=0,l.myFloors={}};l.$watch("anyService.selectedBuilding",function(e,n){e&&(changedfloor=!1,l.fetchAllFloorsForBuilding(e))}),l.$watch("newFloorNumber",function(e,n){});function c(e){l.anyService.addAlert("danger",e)}function a(e){l.anyService.addAlert("success",e)}l.$watch("anyService.selectedFloor",function(e,n){null==e||_.isEqual(e,n)||(l.fetchFloorPlanOverlay(e),d.gmap.panTo(function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}}(l.anyService.selectedBuilding)),d.gmap.setZoom(19),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastFloor",e.floor_number),changedfloor=!1)}),l.fetchAllFloorsForBuilding=function(e){var n=s.jsonReq;n.buid=e.buid,i.allBuildingFloors(n).then(function(e){if(l.xFloors=e.data.floors,l.xFloors=l.xFloors.sort(function(e,n){return parseInt(e.floor_number)-parseInt(n.floor_number)}),l.anyService.availableFloors=[],l.anyService.availableFloors=l.xFloors,l.urlFloor)for(var n=0;n<l.xFloors.length;n++)if(l.urlFloor==l.xFloors[n].floor_number)return void(l.anyService.selectedFloor=l.xFloors[n]);if("undefined"!=typeof Storage&&localStorage&&!LPUtils.isNullOrUndefined(localStorage.getItem("lastBuilding"))&&!LPUtils.isNullOrUndefined(localStorage.getItem("lastFloor")))for(var i=0;i<l.xFloors.length;i++)if(String(l.xFloors[i].floor_number)===String(localStorage.getItem("lastFloor")))return void(l.anyService.selectedFloor=l.xFloors[i]);l.xFloors&&0<l.xFloors.length?l.anyService.selectedFloor=l.xFloors[0]:l.anyService.selectedFloor=void 0,r()},function(e){console.log(e.data.message),c("Something went wrong while fetching all floors")})};var r=function(){for(var e=-1,n=0;n<l.xFloors.length;n++)parseInt(l.xFloors[n].floor_number)>=e&&(e=parseInt(l.xFloors[n].floor_number));l.newFloorNumber=e+1};l.fetchFloorPlanOverlay=function(){if(function(e){return null!==e&&null!=e&&(null!==e.floor_number&&void 0!==e.floor_number)}(this.anyService.selectedFloor)){var e=this.anyService.selectedFloor.floor_number,n=this.anyService.selectedBuilding.buid;i.downloadFloorPlan(this.anyService.jsonReq,n,e).then(function(e){l.data.floor_plan_file=null,(l.data.floor_plan=null)!=l.data.floor_plan_groundOverlay&&(l.data.floor_plan_groundOverlay.setMap(null),l.data.floor_plan_groundOverlay=null);var n=e.data,i=l.anyService.selectedFloor,o=new google.maps.LatLngBounds(new google.maps.LatLng(i.bottom_left_lat,i.bottom_left_lng),new google.maps.LatLng(i.top_right_lat,i.top_right_lng));l.data.floor_plan_groundOverlay=new USGSOverlay(o,"data:image/png;base64,"+n,d.gmap)},function(e){console.log("error downloading floor plan")})}else console.log("something is wrong with the floor")};var p=null;l.isCanvasOverlayActive=!1,$("#input-floor-plan").change(function(e){var n=new FileReader;n.onload=function(e){var n=new Image;n.src=e.target.result,n.onload=function(){p=new CanvasOverlay(n,d.gmap),l.$apply(l.isCanvasOverlayActive=!0),l.data.floor_plan_groundOverlay&&l.data.floor_plan_groundOverlay.getMap()&&l.data.floor_plan_groundOverlay.setMap(null)}},n.readAsDataURL(e.target.files[0]),this.disabled=!0}),l.setFloorPlan=function(){if(p)if(d.gmap.getZoom()<20)c("You have provided zoom level "+d.gmap.getZoom()+". You have to zoom at least to level 20 to upload the floorplan.");else{null!==s.getBuildingId()&&void 0!==s.getBuildingId()||(console.log("building is undefined"),c("Something went wrong. It seems like there is no building selected"));var e={is_published:"true",buid:String(s.getBuildingId()),floor_name:String(l.newFloorNumber),description:String(l.newFloorNumber),floor_number:String(l.newFloorNumber)};l.myFloors[l.myFloorId]=e,l.myFloorId++,p.drawBoundingCanvas();var n=p.bottom_left_coords,i=p.top_right_coords;l.data.floor_plan_coords.bottom_left_lat=n.lat(),l.data.floor_plan_coords.bottom_left_lng=n.lng(),l.data.floor_plan_coords.top_right_lat=i.lat(),l.data.floor_plan_coords.top_right_lng=i.lng(),l.data.floor_plan_coords.zoom=d.gmap.getZoom()+"";var o=p.getCanvas().toDataURL("image/png");l.data.floor_plan_base64_data=o;var t=new google.maps.LatLngBounds(new google.maps.LatLng(n.lat(),n.lng()),new google.maps.LatLng(i.lat(),i.lng()));if(l.data.floor_plan_groundOverlay=new USGSOverlay(t,o,d.gmap),p.setMap(null),$("#input-floor-plan").prop("disabled",!1),l.isCanvasOverlayActive=!1,u(l.newFloorNumber))for(var a=0;a<l.xFloors.length;a++){var r=l.xFloors[a];if(!LPUtils.isNullOrUndefined(r)&&r.floor_number===String(l.newFloorNumber)){l.uploadFloorPlanBase64(l.anyService.selectedBuilding,r,l.data);break}}else l.addFloorObject(e,l.anyService.selectedBuilding,l.data)}};l.addFloorObject=function(e,n,i){var o=function(e){return e=null===e?{}:JSON.parse(JSON.stringify(e)),LPUtils.isNullOrUndefined(e.buid)&&(e.buid=""),LPUtils.isNullOrUndefined(e.floor_name)&&(e.floor_name=""),LPUtils.isNullOrUndefined(e.floor_number)&&(e.floor_number=""),LPUtils.isNullOrUndefined(e.description)&&(e.description=""),LPUtils.isNullOrUndefined(e.is_published)&&(e.is_published="true"),e}(e);(o.owner_id=l.owner_id,o.owner_id)?l.anyAPI.addFloor(o).then(function(e){e.data;l.xFloors.push(o),l.anyService.selectedFloor=l.xFloors[l.xFloors.length-1],a("Successfully added new floor"),l.uploadFloorPlanBase64(n,o,i)},function(e){var n=e.data;console.log(n.message),c("Something went wrong while adding a new floor.")}):c("Could not authorize user. Please refresh.")},l.removeFloorPlan=function(){l.data.floor_plan_file=null,l.data.floor_plan=null,p&&p.setMap(null),l.data.floor_plan_groundOverlay&&l.data.floor_plan_groundOverlay.setMap(null);var e=$("#input-floor-plan");e.replaceWith(e=e.clone(!0)),e.prop("disabled",!1),l.isCanvasOverlayActive=!1},l.deleteFloor=function(){var t=l.anyService.getFloor();LPUtils.isNullOrUndefined(t)||LPUtils.isStringBlankNullUndefined(t.floor_number)||LPUtils.isStringBlankNullUndefined(t.buid)?c("No floor seems to be selected."):(t.username=l.creds.username,t.password=l.creds.password,t.owner_id=l.owner_id,console.log(t),l.anyAPI.deleteFloor(t).then(function(e){e.data;for(var n=l.xFloors,i=n.length,o=0;o<i;o++)if(n[o].floor_number==t.floor_number){n.splice(o,1);break}null!=l.data.floor_plan_groundOverlay&&(l.data.floor_plan_groundOverlay.setMap(null),l.data.floor_plan_groundOverlay=null),l.xFloors&&0<l.xFloors.length?l.anyService.selectedFloor=l.xFloors[0]:l.anyService.selectedFloor=void 0,a("Successfully deleted floor.")},function(e){e.data;c("Something went wrong while deleting the floor.")}))};var u=function(e){for(var n=0;n<l.xFloors.length;n++){var i=l.xFloors[n];if(!LPUtils.isNullOrUndefined(i)&&i.floor_number===String(e))return!0}return!1};l.uploadFloorPlanBase64=function(e,n,i){if(!LPUtils.isNullOrUndefined(p)){var o=function(e){return LPUtils.isNullOrUndefined(e)?{}:JSON.parse(JSON.stringify(e))}(i.floor_plan_coords);if(LPUtils.isNullOrUndefined(o)||LPUtils.isStringBlankNullUndefined(o.bottom_left_lat)||LPUtils.isStringBlankNullUndefined(o.bottom_left_lng)||LPUtils.isStringBlankNullUndefined(o.top_right_lat)||LPUtils.isStringBlankNullUndefined(o.top_right_lng))return console.log("error with floor coords"),void c("Something went wrong. It seems like no valid coordinates have been set up for this floor plan.");if(o.bottom_left_lat=String(o.bottom_left_lat),o.bottom_left_lng=String(o.bottom_left_lng),o.top_right_lat=String(o.top_right_lat),o.top_right_lng=String(o.top_right_lng),n.bottom_left_lat=o.bottom_left_lat,n.bottom_left_lng=o.bottom_left_lng,n.top_right_lat=o.top_right_lat,n.top_right_lng=o.top_right_lng,LPUtils.isNullOrUndefined(e))c("Something went wrong. It seems like there is no building selected.");else if(LPUtils.isNullOrUndefined(e.buid))c("Something went wrong with the selected building's id.");else if(o.buid=e.buid,LPUtils.isNullOrUndefined(n))c("Something went wrong. It seems there is no floor selected.");else if(LPUtils.isNullOrUndefined(n.floor_number))c("Something went wrong. It seems there is no floor number associated with the selected floor.");else{o.floor_number=n.floor_number,o.owner_id=l.owner_id;var t=JSON.stringify(o);if(LPUtils.isNullOrUndefined(i.floor_plan_base64_data)||LPUtils.isStringEmptyNullUndefined(i.floor_plan_base64_data))console.log("no floor plan file");else l.anyAPI.uploadFloorPlan64(t,l.data.floor_plan_base64_data).then(function(e){e.data;a("Successfully uploaded new floor plan.")},function(e){e.data;a("Successfully uploaded new floor plan.")})}}},l.toggleRadioHeatmap=function(){t&&t.getMap()?t.setMap(null):l.showRadioHeatmap()},l.showRadioHeatmapPoi=function(){var e={buid:l.anyService.getBuildingId(),floor:l.anyService.getFloorNumber(),coordinates_lat:l.anyService.selectedPoi.coordinates_lat,coordinates_lon:l.anyService.selectedPoi.coordinates_lon,range:"1"};e.username=l.creds.username,e.password=l.creds.password,l.anyAPI.getRadioHeatmapPoi(e).then(function(e){e.data;var n=[],i=e.data.radioPoints.length;if(i<=0)c("This floor seems not to be WiFi mapped. Download the Anyplace app from the Google Play store to map the floor.");else{for(;i--;){var o=e.data.radioPoints[i];n.push({location:new google.maps.LatLng(o.x,o.y),weight:1}),e.data.radioPoints.splice(i,1)}t&&t.getMap()&&t.setMap(null),(t=new google.maps.visualization.HeatmapLayer({data:n})).setMap(l.gmapService.gmap)}},function(e){e.data;c("Something went wrong while fetching radio heatmap.")})},l.showRadioHeatmap=function(){var e={buid:l.anyService.getBuildingId(),floor:l.anyService.getFloorNumber()};e.username=l.creds.username,e.password=l.creds.password,l.anyAPI.getRadioHeatmap(e).then(function(e){e.data;var n=[],i=e.data.radioPoints.length;if(i<=0)c("This floor seems not to be WiFi mapped. Download the Anyplace app from the Google Play store to map the floor.");else{for(;i--;){var o=e.data.radioPoints[i];n.push({location:new google.maps.LatLng(o.x,o.y),weight:1}),e.data.radioPoints.splice(i,1)}t&&t.getMap()&&t.setMap(null),(t=new google.maps.visualization.HeatmapLayer({data:n})).setMap(l.gmapService.gmap)}},function(e){e.data;c("Something went wrong while fetching radio heatmap.")})}}]),app.controller("PoiController",["$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(u,g,m,f,i){_POIS_IS_ON=_CONNECTIONS_IS_ON=!0,u.anyService=f,u.anyAPI=i,u.myMarkers={},u.myMarkerId=0,u.myPaths={},u.myPathId=0,u.myPois=[],u.myPoisHashT={},u.myConnectionsHashT={},u.edgeMode=!1,u.connectPois={prev:void 0,next:void 0},u.crudTabSelected=1,u.setCrudTabSelected=function(e){u.crudTabSelected=e},u.isCrudTabSelected=function(e){return u.crudTabSelected===e},u.orderByName=function(e){return e.name},u.$on("loggedOff",function(e,n){u.clearConnectionsOnMap(),u.clearPoisOnMap(),u.myPaths={},u.myPathId=0,u.myMarkers={},u.myMarkerId=0,u.myPois=[],u.myPoisHashT={},u.myConnectionsHashT={},u.anyService.setAllPois(u.myPoisHashT),u.anyService.setAllConnection(u.myConnectionsHashT),u.edgeMode=!1,u.connectPois={prev:void 0,next:void 0}}),u.$watch("anyService.selectedBuilding",function(e,n){u.poisTypes=["Disabled Toilets","Elevator","Entrance","Fire Extinguisher","First Aid/AED","Kitchen","Office","Ramp","Room","Security/Guard","Stair","Toilets","Other"],u.poicategories=[{poicat:"Disabled Toilets",poicatPlaceholder:"name",id:"type1",disenable:"false"},{poicat:"Elevator",poicatPlaceholder:"name",id:"type2",disenable:"true"},{poicat:"Entrance",poicatPlaceholder:"name",id:"type3",disenable:"true"},{poicat:"Fire Extinguisher",poicatPlaceholder:"name",id:"type4",disenable:"false"},{poicat:"First Aid/AED",poicatPlaceholder:"name",id:"type5",disenable:"false"},{poicat:"Kitchen",poicatPlaceholder:"name",id:"type6",disenable:"false"},{poicat:"Office",poicatPlaceholder:"name",id:"type7",disenable:"false"},{poicat:"Ramp",poicatPlaceholder:"name",id:"type8",disenable:"false"},{poicat:"Room",poicatPlaceholder:"name",id:"type9",disenable:"false"},{poicat:"Security/Guard",poicatPlaceholder:"name",id:"type10",disenable:"false"},{poicat:"Stair",poicatPlaceholder:"name",id:"type11",disenable:"true"},{poicat:"Toilets",poicatPlaceholder:"name",id:"type12",disenable:"false"},{poicat:"Other",poicatPlaceholder:"name",id:"type13",disenable:"false"}]}),u.$watch("anyService.selectedFloor",function(e,n){null==e||_.isEqual(e,n)?u.anyService.selectedPoi=void 0:u.fetchAllPoisForFloor(e)}),u.$watch("anyService.selectedPoi",function(e,n){if(e&&c(e)&&e&&(m.gmap.panTo(c(e)),e.puid)){var i=u.myPoisHashT[e.puid].marker;i&&i.infowindow&&i.tpl2&&(i.infowindow.setContent(i.tpl2[0]),i.infowindow.open(m.gmap,i)),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastPoi",e.puid)}}),u.add=function(){""!=u.poicategories[u.poicategories.length-1].poicat?u.poicategories.push({poicat:"",poicatPlaceholder:"name",disenable:"false"}):y("Complete the last input to continue!")},u.deletetype=function(e){for(var n=0;n<u.poicategories.length;n++)if(u.poicategories[n].id==e){u.poicategories[n].id="",$("#".id).remove();break}},u.addcategory=function(){var e='"poistype":"'+document.getElementById("poistype").value+'"';function n(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var i="poistypeid_"+(n()+n()+"-"+n()+"-4"+n().substr(0,3)+"-"+n()+"-"+n()+n()+n()).toLowerCase()+"_"+(new Date).getTime();i='"poistypeid":"'+i+'"';var o=u.poicategories.length;if(0!=o){for(var t='"types":[',a=o-1;0<a;a--)""!=u.poicategories[a].poicat&&(t=t+'"'+u.poicategories[a].poicat+'",');var r="{"+e+","+i+","+(t=t+'"'+u.poicategories[0].poicat+'"]')+',"owner_id":"'+u.owner_id+'","access_token":"'+u.gAuth.access_token+'"}';u.anyAPI.addCategory(r).then(function(e){e.data;l("Successfully added category.")},function(e){var n=e.data;y("Something went wrong while adding the category. "+n.message)})}else y("No categories added.")},u.fetchAllPoisTypes=function(t){var e=u.anyService.jsonReq;(e.username=u.creds.username,e.password=u.creds.password,e.owner_id=u.owner_id,e.access_token=u.gAuth.access_token,e.poistypeid=t,e.owner_id)?u.anyAPI.retrievePoisTypes(e).then(function(e){for(var n=e.data.poistypes,i=n.length-1;0<=i;i--)if(n[i].poistypeid==t){var o=n[i].types;break}for(i=o.length-1;0<=i;i--)u.poisTypes[i]=o[i]},function(e){e.data;y("Something went wrong while fetching POIs types")}):y("Could nor authorize user. Please refresh.")},u.onInfoWindowKeyDown=function(e){if(27==e.keyCode&&u.anyService.selectedPoi){var n=u.anyService.selectedPoi;u.myPoisHashT[n.puid]&&u.myPoisHashT[n.puid].marker&&u.myPoisHashT[n.puid].marker.infowindow&&(u.myPoisHashT[n.puid].marker.infowindow.setMap(null),u.anyService.setAllPois(u.myPoisHashT))}},u.clearPoisOnMap=function(){for(var e=0;e<u.myPois.length;e++){var n=u.myPois[e];n&&u.myPoisHashT[n.puid]&&u.myPoisHashT[n.puid].marker&&(u.myPoisHashT[n.puid].marker.setMap(null),delete u.myPoisHashT[n.puid])}u.myPoisHashT={},u.anyService.setAllPois(u.myPoisHashT)},u.clearConnectionsOnMap=function(){if(u.myConnectionsHashT){for(var e in u.myConnectionsHashT)e&&u.myConnectionsHashT.hasOwnProperty(e)&&u.myConnectionsHashT[e]&&u.myConnectionsHashT[e].polyLine&&(u.myConnectionsHashT[e].polyLine.setMap(null),delete u.myConnectionsHashT[e]);u.myConnectionsHashT={},u.anyService.setAllConnection(u.myConnectionsHashT)}},u.fetchConnections=function(){var e,n,i=u.anyService.jsonReq,o=u.anyService.getBuilding();if(LPUtils.isNullOrUndefined(o))y("No building has been selected!");else if(LPUtils.isNullOrUndefined(o.buid))y("No valid building has been selected!");else{e=u.anyService.getBuildingId();var t=u.anyService.getFloor();if(LPUtils.isNullOrUndefined(t))y("No floor has been selected!");else if(LPUtils.isNullOrUndefined(t.floor_number))y("No valid floor has been selected!");else if(n=u.anyService.getFloorNumber(),i.buid=e,i.floor_number=n,(LPUtils.isNullOrUndefined(u.myPois)||LPUtils.isNullOrUndefined(u.myPoisHashT))&&y("Please load the POIs of this floor first."),0!=u.myPois.length){var a=i;u.anyAPI.retrieveConnectionsByBuildingFloor(a).then(function(e){var n=e.data;u.clearConnectionsOnMap();for(var i=n.connections,o={},t=i.length,a=0;a<t;a++)o[i[a].cuid]=i[a];u.myConnectionsHashT=o,u.anyService.setAllConnection(u.myConnectionsHashT),u.drawConnectionsOnMap()},function(e){e.data;y("Something went wrong while loading the POI connections")})}}},u.drawConnectionsOnMap=function(){for(var e in u.myConnectionsHashT)if(u.myConnectionsHashT.hasOwnProperty(e)){var n=u.myConnectionsHashT[e];if(!(n&&n.pois_a&&n.pois_b&&u.myPoisHashT[n.pois_a]&&u.myPoisHashT[n.pois_b]&&u.myPoisHashT[n.pois_a].model&&u.myPoisHashT[n.pois_b].model))continue;var i=[new google.maps.LatLng(u.myPoisHashT[n.pois_a].model.coordinates_lat,u.myPoisHashT[n.pois_a].model.coordinates_lon),new google.maps.LatLng(u.myPoisHashT[n.pois_b].model.coordinates_lat,u.myPoisHashT[n.pois_b].model.coordinates_lon)],o=new google.maps.Polyline({path:i,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:4});_CONNECTIONS_IS_ON&&o.setMap(m.gmap),o.model=n,u.myConnectionsHashT[e].polyLine=o,u.anyService.setAllConnection(u.myConnectionsHashT),google.maps.event.addListener(o,"click",function(){u.$apply(A(this)),u.anyService.setAllConnection(u.myConnectionsHashT)})}};function h(e){u.anyService.addAlert("warning",e)}function o(e){var n=e.lat(),i=e.lng(),o=u.anyService.getFloor();if(LPUtils.isNullOrUndefined(o))return y("No selected floor found."),!1;var t=o.top_right_lat,a=o.top_right_lng,r=o.bottom_left_lat,l=o.bottom_left_lng;return t&&a&&r&&l?n<=parseFloat(t)+.001&&i<=parseFloat(a)+.001&&n>=parseFloat(r)-.001&&i>=parseFloat(l)-.001:(y("Floor coordinates not found."),!1)}var d="build/images/edge-connector-icon.png",e="build/images/any-poi-icon.png",c=function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}},y=function(e){u.anyService.addAlert("danger",e)},l=function(e){u.anyService.addAlert("success",e)};u.drawPoisOnMap=function(){var a=new google.maps.InfoWindow({content:"-",maxWidth:500}),e=void 0,n=-1;"undefined"==typeof Storage||!localStorage||LPUtils.isNullOrUndefined(localStorage.getItem("lastBuilding"))||LPUtils.isNullOrUndefined(localStorage.getItem("lastFloor"))||LPUtils.isNullOrUndefined(localStorage.getItem("lastPoi"))||(e=localStorage.getItem("lastPoi"));for(var i=0;i<u.myPois.length;i++){u.myPois[i].pois_type2=u.myPois[i].pois_type;var o,t=u.myPois[i];e&&t.puid===e&&(n=i);var r="-";if(t.pois_type2=t.pois_type,"None"==t.pois_type)o=new google.maps.Marker({position:c(t),draggable:!0,icon:new google.maps.MarkerImage(d,null,null,null,new google.maps.Size(21,21))}),_POIS_IS_ON&&o.setMap(m.gmap),r='<div class="infowindow-scroll-fix" style="text-align: center; width:170px"><fieldset class="form-group" style="display: inline-block; width: 73%;"><button type="submit" class="btn btn-success add-any-button" ng-click="updatePoi(\''+t.puid+'\')"><span class="glyphicon glyphicon-pencil"></span> Update</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi(\''+t.puid+'\')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div>';else{var l=new google.maps.Size(21,32);o=new google.maps.Marker({position:c(t),draggable:!0,icon:new google.maps.MarkerImage("build/images/any-poi-icon.png",null,null,null,l)}),_POIS_IS_ON&&o.setMap(m.gmap),r='<div class="infowindow-scroll-fix" ng-keydown="onInfoWindowKeyDown($event)"><form name="poiForm"><fieldset class="form-group"><textarea ng-model="myPois['+i+'].name" id="poi-name" type="text" class="form-control" placeholder="poi name" tabindex="1" autofocus></textarea></fieldset><fieldset class="form-group"><textarea ng-model="myPois['+i+'].description" id="poi-description" type="text" class="form-control" placeholder="poi description" tabindex="5"></textarea></fieldset><fieldset class="form-group"><select ng-model="myPois['+i+'].pois_type" class="form-control" ng-options="type for type in poisTypes" title="POI Types" tabindex="2"><option value="">Select POI Type</option></select></fieldset class="form-group"><fieldset class="form-group">Or enter your own type:<input ng-model="myPois['+i+'].pois_type2" id="poi-pois_type2" type="text" class="form-control" placeholder="POI Type" tabindex="2"></fieldset><fieldset class="form-group"><input ng-model="myPois['+i+'].is_building_entrance" id="poi-entrance" type="checkbox" tabindex="4"><span> is building entrance?</span></fieldset><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="updatePoi(\''+t.puid+'\')" tabindex="3"><span class="glyphicon glyphicon-pencil"></span> Update</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi(\''+t.puid+'\')" tabindex="6"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form></div>'}var s=g(r)(u);o.tpl2=s,o.model=t,o.infowindow=a,u.myPoisHashT[t.puid].marker=o,u.anyService.setAllPois(u.myPoisHashT),google.maps.event.addListener(o,"click",function(){if(u.edgeMode)if(u.connectPois.prev){if(u.connectPois.prev==this)return u.connectPois.prev=void 0,void("None"===this.model.pois_type?this.setIcon(P()):this.setIcon(S()));"None"===u.connectPois.prev.model.pois_type?u.connectPois.prev.setIcon(P()):u.connectPois.prev.setIcon(S());var o=new google.maps.Polyline({path:[this.position,u.connectPois.prev.position],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.5,strokeWeight:4});o.setMap(m.gmap);var e=u.connectPois.prev.model,n=this.model;if(!e||!n||!e.puid||!n.puid||!e.buid||!n.buid||LPUtils.isNullOrUndefined(e.floor_number)||LPUtils.isNullOrUndefined(n.floor_number))return void y("One or both of the POIs attempted to be connected seem to be be malformed. Please refresh.");var i={username:u.creds.username,password:u.creds.password,owner_id:u.owner_id,pois_a:e.puid,floor_a:e.floor_number,buid_a:e.buid,buid:e.buid,pois_b:n.puid,floor_b:n.floor_number,buid_b:n.buid,is_published:"true",edge_type:"hallway"};o.model=i,u.anyAPI.addConnection(i).then(function(e){var n=e.data.cuid;o.model.cuid=n;var i=o.model;i.polyLine=o,u.myConnectionsHashT[n]=i,u.anyService.setAllConnection(u.myConnectionsHashT),o.setOptions({strokeColor:"#0000FF",strokeOpacity:.5}),google.maps.event.addListener(o,"click",function(){u.$apply(A(this))})},function(e){e.data;y("Something went wrong while attempting to connect the two POIs."),o.setMap(null)}),u.connectPois.prev=void 0}else"None"===(u.connectPois.prev=this).model.pois_type?this.setIcon(p()):this.setIcon(v());else{a.setContent(this.tpl2[0]),a.open(m.gmap,this);var t=this;u.$apply(function(){t.model&&t.model.puid&&(u.anyService.selectedPoi=t.model)})}}),google.maps.event.addListener(o,"dragend",function(e){this.model&&this.model.puid&&u.updatePoiPosition(this)})}0<=n&&(u.anyService.selectedPoi=u.myPois[n]),u.fetchConnections()};var p=function(){return new google.maps.MarkerImage(d,null,null,null,new google.maps.Size(41,41))},P=function(){return new google.maps.MarkerImage(d,null,null,null,new google.maps.Size(21,21))},v=function(){return new google.maps.MarkerImage(e,null,null,null,new google.maps.Size(31,48))},S=function(){return new google.maps.MarkerImage(e,null,null,null,new google.maps.Size(21,32))},A=function(n){if(u.edgeMode)if(n&&n.model&&n.model.cuid){var e=n.model,i=n.model.cuid;if(u.myConnectionsHashT[i]){var o=function(e){return null===e&&(e={}),LPUtils.isNullOrUndefined(e.buid)&&(e.buid=""),LPUtils.isNullOrUndefined(e.is_published)&&(e.is_published=!1),LPUtils.isNullOrUndefined(e.edge_type)&&(e.edge_type=""),LPUtils.isNullOrUndefined(e.pois_a)&&(e.pois_a=""),LPUtils.isNullOrUndefined(e.pois_b)&&(e.pois_b=""),LPUtils.isNullOrUndefined(e.floor_a)&&(e.floor_a=""),LPUtils.isNullOrUndefined(e.floor_b)&&(e.floor_b=""),LPUtils.isNullOrUndefined(e.buid_a)&&(e.buid_a=""),LPUtils.isNullOrUndefined(e.buid_b)&&(e.buid_b=""),e}(e);if(o.username=u.creds.username,o.password=u.creds.password,o.owner_id=u.owner_id,LPUtils.isNullOrUndefined(o.pois_a)||LPUtils.isStringBlankNullUndefined(o.pois_a))y("No valid connection has been selected. Missing POI A.");else if(LPUtils.isNullOrUndefined(o.pois_b)||LPUtils.isStringBlankNullUndefined(o.pois_b))y("No valid connection has been selected. Missing POI B.");else{n.setMap(null);var t=n.model.polyLine;delete n.model.polyLine,u.anyAPI.deleteConnection(o).then(function(e){e.data;delete u.myConnectionsHashT[i],u.anyService.setAllConnection(u.myConnectionsHashT)},function(e){e.data;n.setMap(m.gmap),n.model.polyLine=t,y("Something went wrong. Connection could not be deleted.")})}}else y("The connection attempted to delete does not exist in the system.")}else y("No valid connection selected.");else y('Enable "Edge Mode" so you can delete connections by clicking on them.')};u.fetchAllPoisForFloor=function(e){var n=f.jsonReq;n.buid=f.getBuildingId(),n.floor_number=f.getFloorNumber(),i.retrievePoisByBuildingFloor(n).then(function(e){var n=e.data;u.clearPoisOnMap(),u.myPois=n.pois;for(var i=u.myPois.length-1;0<=i;i--){var o=u.myPois[i].puid;"true"==u.myPois[i].is_building_entrance?u.myPois[i].is_building_entrance=!0:u.myPois[i].is_building_entrance=!1,u.myPois[i].pois_type2=u.myPois[i].pois_type,u.myPoisHashT[o]={},u.myPoisHashT[o].model=u.myPois[i],u.anyService.setAllPois(u.myPoisHashT)}u.drawPoisOnMap()},function(e){e.data;y("Something went wrong while fetching POIs")})};var t=new google.maps.OverlayView;t.draw=function(){},t.setMap(m.gmap),u.addPoi=function(i){if(u.myMarkers[i]&&u.myMarkers[i].marker){0!=u.myMarkers[i].model.pois_type2.localeCompare("")&&(u.myMarkers[i].model.pois_type=u.myMarkers[i].model.pois_type2);var o=u.myMarkers[i].model;if(o.owner_id=u.owner_id,o.coordinates_lat=String(u.myMarkers[i].marker.position.lat()),o.coordinates_lon=String(u.myMarkers[i].marker.position.lng()),o.is_building_entrance=String(o.is_building_entrance),void 0===o.coordinates_lat||null===o.coordinates_lat)return void y("POI has invalid latitude format");if(void 0===o.coordinates_lon||null===o.coordinates_lon)return void y("POI has invalid longitude format");if(!(o.owner_id&&o.name&&o.buid&&o.pois_type)||LPUtils.isNullOrUndefined(o.is_building_entrance)||LPUtils.isNullOrUndefined(o.is_published)||LPUtils.isNullOrUndefined(o.is_door)||LPUtils.isNullOrUndefined(o.floor_name)||LPUtils.isNullOrUndefined(o.floor_number))y("Cannot add new POI. Some required fields are missing.");else{"true"==o.is_building_entrance?o.is_building_entrance="true":o.is_building_entrance="false";var e=o;u.anyAPI.addPois(e).then(function(e){var n=e.data;o.puid=n.puid,"true"==o.is_building_entrance?o.is_building_entrance=!0:o.is_building_entrance=!1,u.myPois.push(o),u.anyService.selectedPoi=u.myPois[u.myPois.length-1],u.myPoisHashT[o.puid]={model:o,marker:u.myMarkers[i].marker},u.anyService.setAllPois(u.myPoisHashT),u.myMarkers[i].model=o,u.myMarkers[i].infowindow&&(u.myMarkers[i].infowindow.close(),u.myMarkers[i].infowindow.setContent(u.myMarkers[i].marker.tpl2[0])),u.myMarkers[i].marker.model=o,"None"==u.myMarkers[i].marker.model.pois_type?u.myMarkers[i].marker.setIcon(P()):u.myMarkers[i].marker.setIcon(S()),google.maps.event.clearListeners(u.myMarkers[i].marker,"click");var a=u.myMarkers[i].infowindow;google.maps.event.addListener(u.myMarkers[i].marker,"click",function(){if(u.edgeMode)if(u.connectPois.prev){if(u.connectPois.prev==this)return u.connectPois.prev=void 0,void("None"===this.model.pois_type?this.setIcon(P()):this.setIcon(S()));"None"===u.connectPois.prev.model.pois_type?u.connectPois.prev.setIcon(P()):u.connectPois.prev.setIcon(S());var o=new google.maps.Polyline({path:[this.position,u.connectPois.prev.position],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.5,strokeWeight:4});o.setMap(m.gmap);var e=u.connectPois.prev.model,n=this.model;if(!e||!n||!e.puid||!n.puid||!e.buid||!n.buid||LPUtils.isNullOrUndefined(e.floor_number)||LPUtils.isNullOrUndefined(n.floor_number))return void y("One or both of the POIs attempted to be connected seem to be be malformed. Please refresh.");var i={username:u.creds.username,password:u.creds.password,owner_id:u.owner_id,pois_a:e.puid,floor_a:e.floor_number,buid_a:e.buid,buid:e.buid,pois_b:n.puid,floor_b:n.floor_number,buid_b:n.buid,is_published:"true",edge_type:"hallway"};o.model=i,u.anyAPI.addConnection(i).then(function(e){var n=e.data.cuid;o.model.cuid=n;var i=o.model;i.polyLine=o,u.myConnectionsHashT[n]=i,u.anyService.setAllConnection(u.myConnectionsHashT),o.setOptions({strokeColor:"#0000FF",strokeOpacity:.5}),google.maps.event.addListener(o,"click",function(){u.$apply(A(this))})},function(e){e.data;y("Something went wrong while attempting to connect the two POIs."),o.setMap(null)}),u.connectPois.prev=void 0}else"None"===(u.connectPois.prev=this).model.pois_type?this.setIcon(p()):this.setIcon(v());else{a.setContent(this.tpl2[0]),a.open(m.gmap,this);var t=this;u.$apply(function(){t.model&&t.model.puid&&(u.anyService.selectedPoi=t.model)})}}),google.maps.event.addListener(u.myMarkers[i].marker,"dragend",function(e){this.model&&this.model.puid&&u.updatePoiPosition(this)})},function(e){e.data;y("Something went wrong while adding the new POI.")})}}},u.deletePoi=function(e){var n,i=u.myPoisHashT[e];if(!i||!i.model||!i.model.puid){if(!(u.myPoisHashT&&u.myMarkers&&u.myMarkers[e]&&u.myMarkers[e].model&&u.myPoisHashT[u.myMarkers[e].model.puid]))return void y("No valid POI selected to be deleted.");if(!(i=u.myPoisHashT[u.myMarkers[e].model.puid])||!i.model||!i.model.puid)return void y("No valid POI selected to be deleted.")}var o=u.myConnectionsHashT;for(var t in o)if(o.hasOwnProperty(t)&&((n=o[t]).pois_a==i.model.puid||n.pois_b==i.model.puid))return void y("Please delete all the connections attached to this POI first.");var a=i.model;a.username=u.creds.username,a.password=u.creds.password,a.owner_id=u.owner_id;var r=a.puid;!0===a.is_building_entrance||"true"===a.is_building_entrance?a.is_building_entrance="true":a.is_building_entrance="false",u.anyAPI.deletePois(a).then(function(e){e.data;"true"===a.is_building_entrance?a.is_building_entrance=!0:a.is_building_entrance=!1;for(var n=u.myPois,i=n.length,o=0;o<i;o++)if(n[o].puid==r){n.splice(o,1),u.myPoisHashT[r]&&u.myPoisHashT[r].marker&&u.myPoisHashT[r].marker.setMap(null),delete u.myPoisHashT[r],u.anyService.setAllPois(u.myPoisHashT);break}l("Successfully deleted POI.")},function(e){e.data;for(var n=u.myPois,i=n.length,o=0;o<i;o++)if(n[o].puid==r){n.splice(o,1),u.myPoisHashT[r]&&u.myPoisHashT[r].marker&&u.myPoisHashT[r].marker.setMap(null),delete u.myPoisHashT[r],u.anyService.setAllPois(u.myPoisHashT);break}y("Something went wrong while deleting POI.")})},u.updatePoi=function(e){var n=u.myPoisHashT[e];if(!n||!n.model||!n.model.puid){if(!(u.myPoisHashT&&u.myMarkers&&u.myMarkers[e]&&u.myMarkers[e].model&&u.myPoisHashT[u.myMarkers[e].model.puid]))return void y("No valid POI selected to be updated.");if(!(n=u.myPoisHashT[u.myMarkers[e].model.puid])||!n.model||!n.model.puid)return void y("No valid POI selected to be updated.")}0!=n.model.pois_type2.localeCompare("")&&(n.model.pois_type=n.model.pois_type2);var a=n.model;a.username=u.creds.username,a.password=u.creds.password,a.owner_id=u.owner_id;var r=n.marker;if(r){var i=r.position;i&&i.lat()&&i.lng()&&(a.coordinates_lat=String(i.lat()),a.coordinates_lon=String(i.lng()))}a.is_building_entrance?a.is_building_entrance="true":a.is_building_entrance="false",u.anyAPI.updatePois(a).then(function(e){e.data;for(var n in r&&r.infowindow.setMap(null),"true"==a.is_building_entrance?a.is_building_entrance=!0:a.is_building_entrance=!1,u.myConnectionsHashT)if(u.myConnectionsHashT.hasOwnProperty(n)&&(u.myConnectionsHashT[n].pois_a==a.puid||u.myConnectionsHashT[n].pois_b==a.puid)){var i=u.myConnectionsHashT[n].pois_a,o=u.myConnectionsHashT[n].pois_b,t=[new google.maps.LatLng(u.myPoisHashT[i].model.coordinates_lat,u.myPoisHashT[i].model.coordinates_lon),new google.maps.LatLng(u.myPoisHashT[o].model.coordinates_lat,u.myPoisHashT[o].model.coordinates_lon)];u.myConnectionsHashT[n].polyLine.setPath(t),u.anyService.setAllConnection(u.myConnectionsHashT),u.anyService.setAllPois(u.myPoisHashT)}},function(e){e.data;y("Something went wrong while updating POI. Please refresh and try again.")})},u.updatePoiPosition=function(a){var r;a&&a.model&&(r=a.model),r.username=u.creds.username,r.password=u.creds.password,r.owner_id=u.owner_id;var e=a.position;e&&e.lat()&&e.lng()&&(r.coordinates_lat=String(e.lat()),r.coordinates_lon=String(e.lng())),r.is_building_entrance?r.is_building_entrance="true":r.is_building_entrance="false",u.anyAPI.updatePois(r).then(function(e){e.data;for(var n in"true"==r.is_building_entrance||!0===r.is_building_entrance?r.is_building_entrance=!0:r.is_building_entrance=!1,u.myConnectionsHashT)if(u.myConnectionsHashT.hasOwnProperty(n)&&(u.myConnectionsHashT[n].pois_a==a.model.puid||u.myConnectionsHashT[n].pois_b==a.model.puid)){var i=u.myConnectionsHashT[n].pois_a,o=u.myConnectionsHashT[n].pois_b,t=[new google.maps.LatLng(u.myPoisHashT[i].model.coordinates_lat,u.myPoisHashT[i].model.coordinates_lon),new google.maps.LatLng(u.myPoisHashT[o].model.coordinates_lat,u.myPoisHashT[o].model.coordinates_lon)];u.myConnectionsHashT[n].polyLine.setPath(t),u.anyService.setAllConnection(u.myConnectionsHashT),u.anyService.setAllPois(u.myPoisHashT)}},function(e){e.data;y("Something went wrong while moving POI.")})},u.removeMarker=function(e){u.myMarkers[e]?(u.myMarkers[e].marker.setMap(null),delete u.myMarkers[e]):y("It seems that the marker to be deleted does not exist.")},u.placeMarker=function(e,n,i,o){var t=new google.maps.Marker({position:e,map:m.gmap,icon:new google.maps.MarkerImage(n,null,null,null,i),draggable:!0});if(null!==f.getBuildingId()&&void 0!==f.getBuildingId()){var a=new google.maps.InfoWindow({content:"-",maxWidth:500});u.$apply(function(){t.myId=u.myMarkerId,u.myMarkers[t.myId]={},u.myMarkers[t.myId].model={buid:f.getBuildingId(),floor_number:f.getFloorNumber(),floor_name:f.getFloorName(),is_door:"false",is_building_entrance:"false",is_published:"true",description:"connector"===o?"Connector":"",name:"connector"===o?"Connector":"",pois_type:"connector"===o?"None":"",pois_type2:"connector"===o?"None":"",url:"-",image:"url_to_pois_image"},u.myMarkers[t.myId].marker=t,u.myMarkers[t.myId].model.pois_type2=u.myMarkers[t.myId].model.pois_type,u.myMarkerId++});var r='<div class="infowindow-scroll-fix" ng-keydown="onInfoWindowKeyDown($event)"><form name="poiForm"><fieldset class="form-group"><input ng-model="myMarkers['+t.myId+'].model.name" id="poi-name" type="text" class="form-control" placeholder="poi name" tabindex="1" autofocus/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+t.myId+'].model.description" id="poi-description" type="text" class="form-control" placeholder="poi description" tabindex="5"></textarea></fieldset><fieldset class="form-group"><select ng-model="myMarkers['+t.myId+'].model.pois_type" class="form-control" ng-options="type for type in poisTypes" title="POI Types" tabindex="2"><option value="">Select POI Type</option></select></fieldset class="form-group"><fieldset class="form-group">Or ender your one type name:<input ng-model="myMarkers['+t.myId+'].model.pois_type2" id="poi-pois_type2" type="text" class="form-control" placeholder="POI Type" tabindex="2"></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+t.myId+'].model.is_building_entrance" id="poi-entrance" type="checkbox" tabindex="4"><span> is building entrance?</span></fieldset><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addPoi('+t.myId+')" tabindex="3"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempPoi('+t.myId+')" tabindex="6"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form></div>',l='<div class="infowindow-scroll-fix" ng-keydown="onInfoWindowKeyDown($event)"><form name="poiForm"><fieldset class="form-group"><input ng-model="myMarkers['+t.myId+'].model.name" id="poi-name" type="text" class="form-control" placeholder="poi name" tabindex="1" autofocus/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+t.myId+'].model.description" id="poi-description" type="text" class="form-control" placeholder="poi description" tabindex="5"></textarea></fieldset><fieldset class="form-group"><select ng-model="myMarkers['+t.myId+'].model.pois_type" class="form-control" ng-options="type for type in poisTypes" title="POI Types" tabindex="2"><option value="">Select POI Type</option></select></fieldset class="form-group"><fieldset class="form-group">Or ender your one type name:<input ng-model="myMarkers['+t.myId+'].model.pois_type" id="poi-pois_type2" type="text" class="form-control" placeholder="POI Type" tabindex="2"></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+t.myId+'].model.is_building_entrance" id="poi-entrance" type="checkbox" tabindex="4"><span> is building entrance?</span></fieldset><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="updatePoi('+t.myId+')" tabindex="3"><span class="glyphicon glyphicon-pencil"></span> Update</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi('+t.myId+')" tabindex="6"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form></div>',s='<div class="infowindow-scroll-fix" style="text-align: center; width:170px"><div style="margin-bottom: 5px">POI Connector</div><fieldset class="form-group" style="display: inline-block; width: 73%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addPoi('+t.myId+')"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempPoi('+t.myId+')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div>',d='<div class="infowindow-scroll-fix" style="text-align: center; width:170px"><div style="margin-bottom: 5px">POI Connector</div><fieldset class="form-group"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi('+t.myId+')"><span class="glyphicon glyphicon-remove"></span> Remove</button></fieldset></div>';if("poi"==o){var c=g(r)(u);t.tpl2=g(l)(u),a.setContent(c[0]),a.open(m.gmap,t)}else if("connector"==o){var p=g(s)(u);t.tpl2=g(d)(u),a.setContent(p[0]),u.addPoi(t.myId)}u.$apply(u.myMarkers[t.myId].infowindow=a),google.maps.event.addListener(t,"click",function(){u.edgeMode&&u.$apply(h("Only submitted objects can be connected together.")),a.open(m.gmap,t)})}else y("It seems there is no building selected. Please refresh.")},u.deleteTempPoi=function(e){u.myMarkers&&u.myMarkers[e].marker?u.myMarkers[e].marker.setMap(null):y("No valid POI marker to delete found.")},u.toggleEdgeMode=function(){u.edgeMode=!u.edgeMode,u.edgeMode||(u.connectPois.prev=void 0)},$("#draggable-poi").draggable({helper:"clone",stop:function(e){var n=new google.maps.Point(e.pageX,e.pageY),i=t.getProjection().fromContainerPixelToLatLng(n);o(i)?u.placeMarker(i,"build/images/poi-icon.png",new google.maps.Size(21,32),"poi"):u.$apply(h("The marker was placed too far away from the selected building."))}}),$("#draggable-connector").draggable({helper:"clone",stop:function(e){var n=new google.maps.Point(e.pageX,e.pageY),i=t.getProjection().fromContainerPixelToLatLng(n);o(i)?u.placeMarker(i,d,new google.maps.Size(21,21),"connector"):u.$apply(h("The marker was placed too far away from the selected building."))}})}]),app.controller("SelectFloorController",["$scope","AnyplaceService","GMapService","AnyplaceAPIService",function(i,e,n,o){i.anyService=e,i.anyAPI=o,i.gmapService=n,i.xFloors=[],i.$watch("anyService.availableFloors",function(e,n){e&&(i.xFloors=[],i.xFloors=i.anyService.availableFloors)});function t(e){i.anyService.addAlert("danger",e)}i.orderByFloorNo=function(e){return!e||LPUtils.isNullOrUndefined(e.floor_number)?0:parseInt(e.floor_number)},i.floorUp=function(){var e;changedfloor=!0;for(var n=0;n<i.xFloors.length;n++)if(e=n+1,i.xFloors[n].floor_number===i.anyService.selectedFloor.floor_number)return e<i.xFloors.length?void(i.anyService.selectedFloor=i.xFloors[e]):void 0;t("Floor not found.")},i.floorDown=function(){var e;changedfloor=!0;for(var n=0;n<i.xFloors.length;n++)if(e=n-1,i.xFloors[n].floor_number===i.anyService.selectedFloor.floor_number)return 0<=e?void(i.anyService.selectedFloor=i.xFloors[e]):void 0;t("Floor not found.")}}]);var heatMap=[],heatMap_Location=[],APmap=[],heatmapFingerprints=[],userTimeData=[],fingerPrintsMap=[],connectionsMap={},POIsMap={},_HEATMAP_RSS_IS_ON=!1,_HEATMAP_Localization=!1,_APs_IS_ON=!1,_FINGERPRINTS_IS_ON=!1,_DELETE_FINGERPRINTS_IS_ON=!1,_HEATMAP_F_IS_ON=!1,_CONNECTIONS_IS_ON=!1,_POIS_IS_ON=!1,colorBarGreenClicked=(changedfloor=!1,!1),colorBarYellowClicked=!1,colorBarOrangeClicked=!1,colorBarPurpleClicked=!1,colorBarRedClicked=!1,levelOfZoom=1;app.controller("WiFiController",["$cookieStore","$scope","AnyplaceService","GMapService","AnyplaceAPIService",function(g,h,e,p,n){h.anyService=e,h.anyAPI=n,h.gmapService=p,h.example9model=[],h.example9data=[],h.example9settings={enableSearch:!0,scrollable:!0},h.example8model=[],h.example8data=[],h.deleteButtonWarning=!1,h.radioHeatmapRSSMode=!1,h.radioHeatmapLocalization=!1,h.radioHeatmapRSSTimeMode=!1,h.fingerPrintsMode=!1,h.fingerPrintsTimeMode=!1,h.APsMode=!1,h.filterByMAC=!1,h.filterByMAN=!1,h.radioHeatmapRSSHasGreen=!1,h.radioHeatmapRSSHasYellow=!1,h.radioHeatmapRSSHasOrange=!1,h.radioHeatmapRSSHasPurple=!1,h.radioHeatmapRSSHasRed=!1,h.localizationAccMode=!1,h.selected="Filters:",h.initializeTime=!1,h.initializeFingerPrints=!1,h.initializeRadioHeatmapRSS=!1,h.initializeAPs=!1,h.initializeConnections=!1,h.initializePOIs=!1,h.initializeAcces=!1;var s,i;function y(){if(void 0!==heatMap[0]&&null!==heatMap[0]){for(var e=heatMap.length;e--;)heatMap[e].rectangle.setMap(null),heatMap[e]=null;heatMap=[],document.getElementById("radioHeatmapRSS-mode").classList.remove("draggable-border-green"),o("g",_HEATMAP_RSS_IS_ON=!1),o("y",!1),o("o",!1),o("p",!1),o("r",!1),h.radioHeatmapRSSMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","NO"),h.anyService.radioHeatmapRSSMode=!1,h.radioHeatmapRSSHasGreen=!1,h.radioHeatmapRSSHasYellow=!1,h.radioHeatmapRSSHasOrange=!1,h.radioHeatmapRSSHasPurple=!1,h.radioHeatmapRSSHasRed=!1,g.put("RSSClicked","NO")}}function P(){if(void 0!==heatMap_[0]&&null!==heatMap[0]){for(var e=heatMap.length;e--;)heatMap[e].rectangle.setMap(null),heatMap[e]=null;heatMap=[],document.getElementById("radioHeatmapRSS-mode").classList.remove("draggable-border-green"),o("g",_HEATMAP_Localization=!1),o("y",!1),o("o",!1),o("p",!1),o("r",!1),h.radioHeatmapLocalization=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapLocalization","NO"),h.anyService.radioHeatmapLocalization=!1,h.radioHeatmapRSSHasGreen=!1,h.radioHeatmapRSSHasYellow=!1,h.radioHeatmapRSSHasOrange=!1,h.radioHeatmapRSSHasPurple=!1,h.radioHeatmapRSSHasRed=!1,g.put("RSSClicked","NO")}}function v(){if(void 0!==fingerPrintsMap[0]&&null!==fingerPrintsMap[0]){for(var e=fingerPrintsMap.length;e--;)fingerPrintsMap[e].setMap(null),fingerPrintsMap[e]=null;_FINGERPRINTS_IS_ON=!(fingerPrintsMap=[]),document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green")}if(heatmap&&heatmap.getMap()){heatmap.setMap(null),_FINGERPRINTS_IS_ON=!1,document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),_HEATMAP_F_IS_ON=!1;for(e=heatmapFingerprints.length;e--;)heatmapFingerprints[e]=null;heatmapFingerprints=[]}}function S(){h.fingerPrintsMode&&(h.fingerPrintsTimeMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"),h.anyService.fingerPrintsTimeMode=!0,h.fingerPrintsMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","YES")),h.radioHeatmapRSSMode&&(h.radioHeatmapRSSTimeMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"),h.radioHeatmapRSSMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","YES"),h.anyService.radioHeatmapRSSTimeMode=!0,h.anyService.radioHeatmapRSSMode=!0),document.getElementById("fingerPrints-time-mode").classList.add("draggable-border-green"),h.radioHeatmapLocalization&&(h.radioHeatmapRSSTimeMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"),h.radioHeatmapLocalization=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapLocalization","YES"),h.anyService.radioHeatmapRSSTimeMode=!0,h.anyService.radioHeatmapLocalization=!0),document.getElementById("fingerPrints-time-mode").classList.add("draggable-border-green")}h.crudTabSelected=1,h.setCrudTabSelected=function(e){h.crudTabSelected=e},h.isCrudTabSelected=function(e){return h.crudTabSelected===e},h.data={floor_plan_coords:{},floor_plan_base64_data:{},floor_plan_groundOverlay:null},h.$watch("anyService.selectedBuilding",function(e,n){if(e){if(void 0!==localStorage.getItem("fingerprintsMode")&&"YES"===localStorage.getItem("fingerprintsMode")&&(h.initializeFingerPrints=!0),void 0!==localStorage.getItem("radioHeatmapRSSMode")&&"YES"===localStorage.getItem("radioHeatmapRSSMode")&&(h.initializeRadioHeatmapRSS=!0),void 0!==localStorage.getItem("radioHeatmapLocalization")&&"YES"===localStorage.getItem("radioHeatmapLocalization")&&(h.initializeRadioHeatmapRSS=!0),void 0!==localStorage.getItem("APsMode")&&"YES"===localStorage.getItem("APsMode")&&(h.initializeAPs=!0),void 0!==localStorage.getItem("localizationAccMode")&&"YES"===localStorage.getItem("localizationAccMode")&&(h.initializeAcces=!0),void 0!==localStorage.getItem("connectionsMode")&&"NO"===localStorage.getItem("connectionsMode")&&(h.initializeConnections=!0),void 0!==localStorage.getItem("POIsMode")&&"NO"===localStorage.getItem("POIsMode")&&(h.initializePOIs=!0),void 0!==localStorage.getItem("fingerPrintsTimeMode")&&"YES"===localStorage.getItem("fingerPrintsTimeMode")&&(h.initializeTime=!0),window.onload=function(){h.initializeFingerPrints&&($("#wifiTab").click(),$("#FPs").click(),$("#FPsButton").click()),h.initializeRadioHeatmapRSS&&($("#wifiTab").click(),$("#HMs").click(),$("#HMsButton").click()),h.initializeAPs&&($("#wifiTab").click(),$("#HMs").click(),$("#APsButton").click()),h.initializeAcces&&($("#wifiTab").click(),$("#LAs").click(),$("#LAButton").click()),h.initializeConnections&&($("#FPs").click(),$("#connectionsButton").click()),h.initializePOIs&&($("#FPs").click(),$("#POIsButton").click()),h.initializeTime&&($("#wifiTab").click(),$("#FPs").click(),$("#FPsTimeButton").click())},_HEATMAP_RSS_IS_ON){for(var i=heatMap.length;i--;)heatMap[i].rectangle.setMap(null),heatMap[i]=null;heatMap=[],h.showRadioHeatmapRSS(),h.radioHeatmapRSSTimeMode&&(d3.selectAll("svg > *").remove(),$("svg").remove(),h.getFingerPrintsTime())}if(_HEATMAP_Localization){for(i=heatMap_Location.length;i--;)heatMap_Location[i].setMap(null),heatMap_Location[i]=null;heatMap_Location=[],h.showLocalizationAccHeatmap()}if(_APs_IS_ON){for(i=APmap.length;i--;)APmap[i].setMap(null),APmap[i]=null,h.example9data[i]=null,h.example9model[i]=null;for(i=h.example8data.length;i--;)h.example8data[i]=null,h.example8model[i]=null;APmap=[],h.example9data=[],h.example9model=[],h.example8data=[],h.example8model=[],h.showAPs()}if(_FINGERPRINTS_IS_ON){for(i=fingerPrintsMap.length;i--;)fingerPrintsMap[i].setMap(null),fingerPrintsMap[i]=null;fingerPrintsMap=[],h.showFingerPrints(),h.fingerPrintsTimeMode&&!h.radioHeatmapRSSTimeMode&&(d3.selectAll("svg > *").remove(),$("svg").remove(),h.getFingerPrintsTime())}if(heatmap&&heatmap.getMap()){heatmap.setMap(null);for(i=heatmapFingerprints.length;i--;)heatmapFingerprints[i]=null;_HEATMAP_F_IS_ON=!(heatmapFingerprints=[]),h.showFingerPrints(),h.fingerPrintsTimeMode&&!h.radioHeatmapRSSTimeMode&&(d3.selectAll("svg > *").remove(),$("svg").remove(),h.getFingerPrintsTime())}if(!_CONNECTIONS_IS_ON){connectionsMap=h.anyService.getAllConnections();var o=Object.keys(connectionsMap);if(void 0!==connectionsMap[o[0]]&&void 0!==connectionsMap[o[0]].polyLine&&null!==connectionsMap[o[0]].polyLine.getMap()){for(var o in connectionsMap)if(connectionsMap.hasOwnProperty(o)){var t=connectionsMap[o];t&&t.polyLine&&t.polyLine.setMap(null)}h.anyService.setAllConnection(connectionsMap),connectionsMap={}}}if(!_POIS_IS_ON&&void 0!==(POIsMap=h.anyService.getAllPois())){o=Object.keys(POIsMap);if(void 0!==POIsMap[o[0]]&&null!==POIsMap[o[0]].marker.getMap()){for(var o in POIsMap)if(POIsMap.hasOwnProperty(o)){var a=POIsMap[o];a&&a.marker&&a.marker.setMap(null)}h.anyService.setAllPois(POIsMap),POIsMap={}}}changedfloor=!1}}),h.$watch("newFloorNumber",function(e,n){});function m(e){h.anyService.addAlert("danger",e)}function u(e){h.anyService.addAlert("success",e)}function o(e,n){"g"===e?(colorBarGreenClicked=n)?document.getElementById("greenSquares").classList.add("faded"):document.getElementById("greenSquares").classList.remove("faded"):"y"===e?(colorBarYellowClicked=n)?document.getElementById("yellowSquares").classList.add("faded"):document.getElementById("yellowSquares").classList.remove("faded"):"o"===e?(colorBarOrangeClicked=n)?document.getElementById("orangeSquares").classList.add("faded"):document.getElementById("orangeSquares").classList.remove("faded"):"p"===e?(colorBarPurpleClicked=n)?document.getElementById("purpleSquares").classList.add("faded"):document.getElementById("purpleSquares").classList.remove("faded"):(colorBarRedClicked=n)?document.getElementById("redSquares").classList.add("faded"):document.getElementById("redSquares").classList.remove("faded")}function f(e){return"g"===e?colorBarGreenClicked:"y"===e?colorBarYellowClicked:"o"===e?colorBarOrangeClicked:"p"===e?colorBarPurpleClicked:colorBarRedClicked}h.$watch("anyService.selectedFloor",function(e,n){if(null!=e&&!_.isEqual(e,n)){if("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastFloor",e.floor_number),_HEATMAP_RSS_IS_ON){for(var i=heatMap.length;i--;)heatMap[i].rectangle.setMap(null),heatMap[i]=null;heatMap=[],h.showRadioHeatmapRSS(),h.radioHeatmapRSSTimeMode&&(d3.selectAll("svg > *").remove(),$("svg").remove(),h.getFingerPrintsTime())}if(_HEATMAP_Localization){for(i=heatMap_Location.length;i--;)heatMap_Location[i].setMap(null),heatMap_Location[i]=null;heatMap_Location=[],h.showLocalizationAccHeatmap()}if(_APs_IS_ON){for(i=APmap.length;i--;)APmap[i].setMap(null),APmap[i]=null,h.example9data[i]=null,h.example9model[i]=null;for(i=h.example8data.length;i--;)h.example8data[i]=null,h.example8model[i]=null;APmap=[],h.example9data=[],h.example9model=[],h.example8data=[],h.example8model=[],h.showAPs()}if(_FINGERPRINTS_IS_ON){for(i=fingerPrintsMap.length;i--;)fingerPrintsMap[i].setMap(null),fingerPrintsMap[i]=null;fingerPrintsMap=[],h.showFingerPrints(),h.fingerPrintsTimeMode&&!h.radioHeatmapRSSTimeMode&&(d3.selectAll("svg > *").remove(),$("svg").remove(),h.getFingerPrintsTime())}if(heatmap&&heatmap.getMap()){heatmap.setMap(null);for(i=heatmapFingerprints.length;i--;)heatmapFingerprints[i]=null;_HEATMAP_F_IS_ON=!(heatmapFingerprints=[]),h.showFingerPrints(),h.fingerPrintsTimeMode&&!h.radioHeatmapRSSTimeMode&&(d3.selectAll("svg > *").remove(),$("svg").remove(),h.getFingerPrintsTime())}if(!_CONNECTIONS_IS_ON){connectionsMap=h.anyService.getAllConnections();var o=Object.keys(connectionsMap);if(void 0!==connectionsMap[o[0]]&&void 0!==connectionsMap[o[0]].polyLine&&null!==connectionsMap[o[0]].polyLine.getMap()){for(var o in connectionsMap)if(connectionsMap.hasOwnProperty(o)){var t=connectionsMap[o];t&&t.polyLine&&t.polyLine.setMap(null)}h.anyService.setAllConnection(connectionsMap),connectionsMap={}}}if(!_POIS_IS_ON&&void 0!==(POIsMap=h.anyService.getAllPois())){o=Object.keys(POIsMap);if(void 0!==POIsMap[o[0]]&&null!==POIsMap[o[0]].marker.getMap()){for(var o in POIsMap)if(POIsMap.hasOwnProperty(o)){var a=POIsMap[o];a&&a.marker&&a.marker.setMap(null)}h.anyService.setAllPois(POIsMap),POIsMap={}}}changedfloor=!1}}),h.toggleRadioHeatmapRSS=function(){if(void 0!==heatMap[0]&&null!==heatMap[0]||h.radioHeatmapRSSTimeMode){for(var e=heatMap.length;e--;)heatMap[e].rectangle.setMap(null),heatMap[e]=null;return heatMap=[],document.getElementById("radioHeatmapRSS-mode").classList.remove("draggable-border-green"),o("g",_HEATMAP_RSS_IS_ON=!1),o("y",!1),o("o",!1),o("p",!1),o("r",!1),h.radioHeatmapRSSMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","NO"),h.anyService.radioHeatmapRSSMode=!1,h.radioHeatmapRSSTimeMode=!1,"undefined"!=typeof Storage&&localStorage&&!h.fingerPrintsTimeMode&&localStorage.setItem("fingerPrintsTimeMode","NO"),h.anyService.radioHeatmapRSSTimeMode=!1,h.radioHeatmapRSSHasGreen=!1,h.radioHeatmapRSSHasYellow=!1,h.radioHeatmapRSSHasOrange=!1,h.radioHeatmapRSSHasPurple=!1,h.radioHeatmapRSSHasRed=!1,h.fingerPrintsMode||document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green"),void g.put("RSSClicked","NO")}h.fingerPrintsTimeMode&&(h.radioHeatmapRSSTimeMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"),h.anyService.radioHeatmapRSSTimeMode=!0),document.getElementById("radioHeatmapRSS-mode").classList.add("draggable-border-green"),h.radioHeatmapRSSMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","YES"),h.anyService.radioHeatmapRSSMode=!0,h.showRadioHeatmapRSS()},h.toggleAPs=function(){if(void 0!==APmap[0]&&null!==APmap[0]){for(var e=APmap.length;e--;)APmap[e].setMap(null),APmap[e]=null,h.example9data[e]=null,h.example9model[e]=null;for(e=h.example8data.length;e--;)h.example8data[e]=null,h.example8model[e]=null;return APmap=[],h.example9data=[],h.example9model=[],h.example8data=[],h.example8model=[],_APs_IS_ON=!1,h.filterByMAC=!1,h.filterByMAN=!1,document.getElementById("APs-mode").classList.remove("draggable-border-green"),h.APsMode=!1,void("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("APsMode","NO"))}_APs_IS_ON=!0,h.APsMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("APsMode","YES"),document.getElementById("APs-mode").classList.add("draggable-border-green"),h.showAPs()},h.toggleFingerPrints=function(){h.fingerPrintsMode=!h.fingerPrintsMode,h.fingerPrintsMode?(document.getElementById("fingerPrints-mode").classList.add("draggable-border-green"),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","YES")):(document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"));if(void 0!==fingerPrintsMap[0]&&null!==fingerPrintsMap[0]){for(var e=fingerPrintsMap.length;e--;)fingerPrintsMap[e].setMap(null),fingerPrintsMap[e]=null;return _FINGERPRINTS_IS_ON=!(fingerPrintsMap=[]),document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),h.fingerPrintsMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"),h.fingerPrintsTimeMode=!1,"undefined"!=typeof Storage&&localStorage&&!h.radioHeatmapRSSTimeMode&&localStorage.setItem("fingerPrintsTimeMode","NO"),h.anyService.fingerPrintsTimeMode=!1,void(h.radioHeatmapRSSMode||document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green"))}if(heatmap&&heatmap.getMap()){heatmap.setMap(null),_FINGERPRINTS_IS_ON=!1,document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),h.fingerPrintsMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"),h.fingerPrintsTimeMode=!1,"undefined"!=typeof Storage&&localStorage&&!h.radioHeatmapRSSTimeMode&&localStorage.setItem("fingerPrintsTimeMode","NO"),h.anyService.fingerPrintsTimeMode=!1,_HEATMAP_F_IS_ON=!1,h.radioHeatmapRSSMode||document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green");for(e=heatmapFingerprints.length;e--;)heatmapFingerprints[e]=null;heatmapFingerprints=[]}else document.getElementById("fingerPrints-mode").classList.add("draggable-border-green"),h.fingerPrintsMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","YES"),h.radioHeatmapRSSTimeMode&&(h.fingerPrintsTimeMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"),h.anyService.fingerPrintsTimeMode=!0),h.showFingerPrints()},h.toggleLocalizationAccurancy=function(){if(void 0!==heatMap_Location[0]&&null!==heatMap_Location[0]||h.radioHeatmapLocalization){for(var e=heatMap_Location.length;e--;)heatMap_Location[e].setMap(null),heatMap_Location[e]=null;return o("g",_HEATMAP_Localization=!(heatMap_Location=[])),o("y",!1),o("o",!1),o("p",!1),o("r",!1),document.getElementById("localizationAccurancy-mode").classList.remove("draggable-border-green"),h.radioHeatmapLocalization=!1,h.localizationAccMode=!1,void("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("localizationAccMode","NO"))}h.showLocalizationAccHeatmap(),document.getElementById("localizationAccurancy-mode").classList.add("draggable-border-green")},h.toggleFingerPrintsTime=function(){h.fingerPrintsMode&&(h.fingerPrintsTimeMode=!h.fingerPrintsTimeMode,h.fingerPrintsTimeMode?"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"):"undefined"!=typeof Storage&&localStorage&&!h.radioHeatmapRSSTimeMode&&localStorage.setItem("fingerPrintsTimeMode","NO"),h.anyService.fingerPrintsTimeMode=!h.anyService.fingerPrintsTimeMode),h.radioHeatmapRSSMode&&(h.radioHeatmapRSSTimeMode=!h.radioHeatmapRSSTimeMode,h.radioHeatmapRSSTimeMode?"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerPrintsTimeMode","YES"):"undefined"!=typeof Storage&&localStorage&&!h.fingerPrintsTimeMode&&localStorage.setItem("fingerPrintsTimeMode","NO"),h.anyService.radioHeatmapRSSTimeMode=!h.anyService.radioHeatmapRSSTimeMode),!h.fingerPrintsTimeMode&&h.fingerPrintsMode&&(v(),h.showFingerPrints(),document.getElementById("fingerPrints-mode").classList.add("draggable-border-green"),document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green")),!h.radioHeatmapRSSTimeMode&&h.radioHeatmapRSSMode&&(y(),h.showRadioHeatmapRSS(),h.radioHeatmapRSSMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","YES"),h.anyService.radioHeatmapRSSMode=!0,document.getElementById("radioHeatmapRSS-mode").classList.add("draggable-border-green"),document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green")),h.radioHeatmapLocalization&&(P(),h.showRadioHeatmapRSS(),h.radioHeatmapRSSMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","YES"),h.anyService.radioHeatmapRSSMode=!0,document.getElementById("radioHeatmapRSS-mode").classList.add("draggable-border-green"),document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green")),!h.radioHeatmapRSSTimeMode&&h.radioHeatmapRSSMode&&(y(),h.showRadioHeatmapRSS(),h.radioHeatmapRSSMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","YES"),h.anyService.radioHeatmapRSSMode=!0,document.getElementById("radioHeatmapRSS-mode").classList.add("draggable-border-green"),document.getElementById("fingerPrints-time-mode").classList.remove("draggable-border-green")),(h.radioHeatmapRSSTimeMode||h.fingerPrintsTimeMode)&&h.getFingerPrintsTime()},h.togglePOIs=function(){POIsMap=h.anyService.getAllPois();var e=Object.keys(POIsMap);if(POIsMap.hasOwnProperty(e[0])){if(null!==POIsMap[e[0]].marker.getMap()&&void 0!==POIsMap[e[0]].marker.getMap()){for(var e in POIsMap){if(POIsMap.hasOwnProperty(e))(n=POIsMap[e])&&n.marker&&n.marker.setMap(null)}return h.anyService.setAllPois(POIsMap),_POIS_IS_ON=!(POIsMap={}),void("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("POIsMode","NO"))}for(var e in POIsMap){var n;if(POIsMap.hasOwnProperty(e))(n=POIsMap[e])&&n.marker&&n.marker.setMap(p.gmap)}h.anyService.setAllPois(POIsMap),_POIS_IS_ON=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("POIsMode","YES")}else m("No POIs yet.")},h.toggleConnections=function(){connectionsMap=h.anyService.getAllConnections();var e=Object.keys(connectionsMap);if(connectionsMap.hasOwnProperty(e[0])){if(void 0!==connectionsMap[e[0]].polyLine&&void 0!==connectionsMap[e[0]].polyLine.getMap()&&null!==connectionsMap[e[0]].polyLine.getMap()){for(var e in connectionsMap)if(connectionsMap.hasOwnProperty(e)){var n=connectionsMap[e];n&&n.polyLine&&n.polyLine.setMap(null)}return h.anyService.setAllConnection(connectionsMap),_CONNECTIONS_IS_ON=!(connectionsMap={}),void("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("connectionsMode","NO"))}h.showConnections()}else m("No edges yet.")},h.getHeatMapButtonText=function(){return void 0!==heatMap[0]&&null!==heatMap[0]?"Hide WiFi Map":"Show WiFi Map"},h.getAPsButtonText=function(){return void 0!==APmap[0]&&null!==APmap[0]?"Hide Estimated Wi-Fi AP Position":"Show Estimated Wi-Fi AP Position"},h.getFingerPrintsButtonText=function(){return void 0!==fingerPrintsMap[0]&&null!==fingerPrintsMap[0]||heatmap&&heatmap.getMap()?"Hide FingerPrints":"Show FingerPrints"},h.getFingerPrintTimeButtonText=function(){return h.fingerPrintsTimeMode?"Hide FingerPrints By Time":"Show FingerPrints By Time"},h.getHeatMapTimeButtonText=function(){return h.radioHeatmapRSSTimeMode?"Hide WiFi Map By Time":"Show WiFi Map By Time"},h.getLocalizationAccurancyText=function(){return h.localizationAccMode?"Hide Acces Map":"Show Acces Map"},h.getradiomapDelete=function(){return h.localizationAccMode1?"Radiomap Delete Successful ":"Show Acces Map"},h.getPOIsButtonText=function(){POIsMap=h.anyService.getAllPois();var e=Object.keys(POIsMap);return POIsMap.hasOwnProperty(e[0])&&void 0!==POIsMap[e[0]].marker.getMap()&&null!==POIsMap[e[0]].marker.getMap()?(document.getElementById("POIs-mode").classList.add("draggable-border-green"),h.POIsMode=!0,"Hide POIs"):(document.getElementById("POIs-mode").classList.remove("draggable-border-green"),h.POIsMode=!1,"Show POIs")},h.getConnectionsButtonText=function(){connectionsMap=h.anyService.getAllConnections();var e=Object.keys(connectionsMap);return connectionsMap.hasOwnProperty(e[0])&&void 0!==connectionsMap[e[0]].polyLine&&void 0!==connectionsMap[e[0]].polyLine.getMap()&&null!==connectionsMap[e[0]].polyLine.getMap()?(document.getElementById("connections-mode").classList.add("draggable-border-green"),h.connectionsMode=!0,"Hide Edges"):(document.getElementById("connections-mode").classList.remove("draggable-border-green"),h.connectionsMode=!1,"Show Edges")},$("#HMs_1").unbind().click(function(){$("#wifiTab").click(),$("#HMs").click(),$("#HMsButton").click()}),$("#APs_1").unbind().click(function(){$("#wifiTab").click(),$("#HMs").click(),$("#APsButton").click()}),$("#FPs_1").unbind().click(function(){$("#wifiTab").click(),$("#FPs").click(),$("#FPsButton").click()}),$("#DL_1").unbind().click(function(){$("#wifiTab").click(),$("#FPs").click(),$("#deleteButton").click()}),$("#FPs_2").unbind().click(function(){$("#wifiTab").click(),$("#FPs").click(),$("#FPsTimeButton").click()}),$("#LA_1").unbind().click(function(){$("#wifiTab").click(),$("#LAs").click(),$("#LAButton").click()}),$("#POIs_1").unbind().click(function(){$("#FPs").click(),$("#POIsButton").click()}),$("#CNs_1").unbind().click(function(){$("#FPs").click(),$("#connectionsButton").click()}),h.getHeatmapModeText=function(){return h.radioHeatmapRSSMode?"WiFi Map is online":"WiFi Map is offline"},h.getAPsModeText=function(){return h.APsMode?"Estimated Wi-Fi AP Position is online":"Estimated Wi-Fi AP Position is offline"},h.getFingerPrintsModeText=function(){return h.fingerPrintsMode?"FingerPrints are online":"FingerPrints are offline"},h.getDeleteFingerPrintsModeText=function(){return h.deleteFingerPrintsMode?"ON":"OFF"},h.getFingerPrintsTimeModeText=function(){return h.fingerPrintsTimeMode||h.radioHeatmapRSSTimeMode?"ON":"OFF"},h.getLocalizationAccurancyModeText=function(){return h.localizationAccMode?"Localization is online":"Localization is offline"},h.getPOIsModeText=function(){return h.POIsMode?"POIs are online":"POIs are offline"},h.getConnectionsModeText=function(){return h.connectionsMode?"Edges are online":"Edges are offline"},h.deleteFingerPrints=function(){if(_DELETE_FINGERPRINTS_IS_ON)return drawingManager.setMap(null),h.deleteButtonWarning=!1,document.getElementById("delete-mode").classList.remove("draggable-border-green"),_DELETE_FINGERPRINTS_IS_ON=!1,void(h.deleteFingerPrintsMode=!1);var l,s,d,c;_FINGERPRINTS_IS_ON||heatmap&&heatmap.getMap()?(h.deleteButtonWarning=!0,h.deleteFingerPrintsMode=!0,_DELETE_FINGERPRINTS_IS_ON=!0,document.getElementById("delete-mode").classList.add("draggable-border-green"),(drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.RECTANGLE,drawingControl:!1,rectangleOptions:{strokeColor:"#13B3E7",fillColor:"#ADD8E6",fillOpacity:.5}})).setMap(p.gmap),google.maps.event.addListener(drawingManager,"overlaycomplete",function(e){l=e.overlay.getBounds(),s=l.getNorthEast(),d=l.getSouthWest();for(var n=fingerPrintsMap.length;n--;)if(fingerPrintsMap[n].getPosition().lat()<=s.lat()&&fingerPrintsMap[n].getPosition().lng()<=s.lng()&&fingerPrintsMap[n].getPosition().lat()>=d.lat()&&fingerPrintsMap[n].getPosition().lng()>=d.lng()){c=confirm("Confirm:\nAre you sure you want to delete the selected fingerprints?");break}for(n=heatmapFingerprints.length;n--;)if(heatmapFingerprints[n].getPosition().lat()<=s.lat()&&heatmapFingerprints[n].getPosition().lng()<=s.lng()&&heatmapFingerprints[n].getPosition().lat()>=d.lat()&&heatmapFingerprints[n].getPosition().lng()>=d.lng()){c=confirm("Confirm:\nAre you sure you want to delete the selected fingerprints?");break}if(void 0===c)return alert("You have to select an area with Fingerprints to delete. "),e.overlay.setMap(null),drawingManager.setMap(null),h.deleteButtonWarning=!1,_DELETE_FINGERPRINTS_IS_ON=!1,h.deleteFingerPrintsMode=!1,void document.getElementById("delete-mode").classList.remove("draggable-border-green");if(c){var i,o=h.anyService.getBuilding(),t=h.anyService.getFloorNumber(),a=h.creds;if(!h.owner_id)return void m("Could not identify user. Please refresh and sign in again.");if(a.owner_id=h.owner_id,!o||!o.buid)return void m("No building selected");a.buid=o.buid,a.floor=t,a.lat1=s.lat()+"",a.lon1=s.lng()+"",a.lat2=d.lat()+"",a.lon2=d.lng()+"",i=h.fingerPrintsTimeMode?(a.timestampX=userTimeData[0]+"",a.timestampY=userTimeData[1]+"",h.anyAPI.deleteFingerprintsByTime(a)):h.anyAPI.deleteFingerprints(a);var r=[];_HEATMAP_F_IS_ON||_HEATMAP_RSS_IS_ON?_HEATMAP_F_IS_ON&&!_HEATMAP_RSS_IS_ON?u("The fingerprints are scheduled to be deleted. A new radiomap for fingerprints will be regenerated shortly after."):!_HEATMAP_F_IS_ON&&_HEATMAP_RSS_IS_ON?u("The fingerprints are scheduled to be deleted. A new radiomap for Wi-Fi coverage will be regenerated shortly after."):_HEATMAP_F_IS_ON&&_HEATMAP_RSS_IS_ON&&u("The fingerprints are scheduled to be deleted. New radiomaps for fingerprints and Wi-Fi coverage will be regenerated shortly after."):u("The fingerprints are scheduled to be deleted."),i.then(function(e){if(r=e.data.radioPoints,console.log("fingerPrints deleted "),0<r.length){for(var n=fingerPrintsMap.length;n--;)fingerPrintsMap[n].getPosition().lat()<=s.lat()&&fingerPrintsMap[n].getPosition().lng()<=s.lng()&&fingerPrintsMap[n].getPosition().lat()>=d.lat()&&fingerPrintsMap[n].getPosition().lng()>=d.lng()&&fingerPrintsMap[n].setMap(null);if(_HEATMAP_F_IS_ON){heatmap.setMap(null);var i=[];for(n=heatmapFingerprints.length;n--;)null!==heatmapFingerprints[n]&&(heatmapFingerprints[n].getPosition().lat()>s.lat()||heatmapFingerprints[n].getPosition().lng()>s.lng()||heatmapFingerprints[n].getPosition().lat()<d.lat()||heatmapFingerprints[n].getPosition().lng()<d.lng()?i.push({location:heatmapFingerprints[n].getPosition(),weight:1}):heatmapFingerprints[n]=null);(heatmap=new google.maps.visualization.HeatmapLayer({data:i})).setMap(h.gmapService.gmap)}if(_HEATMAP_RSS_IS_ON)for(n=heatMap.length;n--;)heatMap[n].location.lat()<=s.lat()&&heatMap[n].location.lng()<=s.lng()&&heatMap[n].location.lat()>=d.lat()&&heatMap[n].location.lng()>=d.lng()&&heatMap[n].rectangle.setMap(null);if(_HEATMAP_Localization)for(n=heatMap_Location.length;n--;)heatMap_Location[n].location.lat()<=s.lat()&&heatMap_Location[n].location.lng()<=s.lng()&&heatMap_Location[n].location.lat()>=d.lat()&&heatMap_Location[n].location.lng()>=d.lng()&&heatMap_Location[n].setMap(null)}u("Successfully deleted "+r.length+" fingerPrints.")},function(e){e.data;m("Something went wrong. It's likely that everything related to the fingerPrints is deleted but please refresh to make sure or try again."),document.getElementById("delete-mode").classList.remove("draggable-border-green")})}e.overlay.setMap(null),drawingManager.setMap(null),h.deleteButtonWarning=!1,_DELETE_FINGERPRINTS_IS_ON=!1,h.deleteFingerPrintsMode=!1,document.getElementById("delete-mode").classList.remove("draggable-border-green")})):m("You have to press show fingerPrints button first")},h.getColorBarTextFor=function(e){return f(e.charAt(0))?"click to show "+e+" ones":"click to hide "+e+" ones"},h.hideRSSExcept=function(e){if("g"!==e||h.radioHeatmapRSSHasGreen)if("y"!==e||h.radioHeatmapRSSHasYellow)if("o"!==e||h.radioHeatmapRSSHasOrange)if("p"!==e||h.radioHeatmapRSSHasPurple)if("r"!==e||h.radioHeatmapRSSHasRed){for(var n=heatMap.length;n--;)f(e)?heatMap[n].id===e&&(heatMap[n].rectangle.setMap(h.gmapService.gmap),heatMap[n].clicked=!0):heatMap[n].id===e&&(heatMap[n].rectangle.setMap(null),heatMap[n].clicked=!1);o(e,!f(e))}else m("Wi-Fi coverage map has no red squares");else m("Wi-Fi coverage map has no purple squares");else m("Wi-Fi coverage map has no orange squares");else m("Wi-Fi coverage map has no yellow squares");else m("Wi-Fi coverage map has no green squares")},h.showRadioHeatmapRSS=function(){var e,n;s=p.gmap.getZoom(),void 0!==(n=(h.radioHeatmapRSSTimeMode||h.fingerPrintsTimeMode)&&0<userTimeData.length?((e={buid:h.anyService.getBuildingId(),floor:h.anyService.getFloorNumber(),timestampX:userTimeData[0],timestampY:userTimeData[1]}).username=h.creds.username,e.password=h.creds.password,19<s&&s<21?(levelOfZoom=2,h.anyAPI.getRadioHeatmapRSSByTime_2(e)):19<s?(levelOfZoom=3,h.anyAPI.getRadioHeatmapRSSByTime_3(e)):(levelOfZoom=1,h.anyAPI.getRadioHeatmapRSSByTime_1(e))):((e={buid:h.anyService.getBuildingId(),floor:h.anyService.getFloorNumber()}).username=h.creds.username,e.password=h.creds.password,19<s&&s<21?(levelOfZoom=2,h.anyAPI.getRadioHeatmapRSS_2(e)):19<s?(levelOfZoom=3,h.anyAPI.getRadioHeatmapRSS_3(e)):(levelOfZoom=1,h.anyAPI.getRadioHeatmapRSS_1(e))))&&n.then(function(e){e.data;var n=[],i=e.data.radioPoints.length;if(i<=0)return m("This floor seems not to be WiFi mapped. Download the Anyplace app from the Google Play store to map the floor."),void(h.radioHeatmapRSSTimeMode?m("No fingerprints at this period.\n Please choose another one."):(document.getElementById("radioHeatmapRSS-mode").classList.remove("draggable-border-green"),h.radioHeatmapRSSMode=!1,"undefined"!=typeof Storage&&localStorage&&!h.fingerPrintsTimeMode&&localStorage.setItem("radioHeatmapRSSMode","NO")));for(var o=0;i--;){var t=e.data.radioPoints[i],a=JSON.parse(t.w);(p=parseFloat(a.average))<=-30&&-60<=p?(n.push({location:new google.maps.LatLng(t.x,t.y),weight:p,color:"#4ed419",id:"g"}),h.radioHeatmapRSSHasGreen=!0):p<-60&&-70<=p?(n.push({location:new google.maps.LatLng(t.x,t.y),weight:p,color:"#ffff00",id:"y"}),h.radioHeatmapRSSHasYellow=!0):p<-70&&-90<=p?(n.push({location:new google.maps.LatLng(t.x,t.y),weight:p,color:"#ffa500",id:"o"}),h.radioHeatmapRSSHasOrange=!0):p<-90&&-100<=p?(n.push({location:new google.maps.LatLng(t.x,t.y),weight:p,color:"#bd06bd",id:"p"}),h.radioHeatmapRSSHasPurple=!0):(n.push({location:new google.maps.LatLng(t.x,t.y),weight:p,color:"#ff0000",id:"r"}),h.radioHeatmapRSSHasRed=!0);var r,l=n[o].location;r=3==levelOfZoom?new google.maps.Size(.75,.75):2==levelOfZoom?new google.maps.Size(2,2):new google.maps.Size(5,5);var s=google.maps.geometry.spherical.computeOffset(l,r.height,0).lat(),d=google.maps.geometry.spherical.computeOffset(l,r.height,180).lat(),c=google.maps.geometry.spherical.computeOffset(l,r.width,90).lng(),p=google.maps.geometry.spherical.computeOffset(l,r.width,270).lng(),u=new google.maps.Rectangle({strokeColor:n[o].color,strokeOpacity:1,strokeWeight:1,fillColor:n[o].color,fillOpacity:.5,bounds:new google.maps.LatLngBounds(new google.maps.LatLng(d,p),new google.maps.LatLng(s,c))});f(n[o].id)?u.setMap(null):u.setMap(h.gmapService.gmap),heatMap.push({rectangle:u,location:l,id:n[o].id,clicked:!1}),o++,e.data.radioPoints.splice(i,1)}_HEATMAP_RSS_IS_ON=!0,g.put("RSSClicked","YES")},function(e){e.data;m("Something went wrong while fetching radio heatmap."),h.radioHeatmapRSSTimeMode||(h.radioHeatmapRSSMode=!1,"undefined"!=typeof Storage&&localStorage&&!h.fingerPrintsTimeMode&&localStorage.setItem("radioHeatmapRSSMode","NO"),document.getElementById("radioHeatmapRSS-mode").classList.remove("draggable-border-green"))})},h.getAPsIds=function(e){var n={};n.ids=e,h.anyAPI.getAPsIds(n).then(function(e){var n=e.data.accessPoints,i=n.length;if(i<=0)m("Access Points seems to not have ids");else{for(var o=new Set;i--;)APmap[i].mun=n[i],o.add(n[i]);o.forEach(function(e){"N/A"!==e&&(h.example8data.push({id:e,label:e}),h.example8model.push({id:e,label:e}))})}},function(e){e.data;m("Something went wrong while fetching the ids of access points.")})},h.showAPs=function(){var d,e={buid:h.anyService.getBuildingId(),floor:h.anyService.getFloorNumber()};e.username=h.creds.username,e.password=h.creds.password,h.anyAPI.getAPs(e).then(function(e){if((d=e.data.accessPoints.length)<=0)return m("This floor seems not to be Access Point mapped. Download the Anyplace app from the Google Play store to map the floor."),h.APsMode=!1,void document.getElementById("APs-mode").classList.remove("draggable-border-green");var n=e.data.accessPoints;d=n.length;var i=new google.maps.Size(21,32);d=n.length;for(var o,t,a=0,r=[];d--;){if(1e3==a){m("Access Points have exceeded the maximun limit of 1000");break}t=0!=n[d].den?(o=n[d].x/n[d].den,n[d].y/n[d].den):(o=n[d].x,n[d].y),h.example9data.push({id:n[d].AP,label:n[d].AP}),h.example9model.push({id:n[d].AP,label:n[d].AP});var l=new google.maps.Marker({id:n[d].AP,position:new google.maps.LatLng(o,t),map:p.gmap,icon:{url:"build/images/access-point-icon.svg",scaledSize:i}});APmap.push(l),r.push(l.id);var s=new google.maps.InfoWindow;s.getMap()||APmap[a].addListener("click",function(){"N/A"!==this.mun?s.setContent(this.id+"<br><center>-</center><br>"+this.mun):s.setContent(this.id),s.open(this.gmap,this)}),a++}h.getAPsIds(r)},function(e){e.data;h.APsMode=!1,m("Something went wrong while fetching Access Points."),document.getElementById("APs-mode").classList.remove("draggable-border-green")})},h.getFingerPrintsTime=function(){var e={buid:h.anyService.getBuildingId(),floor:h.anyService.getFloorNumber()};e.username=h.creds.username,e.password=h.creds.password,h.anyAPI.getFingerprintsTime(e).then(function(e){var n=e.data.radioPoints;n.length<=0?m("This floor seems not to be FingerPrint mapped. Download the Anyplace app from the Google Play store to map the floor."):(function(e){var n=d3.format(",d");e.forEach(function(e,n){e.index=n,e.date=function(e){return new Date(e/1e3*1e3)}(e.date)});var i=crossfilter(e),o=i.groupAll(),t=i.dimension(function(e){return e.date}),a=t.group(d3.time.day).reduceSum(function(e){return e.count}),r=e[e.length-1].date.toString(),l=new Date(r);l.setDate(l.getDate()+15);var s=[function e(){e.id||(e.id=0);var s,d,o,c,t,p={top:10,right:10,bottom:20,left:10},u=d3.scale.linear().range([100,0]),g=e.id++,m=d3.svg.axis().orient("bottom"),f=d3.svg.brush();function n(e){var t=s.range()[1],a=u.range()[0];function r(e){for(var n,i=[],o=-1,t=e.length;++o<t;)n=e[o],i.push("M",s(n.key),",",a,"V",u(n.value),"h9V",a);return i.join("")}function l(e){var n=+("e"==e),i=n?1:-1,o=a/3;return"M"+.5*i+","+o+"A6,6 0 0 "+n+" "+6.5*i+","+(6+o)+"V"+(2*o-6)+"A6,6 0 0 "+n+" "+.5*i+","+2*o+"ZM"+2.5*i+","+(8+o)+"V"+(2*o-8)+"M"+4.5*i+","+(8+o)+"V"+(2*o-8)}u.domain([0,c.top(1)[0].value]),e.each(function(){var e=d3.select(this),n=e.select("g");if(n.empty()){e.select(".title").append("a").attr("href","javascript:reset("+g+")").attr("class","reset").text("reset").style("display","none"),(n=e.append("svg").attr("width",t+p.left+p.right).attr("height",a+p.top+p.bottom).append("g").attr("transform","translate("+p.left+","+p.top+")")).append("clipPath").attr("id","clip-"+g).append("rect").attr("width",t).attr("height",a),n.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(e){return e+" bar"}).datum(c.all()),n.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+g+")"),n.append("g").attr("class","axis").attr("transform","translate(0,"+a+")").call(m);var i=n.append("g").attr("class","brush").call(f);i.selectAll("rect").attr("height",a),i.selectAll(".resize").append("path").attr("d",l)}if(d)if(d=!1,n.selectAll(".brush").call(f),e.select(".title a").style("display",f.empty()?"none":null),f.empty())n.selectAll("#clip-"+g+" rect").attr("x",0).attr("width",t);else{var o=f.extent();n.selectAll("#clip-"+g+" rect").attr("x",s(o[0])).attr("width",s(o[1])-s(o[0]))}n.selectAll(".bar").attr("d",r)})}f.on("brushstart.chart",function(){var e=d3.select(this.parentNode.parentNode.parentNode);e.select(".title a").style("display",null)});f.on("brush.chart",function(){var e=d3.select(this.parentNode),n=f.extent();function i(){S(),n=f.extent(),userTimeData=[],n.forEach(function(e){var n=String(e.getTime()/1e3*1e3);userTimeData.push(n)}),h.fingerPrintsMode&&(v(),h.showFingerPrints(),document.getElementById("fingerPrints-mode").classList.add("draggable-border-green")),h.radioHeatmapRSSMode&&(y(),h.showRadioHeatmapRSS(),h.radioHeatmapRSSMode=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapRSSMode","YES"),h.anyService.radioHeatmapRSSMode=!0,document.getElementById("radioHeatmapRSS-mode").classList.add("draggable-border-green")),h.radioHeatmapLocalization&&(P(),h.showRadioHeatmap(),h.radioHeatmapLocalization=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("radioHeatmapLocalization","YES"),h.anyService.radioHeatmapLocalization=!0,document.getElementById("radioHeatmapRSS-mode").classList.add("draggable-border-green"))}t&&e.select(".brush").call(f.on("brushend",i)).selectAll(".resize").style("display",null),e.select("#clip-"+g+" rect").attr("x",s(n[0])).attr("width",s(n[1])-s(n[0])),o.filterRange(n)});f.on("brushend.chart",function(){if(f.empty()){var e=d3.select(this.parentNode.parentNode.parentNode);e.select(".title a").style("display","none"),e.select("#clip-"+g+" rect").attr("x",null).attr("width","100%"),o.filterAll()}});n.margin=function(e){return arguments.length?(p=e,n):p};n.x=function(e){return arguments.length?(s=e,m.scale(s),f.x(s),n):s};n.y=function(e){return arguments.length?(u=e,n):u};n.dimension=function(e){return arguments.length?(o=e,n):o};n.filter=function(e){return e?(f.extent(e),o.filterRange(e)):(f.clear(),o.filterAll()),d=!0,n};n.group=function(e){return arguments.length?(c=e,n):c};n.round=function(e){return arguments.length?(t=e,n):t};return d3.rebind(n,f,"on")}().dimension(t).group(a).round(d3.time.day.round).x(d3.time.scale().domain([e[0].date,l]).rangeRound([0,1e3])).filter([e[0].date,l])],d=d3.selectAll(".chart").data(s).each(function(e){e.on("brush",p).on("brushend",p)});function c(e){d3.select(this).call(e)}function p(){d.each(c),d3.select("#active").text(n(o.value()))}d3.selectAll("#total").text(n(i.size())),p(),window.filter=function(e){e.forEach(function(e,n){s[n].filter(e)}),p()},window.reset=function(e){s[e].filter(null),p()}}(n),S())},function(e){e.data;m("Something went wrong while fetching fingerPrints timestamp.")})},h.showFingerPrints=function(){var e,n;if((h.fingerPrintsTimeMode||h.radioHeatmapRSSTimeMode)&&0<userTimeData.length)if((e={buid:h.anyService.getBuildingId(),floor:h.anyService.getFloorNumber(),timestampX:userTimeData[0],timestampY:userTimeData[1]}).username=h.creds.username,e.password=h.creds.password,22!==s)n=h.anyAPI.getRadioHeatmapRSSByTime(e);else{var i="my_custom_layer",o=new google.maps.ImageMapType({name:i,getTileUrl:function(e,n){if(22!==s||!h.fingerPrintsTimeMode)return null;var i={buid:h.anyService.getBuildingId(),floor:h.anyService.getFloorNumber(),timestampX:userTimeData[0],timestampY:userTimeData[1]};return i.username=h.creds.username,i.password=h.creds.password,i.x=e.x,i.y=e.y,i.z=n,h.anyAPI.getRadioHeatmapRSSByTime_Tiles(i).then(function(e){e.data;for(var n=[],i=e.data.radioPoints.length;i--;){var o=e.data.radioPoints[i];n.push({location:new google.maps.LatLng(o.x,o.y)}),e.data.radioPoints.splice(i,1)}var t=new google.maps.Size(21,32);for(i=n.length;i--;)if(22===s){var a=new google.maps.Marker({position:n[i].location,map:p.gmap,icon:new google.maps.MarkerImage("build/images/fingerPrint-icon.png",null,null,null,t)});fingerPrintsMap.push(a)}_FINGERPRINTS_IS_ON=!0},function(e){e.data;m("Something went wrong while fetching fingerPrints."),h.fingerPrintsMode||(document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),h.fingerPrintsMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"))}),null},tileSize:new google.maps.Size(256,256),minZoom:1,maxZoom:22});p.gmap.mapTypes.set(i,o),p.gmap.setMapTypeId(i)}else if((e={buid:h.anyService.getBuildingId(),floor:h.anyService.getFloorNumber()}).username=h.creds.username,e.password=h.creds.password,22!==s)n=h.anyAPI.getRadioHeatmapRSS_3(e);else{i="my_custom_layer1",o=new google.maps.ImageMapType({name:i,getTileUrl:function(e,n){if(22!==s||!h.fingerPrintsMode)return null;var i={buid:h.anyService.getBuildingId(),floor:h.anyService.getFloorNumber()};return i.username=h.creds.username,i.password=h.creds.password,i.x=e.x,i.y=e.y,i.z=n,h.anyAPI.getRadioHeatmapRSS_3_Tiles(i).then(function(e){e.data;for(var n=[],i=e.data.radioPoints.length;i--;){var o=e.data.radioPoints[i];n.push({location:new google.maps.LatLng(o.x,o.y)}),e.data.radioPoints.splice(i,1)}var t=new google.maps.Size(21,32);for(i=n.length;i--;)if(22===s){var a=new google.maps.Marker({position:n[i].location,map:p.gmap,icon:new google.maps.MarkerImage("build/images/fingerPrint-icon.png",null,null,null,t)});fingerPrintsMap.push(a)}_FINGERPRINTS_IS_ON=!0},function(e){e.data;m("Something went wrong while fetching fingerPrints."),h.fingerPrintsMode||(document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),h.fingerPrintsMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"))}),null},tileSize:new google.maps.Size(256,256),minZoom:1,maxZoom:22});p.gmap.mapTypes.set(i,o),p.gmap.setMapTypeId(i)}void 0!==n&&n.then(function(e){e.data;var n=[],i=e.data.radioPoints.length;if(i<=0)h.fingerPrintsTimeMode?m("No fingerprints at this period.\n Please choose another one."):(m("This floor seems not to be FingerPrint mapped. Download the Anyplace app from the Google Play store to map the floor."),document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),h.fingerPrintsMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"));else if(22==s){for(;i--;){var o=e.data.radioPoints[i];n.push({location:new google.maps.LatLng(o.x,o.y)}),e.data.radioPoints.splice(i,1)}var t=new google.maps.Size(21,32);for(i=n.length;i--;){var a=new google.maps.Marker({position:n[i].location,map:p.gmap,icon:new google.maps.MarkerImage("build/images/fingerPrint-icon.png",null,null,null,t)});fingerPrintsMap.push(a)}_FINGERPRINTS_IS_ON=!0}else{for(var r=[],l=0;i--;){o=e.data.radioPoints[i],JSON.parse(o.w),new google.maps.Polygon({paths:[{lat:35.14421,lng:33.41123},{lat:35.14408,lng:33.41134},{lat:35.14433,lng:33.41167},{lat:35.14445,lng:33.41157},{lat:35.14421,lng:33.41123}],strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35}),new google.maps.LatLng(o.x,o.y);r.push({location:new google.maps.LatLng(o.x,o.y),weight:100});a=new google.maps.Marker({position:r[l].location});heatmapFingerprints.push(a),e.data.radioPoints.splice(i,1),l++}(heatmap=new google.maps.visualization.HeatmapLayer({data:r})).setMap(h.gmapService.gmap),_HEATMAP_F_IS_ON=!0}},function(e){e.data;m("Something went wrong while fetching fingerPrints."),h.fingerPrintsMode||(document.getElementById("fingerPrints-mode").classList.remove("draggable-border-green"),h.fingerPrintsMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("fingerprintsMode","NO"))})},h.showLocalizationAccHeatmap=function(){var e={buid:h.anyService.getBuildingId(),floor:h.anyService.getFloorNumber()};e.username=h.creds.username,e.password=h.creds.password;var n=h.anyAPI.getHeatmapAcces(e);s=p.gmap.getZoom(),levelOfZoom=19<s&&s<21?2:19<s?3:1,n.then(function(e){var n=e.data.crlb,i=(n.length,e.data.geojson.coordinates),o=i.length;if(o<=0)return m("This floor seems not to be FingerPrint mapped. Download the Anyplace app from the Google Play store to map the floor."),document.getElementById("localizationAccurancy-mode").classList.remove("draggable-border-green"),h.localizationAccMode=!1,void("undefined"!=typeof Storage&&localStorage&&localStorage.setItem("localizationAccMode","NO"));for(;o--;){var t=i[o],a="#ffffff";a=isNaN(n[o])||n[o]<0?"#000000":0<n[o]&&n[o]<5?"#33cc33":5<n[o]&&n[o]<10?"#99ff33":10<n[o]&&n[o]<15?"#fdff76":15<n[o]&&n[o]<30?"#ffd716":30<n[o]&&n[o]<60?"#ff8a1b":"#ff391e";var r=new google.maps.Circle({strokeWeight:.5,strokeColor:"#ffffff",fillColor:a,fillOpacity:.5,map:h.gmapService.gmap,center:{lat:t[0],lng:t[1]},radius:1.5});heatMap_Location.push(r),i.splice(o,1),0}document.getElementById("localizationAccurancy-mode").classList.add("draggable-border-green"),h.localizationAccMode=!0,"undefined"!=typeof Storage&&localStorage?localStorage.setItem("localizationAccMode","NO"):localStorage.setItem("localizationAccMode","YES"),_HEATMAP_Localization=!0,h.radioHeatmapLocalization=!0},function(e){e.data;m("Something went wrong while fetching fingerPrints."),document.getElementById("localizationAccurancy-mode").classList.remove("draggable-border-green"),h.localizationAccMode=!1,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("localizationAccMode","NO")})},h.showConnections=function(){for(var e in connectionsMap)if(connectionsMap.hasOwnProperty(e)){var n=connectionsMap[e];n&&n.polyLine&&n.polyLine.setMap(p.gmap)}_CONNECTIONS_IS_ON=!0,h._CONNECTIONS_IS_ON=!0,"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("connectionsMode","YES"),h.anyService.setAllConnection(connectionsMap)},p.gmap.addListener("zoom_changed",function(){if(22!==(s=p.gmap.getZoom())){for(var e=fingerPrintsMap.length;e--;)fingerPrintsMap[e].setMap(null),fingerPrintsMap[e]=null;fingerPrintsMap=[]}if(_HEATMAP_RSS_IS_ON&&(19==i&&i<s||19<i&&i<21&&(s<=19||21<=s)||21==i&&s<i)){for(e=heatMap.length;e--;)heatMap[e].rectangle.setMap(null),heatMap[e]=null;heatMap=[],h.showRadioHeatmapRSS()}if(_HEATMAP_Localization&&(19==i&&i<s||19<i&&i<21&&(s<=19||21<=s)||21==i&&s<i)){for(e=heatMap_Location.length;e--;)heatMap_Location[e].setMap(null),heatMap_Location[e]=null;heatMap_Location=[],h.showLocalizationAccHeatmap()}if((_FINGERPRINTS_IS_ON||heatmap&&heatmap.getMap())&&!changedfloor&&(22==s||22==i)){for(e=fingerPrintsMap.length;e--;)fingerPrintsMap[e].setMap(null),fingerPrintsMap[e]=null;if(fingerPrintsMap=[],heatmap&&heatmap.getMap()){heatmap.setMap(null);for(e=heatmapFingerprints.length;e--;)heatmapFingerprints[e]=null;_HEATMAP_F_IS_ON=!(heatmapFingerprints=[])}h.showFingerPrints()}i=s}),h.selectFilterForAPs=function(){switch(h.selected){case"0":h.filterByMAC=!0,h.filterByMAN=!1;break;default:h.filterByMAC=!1,h.filterByMAN=!0}},h.multiuserevents={onItemDeselect:function(e){for(var n=APmap.length;n--;)if(APmap[n].id==e.id){APmap[n].setVisible(!1);break}},onItemSelect:function(e){for(var n=APmap.length;n--;)if(APmap[n].id==e.id){APmap[n].setVisible(!0);break}},onDeselectAll:function(){for(var e=APmap.length;e--;)APmap[e].setVisible(!1)}},h.multiuserevents1={onItemDeselect:function(e){for(var n=APmap.length;n--;)if(APmap[n].mun==e.id){APmap[n].setVisible(!1);break}},onItemSelect:function(e){for(var n=APmap.length;n--;)if(APmap[n].mun==e.id){APmap[n].setVisible(!0);break}},onDeselectAll:function(){for(var e=APmap.length;e--;)APmap[e].setVisible(!1)}}}]);changedfloor=!1;app.controller("FloorController",["$scope","AnyplaceService","GMapService","AnyplaceAPIService",function(l,s,d,i){var t;l.anyService=s,l.anyAPI=i,l.gmapService=d,l.xFloors=[],l.myFloors={},l.myFloorId=0;l.newFloorNumber=0;l.crudTabSelected=1,l.setCrudTabSelected=function(e){l.crudTabSelected=e},l.isCrudTabSelected=function(e){return l.crudTabSelected===e},l.data={floor_plan_coords:{},floor_plan_base64_data:{},floor_plan_groundOverlay:null},l.$on("loggedOff",function(e,n){o()});var o=function(){l.removeFloorPlan(),l.xFloors=[],l.myFloorId=0,l.myFloors={}};l.$watch("anyService.selectedBuilding",function(e,n){e&&(changedfloor=!1,l.fetchAllFloorsForBuilding(e))}),l.$watch("newFloorNumber",function(e,n){});function c(e){l.anyService.addAlert("danger",e)}function a(e){l.anyService.addAlert("success",e)}l.$watch("anyService.selectedFloor",function(e,n){null==e||_.isEqual(e,n)||(l.fetchFloorPlanOverlay(e),d.gmap.panTo(function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}}(l.anyService.selectedBuilding)),d.gmap.setZoom(19),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastFloor",e.floor_number),changedfloor=!1)}),l.fetchAllFloorsForBuilding=function(e){var n=s.jsonReq;n.buid=e.buid,i.allBuildingFloors(n).then(function(e){if(l.xFloors=e.data.floors,l.xFloors=l.xFloors.sort(function(e,n){return parseInt(e.floor_number)-parseInt(n.floor_number)}),l.anyService.availableFloors=[],l.anyService.availableFloors=l.xFloors,l.urlFloor)for(var n=0;n<l.xFloors.length;n++)if(l.urlFloor==l.xFloors[n].floor_number)return void(l.anyService.selectedFloor=l.xFloors[n]);if("undefined"!=typeof Storage&&localStorage&&!LPUtils.isNullOrUndefined(localStorage.getItem("lastBuilding"))&&!LPUtils.isNullOrUndefined(localStorage.getItem("lastFloor")))for(var i=0;i<l.xFloors.length;i++)if(String(l.xFloors[i].floor_number)===String(localStorage.getItem("lastFloor")))return void(l.anyService.selectedFloor=l.xFloors[i]);l.xFloors&&0<l.xFloors.length?l.anyService.selectedFloor=l.xFloors[0]:l.anyService.selectedFloor=void 0,r()},function(e){console.log(e.data.message),c("Something went wrong while fetching all floors")})};var r=function(){for(var e=-1,n=0;n<l.xFloors.length;n++)parseInt(l.xFloors[n].floor_number)>=e&&(e=parseInt(l.xFloors[n].floor_number));l.newFloorNumber=e+1};l.fetchFloorPlanOverlay=function(){if(function(e){return null!==e&&null!=e&&(null!==e.floor_number&&void 0!==e.floor_number)}(this.anyService.selectedFloor)){var e=this.anyService.selectedFloor.floor_number,n=this.anyService.selectedBuilding.buid;i.downloadFloorPlan(this.anyService.jsonReq,n,e).then(function(e){l.data.floor_plan_file=null,(l.data.floor_plan=null)!=l.data.floor_plan_groundOverlay&&(l.data.floor_plan_groundOverlay.setMap(null),l.data.floor_plan_groundOverlay=null);var n=e.data,i=l.anyService.selectedFloor,o=new google.maps.LatLngBounds(new google.maps.LatLng(i.bottom_left_lat,i.bottom_left_lng),new google.maps.LatLng(i.top_right_lat,i.top_right_lng));l.data.floor_plan_groundOverlay=new USGSOverlay(o,"data:image/png;base64,"+n,d.gmap)},function(e){console.log("error downloading floor plan")})}else console.log("something is wrong with the floor")};var p=null;l.isCanvasOverlayActive=!1,$("#input-floor-plan").change(function(e){var n=new FileReader;n.onload=function(e){var n=new Image;n.src=e.target.result,n.onload=function(){p=new CanvasOverlay(n,d.gmap),l.$apply(l.isCanvasOverlayActive=!0),l.data.floor_plan_groundOverlay&&l.data.floor_plan_groundOverlay.getMap()&&l.data.floor_plan_groundOverlay.setMap(null)}},n.readAsDataURL(e.target.files[0]),this.disabled=!0}),l.setFloorPlan=function(){if(p)if(d.gmap.getZoom()<20)c("You have provided zoom level "+d.gmap.getZoom()+". You have to zoom at least to level 20 to upload the floorplan.");else{null!==s.getBuildingId()&&void 0!==s.getBuildingId()||(console.log("building is undefined"),c("Something went wrong. It seems like there is no building selected"));var e={is_published:"true",buid:String(s.getBuildingId()),floor_name:String(l.newFloorNumber),description:String(l.newFloorNumber),floor_number:String(l.newFloorNumber)};l.myFloors[l.myFloorId]=e,l.myFloorId++,p.drawBoundingCanvas();var n=p.bottom_left_coords,i=p.top_right_coords;l.data.floor_plan_coords.bottom_left_lat=n.lat(),l.data.floor_plan_coords.bottom_left_lng=n.lng(),l.data.floor_plan_coords.top_right_lat=i.lat(),l.data.floor_plan_coords.top_right_lng=i.lng(),l.data.floor_plan_coords.zoom=d.gmap.getZoom()+"";var o=p.getCanvas().toDataURL("image/png");l.data.floor_plan_base64_data=o;var t=new google.maps.LatLngBounds(new google.maps.LatLng(n.lat(),n.lng()),new google.maps.LatLng(i.lat(),i.lng()));if(l.data.floor_plan_groundOverlay=new USGSOverlay(t,o,d.gmap),p.setMap(null),$("#input-floor-plan").prop("disabled",!1),l.isCanvasOverlayActive=!1,u(l.newFloorNumber))for(var a=0;a<l.xFloors.length;a++){var r=l.xFloors[a];if(!LPUtils.isNullOrUndefined(r)&&r.floor_number===String(l.newFloorNumber)){l.uploadFloorPlanBase64(l.anyService.selectedBuilding,r,l.data);break}}else l.addFloorObject(e,l.anyService.selectedBuilding,l.data)}};l.addFloorObject=function(e,n,i){var o=function(e){return e=null===e?{}:JSON.parse(JSON.stringify(e)),LPUtils.isNullOrUndefined(e.buid)&&(e.buid=""),LPUtils.isNullOrUndefined(e.floor_name)&&(e.floor_name=""),LPUtils.isNullOrUndefined(e.floor_number)&&(e.floor_number=""),LPUtils.isNullOrUndefined(e.description)&&(e.description=""),LPUtils.isNullOrUndefined(e.is_published)&&(e.is_published="true"),e}(e);(o.owner_id=l.owner_id,o.owner_id)?l.anyAPI.addFloor(o).then(function(e){e.data;l.xFloors.push(o),l.anyService.selectedFloor=l.xFloors[l.xFloors.length-1],a("Successfully added new floor"),l.uploadFloorPlanBase64(n,o,i)},function(e){var n=e.data;console.log(n.message),c("Something went wrong while adding a new floor.")}):c("Could not authorize user. Please refresh.")},l.removeFloorPlan=function(){l.data.floor_plan_file=null,l.data.floor_plan=null,p&&p.setMap(null),l.data.floor_plan_groundOverlay&&l.data.floor_plan_groundOverlay.setMap(null);var e=$("#input-floor-plan");e.replaceWith(e=e.clone(!0)),e.prop("disabled",!1),l.isCanvasOverlayActive=!1},l.deleteFloor=function(){var t=l.anyService.getFloor();LPUtils.isNullOrUndefined(t)||LPUtils.isStringBlankNullUndefined(t.floor_number)||LPUtils.isStringBlankNullUndefined(t.buid)?c("No floor seems to be selected."):(t.username=l.creds.username,t.password=l.creds.password,t.owner_id=l.owner_id,console.log(t),l.anyAPI.deleteFloor(t).then(function(e){e.data;for(var n=l.xFloors,i=n.length,o=0;o<i;o++)if(n[o].floor_number==t.floor_number){n.splice(o,1);break}null!=l.data.floor_plan_groundOverlay&&(l.data.floor_plan_groundOverlay.setMap(null),l.data.floor_plan_groundOverlay=null),l.xFloors&&0<l.xFloors.length?l.anyService.selectedFloor=l.xFloors[0]:l.anyService.selectedFloor=void 0,a("Successfully deleted floor.")},function(e){e.data;c("Something went wrong while deleting the floor.")}))};var u=function(e){for(var n=0;n<l.xFloors.length;n++){var i=l.xFloors[n];if(!LPUtils.isNullOrUndefined(i)&&i.floor_number===String(e))return!0}return!1};l.uploadFloorPlanBase64=function(e,n,i){if(!LPUtils.isNullOrUndefined(p)){var o=function(e){return LPUtils.isNullOrUndefined(e)?{}:JSON.parse(JSON.stringify(e))}(i.floor_plan_coords);if(LPUtils.isNullOrUndefined(o)||LPUtils.isStringBlankNullUndefined(o.bottom_left_lat)||LPUtils.isStringBlankNullUndefined(o.bottom_left_lng)||LPUtils.isStringBlankNullUndefined(o.top_right_lat)||LPUtils.isStringBlankNullUndefined(o.top_right_lng))return console.log("error with floor coords"),void c("Something went wrong. It seems like no valid coordinates have been set up for this floor plan.");if(o.bottom_left_lat=String(o.bottom_left_lat),o.bottom_left_lng=String(o.bottom_left_lng),o.top_right_lat=String(o.top_right_lat),o.top_right_lng=String(o.top_right_lng),n.bottom_left_lat=o.bottom_left_lat,n.bottom_left_lng=o.bottom_left_lng,n.top_right_lat=o.top_right_lat,n.top_right_lng=o.top_right_lng,LPUtils.isNullOrUndefined(e))c("Something went wrong. It seems like there is no building selected.");else if(LPUtils.isNullOrUndefined(e.buid))c("Something went wrong with the selected building's id.");else if(o.buid=e.buid,LPUtils.isNullOrUndefined(n))c("Something went wrong. It seems there is no floor selected.");else if(LPUtils.isNullOrUndefined(n.floor_number))c("Something went wrong. It seems there is no floor number associated with the selected floor.");else{o.floor_number=n.floor_number,o.owner_id=l.owner_id;var t=JSON.stringify(o);if(LPUtils.isNullOrUndefined(i.floor_plan_base64_data)||LPUtils.isStringEmptyNullUndefined(i.floor_plan_base64_data))console.log("no floor plan file");else l.anyAPI.uploadFloorPlan64(t,l.data.floor_plan_base64_data).then(function(e){e.data;a("Successfully uploaded new floor plan.")},function(e){e.data;a("Successfully uploaded new floor plan.")})}}},l.toggleRadioHeatmap=function(){t&&t.getMap()?t.setMap(null):l.showRadioHeatmap()},l.showRadioHeatmapPoi=function(){var e={buid:l.anyService.getBuildingId(),floor:l.anyService.getFloorNumber(),coordinates_lat:l.anyService.selectedPoi.coordinates_lat,coordinates_lon:l.anyService.selectedPoi.coordinates_lon,range:"1"};e.username=l.creds.username,e.password=l.creds.password,l.anyAPI.getRadioHeatmapPoi(e).then(function(e){e.data;var n=[],i=e.data.radioPoints.length;if(i<=0)c("This floor seems not to be WiFi mapped. Download the Anyplace app from the Google Play store to map the floor.");else{for(;i--;){var o=e.data.radioPoints[i];n.push({location:new google.maps.LatLng(o.x,o.y),weight:1}),e.data.radioPoints.splice(i,1)}t&&t.getMap()&&t.setMap(null),(t=new google.maps.visualization.HeatmapLayer({data:n})).setMap(l.gmapService.gmap)}},function(e){e.data;c("Something went wrong while fetching radio heatmap.")})},l.showRadioHeatmap=function(){var e={buid:l.anyService.getBuildingId(),floor:l.anyService.getFloorNumber()};e.username=l.creds.username,e.password=l.creds.password,l.anyAPI.getRadioHeatmap(e).then(function(e){e.data;var n=[],i=e.data.radioPoints.length;if(i<=0)c("This floor seems not to be WiFi mapped. Download the Anyplace app from the Google Play store to map the floor.");else{for(;i--;){var o=e.data.radioPoints[i];n.push({location:new google.maps.LatLng(o.x,o.y),weight:1}),e.data.radioPoints.splice(i,1)}t&&t.getMap()&&t.setMap(null),(t=new google.maps.visualization.HeatmapLayer({data:n})).setMap(l.gmapService.gmap)}},function(e){e.data;c("Something went wrong while fetching radio heatmap.")})}}]),app.controller("PoiController",["$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(u,g,m,f,i){_POIS_IS_ON=_CONNECTIONS_IS_ON=!0,u.anyService=f,u.anyAPI=i,u.myMarkers={},u.myMarkerId=0,u.myPaths={},u.myPathId=0,u.myPois=[],u.myPoisHashT={},u.myConnectionsHashT={},u.edgeMode=!1,u.connectPois={prev:void 0,next:void 0},u.crudTabSelected=1,u.setCrudTabSelected=function(e){u.crudTabSelected=e},u.isCrudTabSelected=function(e){return u.crudTabSelected===e},u.orderByName=function(e){return e.name},u.$on("loggedOff",function(e,n){u.clearConnectionsOnMap(),u.clearPoisOnMap(),u.myPaths={},u.myPathId=0,u.myMarkers={},u.myMarkerId=0,u.myPois=[],u.myPoisHashT={},u.myConnectionsHashT={},u.anyService.setAllPois(u.myPoisHashT),u.anyService.setAllConnection(u.myConnectionsHashT),u.edgeMode=!1,u.connectPois={prev:void 0,next:void 0}}),u.$watch("anyService.selectedBuilding",function(e,n){u.poisTypes=["Disabled Toilets","Elevator","Entrance","Fire Extinguisher","First Aid/AED","Kitchen","Office","Ramp","Room","Security/Guard","Stair","Toilets","Other"],u.poicategories=[{poicat:"Disabled Toilets",poicatPlaceholder:"name",id:"type1",disenable:"false"},{poicat:"Elevator",poicatPlaceholder:"name",id:"type2",disenable:"true"},{poicat:"Entrance",poicatPlaceholder:"name",id:"type3",disenable:"true"},{poicat:"Fire Extinguisher",poicatPlaceholder:"name",id:"type4",disenable:"false"},{poicat:"First Aid/AED",poicatPlaceholder:"name",id:"type5",disenable:"false"},{poicat:"Kitchen",poicatPlaceholder:"name",id:"type6",disenable:"false"},{poicat:"Office",poicatPlaceholder:"name",id:"type7",disenable:"false"},{poicat:"Ramp",poicatPlaceholder:"name",id:"type8",disenable:"false"},{poicat:"Room",poicatPlaceholder:"name",id:"type9",disenable:"false"},{poicat:"Security/Guard",poicatPlaceholder:"name",id:"type10",disenable:"false"},{poicat:"Stair",poicatPlaceholder:"name",id:"type11",disenable:"true"},{poicat:"Toilets",poicatPlaceholder:"name",id:"type12",disenable:"false"},{poicat:"Other",poicatPlaceholder:"name",id:"type13",disenable:"false"}]}),u.$watch("anyService.selectedFloor",function(e,n){null==e||_.isEqual(e,n)?u.anyService.selectedPoi=void 0:u.fetchAllPoisForFloor(e)}),u.$watch("anyService.selectedPoi",function(e,n){if(e&&c(e)&&e&&(m.gmap.panTo(c(e)),e.puid)){var i=u.myPoisHashT[e.puid].marker;i&&i.infowindow&&i.tpl2&&(i.infowindow.setContent(i.tpl2[0]),i.infowindow.open(m.gmap,i)),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastPoi",e.puid)}}),u.add=function(){""!=u.poicategories[u.poicategories.length-1].poicat?u.poicategories.push({poicat:"",poicatPlaceholder:"name",disenable:"false"}):y("Complete the last input to continue!")},u.deletetype=function(e){for(var n=0;n<u.poicategories.length;n++)if(u.poicategories[n].id==e){u.poicategories[n].id="",$("#".id).remove();break}},u.addcategory=function(){var e='"poistype":"'+document.getElementById("poistype").value+'"';function n(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var i="poistypeid_"+(n()+n()+"-"+n()+"-4"+n().substr(0,3)+"-"+n()+"-"+n()+n()+n()).toLowerCase()+"_"+(new Date).getTime();i='"poistypeid":"'+i+'"';var o=u.poicategories.length;if(0!=o){for(var t='"types":[',a=o-1;0<a;a--)""!=u.poicategories[a].poicat&&(t=t+'"'+u.poicategories[a].poicat+'",');var r="{"+e+","+i+","+(t=t+'"'+u.poicategories[0].poicat+'"]')+',"owner_id":"'+u.owner_id+'","access_token":"'+u.gAuth.access_token+'"}';u.anyAPI.addCategory(r).then(function(e){e.data;l("Successfully added category.")},function(e){var n=e.data;y("Something went wrong while adding the category. "+n.message)})}else y("No categories added.")},u.fetchAllPoisTypes=function(t){var e=u.anyService.jsonReq;(e.username=u.creds.username,e.password=u.creds.password,e.owner_id=u.owner_id,e.access_token=u.gAuth.access_token,e.poistypeid=t,e.owner_id)?u.anyAPI.retrievePoisTypes(e).then(function(e){for(var n=e.data.poistypes,i=n.length-1;0<=i;i--)if(n[i].poistypeid==t){var o=n[i].types;break}for(i=o.length-1;0<=i;i--)u.poisTypes[i]=o[i]},function(e){e.data;y("Something went wrong while fetching POIs types")}):y("Could nor authorize user. Please refresh.")},u.onInfoWindowKeyDown=function(e){if(27==e.keyCode&&u.anyService.selectedPoi){var n=u.anyService.selectedPoi;u.myPoisHashT[n.puid]&&u.myPoisHashT[n.puid].marker&&u.myPoisHashT[n.puid].marker.infowindow&&(u.myPoisHashT[n.puid].marker.infowindow.setMap(null),u.anyService.setAllPois(u.myPoisHashT))}},u.clearPoisOnMap=function(){for(var e=0;e<u.myPois.length;e++){var n=u.myPois[e];n&&u.myPoisHashT[n.puid]&&u.myPoisHashT[n.puid].marker&&(u.myPoisHashT[n.puid].marker.setMap(null),delete u.myPoisHashT[n.puid])}u.myPoisHashT={},u.anyService.setAllPois(u.myPoisHashT)},u.clearConnectionsOnMap=function(){if(u.myConnectionsHashT){for(var e in u.myConnectionsHashT)e&&u.myConnectionsHashT.hasOwnProperty(e)&&u.myConnectionsHashT[e]&&u.myConnectionsHashT[e].polyLine&&(u.myConnectionsHashT[e].polyLine.setMap(null),delete u.myConnectionsHashT[e]);u.myConnectionsHashT={},u.anyService.setAllConnection(u.myConnectionsHashT)}},u.fetchConnections=function(){var e,n,i=u.anyService.jsonReq,o=u.anyService.getBuilding();if(LPUtils.isNullOrUndefined(o))y("No building has been selected!");else if(LPUtils.isNullOrUndefined(o.buid))y("No valid building has been selected!");else{e=u.anyService.getBuildingId();var t=u.anyService.getFloor();if(LPUtils.isNullOrUndefined(t))y("No floor has been selected!");else if(LPUtils.isNullOrUndefined(t.floor_number))y("No valid floor has been selected!");else if(n=u.anyService.getFloorNumber(),i.buid=e,i.floor_number=n,(LPUtils.isNullOrUndefined(u.myPois)||LPUtils.isNullOrUndefined(u.myPoisHashT))&&y("Please load the POIs of this floor first."),0!=u.myPois.length){var a=i;u.anyAPI.retrieveConnectionsByBuildingFloor(a).then(function(e){var n=e.data;u.clearConnectionsOnMap();for(var i=n.connections,o={},t=i.length,a=0;a<t;a++)o[i[a].cuid]=i[a];u.myConnectionsHashT=o,u.anyService.setAllConnection(u.myConnectionsHashT),u.drawConnectionsOnMap()},function(e){e.data;y("Something went wrong while loading the POI connections")})}}},u.drawConnectionsOnMap=function(){for(var e in u.myConnectionsHashT)if(u.myConnectionsHashT.hasOwnProperty(e)){var n=u.myConnectionsHashT[e];if(!(n&&n.pois_a&&n.pois_b&&u.myPoisHashT[n.pois_a]&&u.myPoisHashT[n.pois_b]&&u.myPoisHashT[n.pois_a].model&&u.myPoisHashT[n.pois_b].model))continue;var i=[new google.maps.LatLng(u.myPoisHashT[n.pois_a].model.coordinates_lat,u.myPoisHashT[n.pois_a].model.coordinates_lon),new google.maps.LatLng(u.myPoisHashT[n.pois_b].model.coordinates_lat,u.myPoisHashT[n.pois_b].model.coordinates_lon)],o=new google.maps.Polyline({path:i,strokeColor:"#0000FF",strokeOpacity:.5,strokeWeight:4});_CONNECTIONS_IS_ON&&o.setMap(m.gmap),o.model=n,u.myConnectionsHashT[e].polyLine=o,u.anyService.setAllConnection(u.myConnectionsHashT),google.maps.event.addListener(o,"click",function(){u.$apply(A(this)),u.anyService.setAllConnection(u.myConnectionsHashT)})}};function h(e){u.anyService.addAlert("warning",e)}function o(e){var n=e.lat(),i=e.lng(),o=u.anyService.getFloor();if(LPUtils.isNullOrUndefined(o))return y("No selected floor found."),!1;var t=o.top_right_lat,a=o.top_right_lng,r=o.bottom_left_lat,l=o.bottom_left_lng;return t&&a&&r&&l?n<=parseFloat(t)+.001&&i<=parseFloat(a)+.001&&n>=parseFloat(r)-.001&&i>=parseFloat(l)-.001:(y("Floor coordinates not found."),!1)}var d="build/images/edge-connector-icon.png",e="build/images/any-poi-icon.png",c=function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}},y=function(e){u.anyService.addAlert("danger",e)},l=function(e){u.anyService.addAlert("success",e)};u.drawPoisOnMap=function(){var a=new google.maps.InfoWindow({content:"-",maxWidth:500}),e=void 0,n=-1;"undefined"==typeof Storage||!localStorage||LPUtils.isNullOrUndefined(localStorage.getItem("lastBuilding"))||LPUtils.isNullOrUndefined(localStorage.getItem("lastFloor"))||LPUtils.isNullOrUndefined(localStorage.getItem("lastPoi"))||(e=localStorage.getItem("lastPoi"));for(var i=0;i<u.myPois.length;i++){u.myPois[i].pois_type2=u.myPois[i].pois_type;var o,t=u.myPois[i];e&&t.puid===e&&(n=i);var r="-";if(t.pois_type2=t.pois_type,"None"==t.pois_type)o=new google.maps.Marker({position:c(t),draggable:!0,icon:new google.maps.MarkerImage(d,null,null,null,new google.maps.Size(21,21))}),_POIS_IS_ON&&o.setMap(m.gmap),r='<div class="infowindow-scroll-fix" style="text-align: center; width:170px"><fieldset class="form-group" style="display: inline-block; width: 73%;"><button type="submit" class="btn btn-success add-any-button" ng-click="updatePoi(\''+t.puid+'\')"><span class="glyphicon glyphicon-pencil"></span> Update</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi(\''+t.puid+'\')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div>';else{var l=new google.maps.Size(21,32);o=new google.maps.Marker({position:c(t),draggable:!0,icon:new google.maps.MarkerImage("build/images/any-poi-icon.png",null,null,null,l)}),_POIS_IS_ON&&o.setMap(m.gmap),r='<div class="infowindow-scroll-fix" ng-keydown="onInfoWindowKeyDown($event)"><form name="poiForm"><fieldset class="form-group"><textarea ng-model="myPois['+i+'].name" id="poi-name" type="text" class="form-control" placeholder="poi name" tabindex="1" autofocus></textarea></fieldset><fieldset class="form-group"><textarea ng-model="myPois['+i+'].description" id="poi-description" type="text" class="form-control" placeholder="poi description" tabindex="5"></textarea></fieldset><fieldset class="form-group"><select ng-model="myPois['+i+'].pois_type" class="form-control" ng-options="type for type in poisTypes" title="POI Types" tabindex="2"><option value="">Select POI Type</option></select></fieldset class="form-group"><fieldset class="form-group">Or enter your own type:<input ng-model="myPois['+i+'].pois_type2" id="poi-pois_type2" type="text" class="form-control" placeholder="POI Type" tabindex="2"></fieldset><fieldset class="form-group"><input ng-model="myPois['+i+'].is_building_entrance" id="poi-entrance" type="checkbox" tabindex="4"><span> is building entrance?</span></fieldset><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="updatePoi(\''+t.puid+'\')" tabindex="3"><span class="glyphicon glyphicon-pencil"></span> Update</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi(\''+t.puid+'\')" tabindex="6"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form></div>'}var s=g(r)(u);o.tpl2=s,o.model=t,o.infowindow=a,u.myPoisHashT[t.puid].marker=o,u.anyService.setAllPois(u.myPoisHashT),google.maps.event.addListener(o,"click",function(){if(u.edgeMode)if(u.connectPois.prev){if(u.connectPois.prev==this)return u.connectPois.prev=void 0,void("None"===this.model.pois_type?this.setIcon(P()):this.setIcon(S()));"None"===u.connectPois.prev.model.pois_type?u.connectPois.prev.setIcon(P()):u.connectPois.prev.setIcon(S());var o=new google.maps.Polyline({path:[this.position,u.connectPois.prev.position],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.5,strokeWeight:4});o.setMap(m.gmap);var e=u.connectPois.prev.model,n=this.model;if(!e||!n||!e.puid||!n.puid||!e.buid||!n.buid||LPUtils.isNullOrUndefined(e.floor_number)||LPUtils.isNullOrUndefined(n.floor_number))return void y("One or both of the POIs attempted to be connected seem to be be malformed. Please refresh.");var i={username:u.creds.username,password:u.creds.password,owner_id:u.owner_id,pois_a:e.puid,floor_a:e.floor_number,buid_a:e.buid,buid:e.buid,pois_b:n.puid,floor_b:n.floor_number,buid_b:n.buid,is_published:"true",edge_type:"hallway"};o.model=i,u.anyAPI.addConnection(i).then(function(e){var n=e.data.cuid;o.model.cuid=n;var i=o.model;i.polyLine=o,u.myConnectionsHashT[n]=i,u.anyService.setAllConnection(u.myConnectionsHashT),o.setOptions({strokeColor:"#0000FF",strokeOpacity:.5}),google.maps.event.addListener(o,"click",function(){u.$apply(A(this))})},function(e){e.data;y("Something went wrong while attempting to connect the two POIs."),o.setMap(null)}),u.connectPois.prev=void 0}else"None"===(u.connectPois.prev=this).model.pois_type?this.setIcon(p()):this.setIcon(v());else{a.setContent(this.tpl2[0]),a.open(m.gmap,this);var t=this;u.$apply(function(){t.model&&t.model.puid&&(u.anyService.selectedPoi=t.model)})}}),google.maps.event.addListener(o,"dragend",function(e){this.model&&this.model.puid&&u.updatePoiPosition(this)})}0<=n&&(u.anyService.selectedPoi=u.myPois[n]),u.fetchConnections()};var p=function(){return new google.maps.MarkerImage(d,null,null,null,new google.maps.Size(41,41))},P=function(){return new google.maps.MarkerImage(d,null,null,null,new google.maps.Size(21,21))},v=function(){return new google.maps.MarkerImage(e,null,null,null,new google.maps.Size(31,48))},S=function(){return new google.maps.MarkerImage(e,null,null,null,new google.maps.Size(21,32))},A=function(n){if(u.edgeMode)if(n&&n.model&&n.model.cuid){var e=n.model,i=n.model.cuid;if(u.myConnectionsHashT[i]){var o=function(e){return null===e&&(e={}),LPUtils.isNullOrUndefined(e.buid)&&(e.buid=""),LPUtils.isNullOrUndefined(e.is_published)&&(e.is_published=!1),LPUtils.isNullOrUndefined(e.edge_type)&&(e.edge_type=""),LPUtils.isNullOrUndefined(e.pois_a)&&(e.pois_a=""),LPUtils.isNullOrUndefined(e.pois_b)&&(e.pois_b=""),LPUtils.isNullOrUndefined(e.floor_a)&&(e.floor_a=""),LPUtils.isNullOrUndefined(e.floor_b)&&(e.floor_b=""),LPUtils.isNullOrUndefined(e.buid_a)&&(e.buid_a=""),LPUtils.isNullOrUndefined(e.buid_b)&&(e.buid_b=""),e}(e);if(o.username=u.creds.username,o.password=u.creds.password,o.owner_id=u.owner_id,LPUtils.isNullOrUndefined(o.pois_a)||LPUtils.isStringBlankNullUndefined(o.pois_a))y("No valid connection has been selected. Missing POI A.");else if(LPUtils.isNullOrUndefined(o.pois_b)||LPUtils.isStringBlankNullUndefined(o.pois_b))y("No valid connection has been selected. Missing POI B.");else{n.setMap(null);var t=n.model.polyLine;delete n.model.polyLine,u.anyAPI.deleteConnection(o).then(function(e){e.data;delete u.myConnectionsHashT[i],u.anyService.setAllConnection(u.myConnectionsHashT)},function(e){e.data;n.setMap(m.gmap),n.model.polyLine=t,y("Something went wrong. Connection could not be deleted.")})}}else y("The connection attempted to delete does not exist in the system.")}else y("No valid connection selected.");else y('Enable "Edge Mode" so you can delete connections by clicking on them.')};u.fetchAllPoisForFloor=function(e){var n=f.jsonReq;n.buid=f.getBuildingId(),n.floor_number=f.getFloorNumber(),i.retrievePoisByBuildingFloor(n).then(function(e){var n=e.data;u.clearPoisOnMap(),u.myPois=n.pois;for(var i=u.myPois.length-1;0<=i;i--){var o=u.myPois[i].puid;"true"==u.myPois[i].is_building_entrance?u.myPois[i].is_building_entrance=!0:u.myPois[i].is_building_entrance=!1,u.myPois[i].pois_type2=u.myPois[i].pois_type,u.myPoisHashT[o]={},u.myPoisHashT[o].model=u.myPois[i],u.anyService.setAllPois(u.myPoisHashT)}u.drawPoisOnMap()},function(e){e.data;y("Something went wrong while fetching POIs")})};var t=new google.maps.OverlayView;t.draw=function(){},t.setMap(m.gmap),u.addPoi=function(i){if(u.myMarkers[i]&&u.myMarkers[i].marker){0!=u.myMarkers[i].model.pois_type2.localeCompare("")&&(u.myMarkers[i].model.pois_type=u.myMarkers[i].model.pois_type2);var o=u.myMarkers[i].model;if(o.owner_id=u.owner_id,o.coordinates_lat=String(u.myMarkers[i].marker.position.lat()),o.coordinates_lon=String(u.myMarkers[i].marker.position.lng()),o.is_building_entrance=String(o.is_building_entrance),void 0===o.coordinates_lat||null===o.coordinates_lat)return void y("POI has invalid latitude format");if(void 0===o.coordinates_lon||null===o.coordinates_lon)return void y("POI has invalid longitude format");if(!(o.owner_id&&o.name&&o.buid&&o.pois_type)||LPUtils.isNullOrUndefined(o.is_building_entrance)||LPUtils.isNullOrUndefined(o.is_published)||LPUtils.isNullOrUndefined(o.is_door)||LPUtils.isNullOrUndefined(o.floor_name)||LPUtils.isNullOrUndefined(o.floor_number))y("Cannot add new POI. Some required fields are missing.");else{"true"==o.is_building_entrance?o.is_building_entrance="true":o.is_building_entrance="false";var e=o;u.anyAPI.addPois(e).then(function(e){var n=e.data;o.puid=n.puid,"true"==o.is_building_entrance?o.is_building_entrance=!0:o.is_building_entrance=!1,u.myPois.push(o),u.anyService.selectedPoi=u.myPois[u.myPois.length-1],u.myPoisHashT[o.puid]={model:o,marker:u.myMarkers[i].marker},u.anyService.setAllPois(u.myPoisHashT),u.myMarkers[i].model=o,u.myMarkers[i].infowindow&&(u.myMarkers[i].infowindow.close(),u.myMarkers[i].infowindow.setContent(u.myMarkers[i].marker.tpl2[0])),u.myMarkers[i].marker.model=o,"None"==u.myMarkers[i].marker.model.pois_type?u.myMarkers[i].marker.setIcon(P()):u.myMarkers[i].marker.setIcon(S()),google.maps.event.clearListeners(u.myMarkers[i].marker,"click");var a=u.myMarkers[i].infowindow;google.maps.event.addListener(u.myMarkers[i].marker,"click",function(){if(u.edgeMode)if(u.connectPois.prev){if(u.connectPois.prev==this)return u.connectPois.prev=void 0,void("None"===this.model.pois_type?this.setIcon(P()):this.setIcon(S()));"None"===u.connectPois.prev.model.pois_type?u.connectPois.prev.setIcon(P()):u.connectPois.prev.setIcon(S());var o=new google.maps.Polyline({path:[this.position,u.connectPois.prev.position],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:.5,strokeWeight:4});o.setMap(m.gmap);var e=u.connectPois.prev.model,n=this.model;if(!e||!n||!e.puid||!n.puid||!e.buid||!n.buid||LPUtils.isNullOrUndefined(e.floor_number)||LPUtils.isNullOrUndefined(n.floor_number))return void y("One or both of the POIs attempted to be connected seem to be be malformed. Please refresh.");var i={username:u.creds.username,password:u.creds.password,owner_id:u.owner_id,pois_a:e.puid,floor_a:e.floor_number,buid_a:e.buid,buid:e.buid,pois_b:n.puid,floor_b:n.floor_number,buid_b:n.buid,is_published:"true",edge_type:"hallway"};o.model=i,u.anyAPI.addConnection(i).then(function(e){var n=e.data.cuid;o.model.cuid=n;var i=o.model;i.polyLine=o,u.myConnectionsHashT[n]=i,u.anyService.setAllConnection(u.myConnectionsHashT),o.setOptions({strokeColor:"#0000FF",strokeOpacity:.5}),google.maps.event.addListener(o,"click",function(){u.$apply(A(this))})},function(e){e.data;y("Something went wrong while attempting to connect the two POIs."),o.setMap(null)}),u.connectPois.prev=void 0}else"None"===(u.connectPois.prev=this).model.pois_type?this.setIcon(p()):this.setIcon(v());else{a.setContent(this.tpl2[0]),a.open(m.gmap,this);var t=this;u.$apply(function(){t.model&&t.model.puid&&(u.anyService.selectedPoi=t.model)})}}),google.maps.event.addListener(u.myMarkers[i].marker,"dragend",function(e){this.model&&this.model.puid&&u.updatePoiPosition(this)})},function(e){e.data;y("Something went wrong while adding the new POI.")})}}},u.deletePoi=function(e){var n,i=u.myPoisHashT[e];if(!i||!i.model||!i.model.puid){if(!(u.myPoisHashT&&u.myMarkers&&u.myMarkers[e]&&u.myMarkers[e].model&&u.myPoisHashT[u.myMarkers[e].model.puid]))return void y("No valid POI selected to be deleted.");if(!(i=u.myPoisHashT[u.myMarkers[e].model.puid])||!i.model||!i.model.puid)return void y("No valid POI selected to be deleted.")}var o=u.myConnectionsHashT;for(var t in o)if(o.hasOwnProperty(t)&&((n=o[t]).pois_a==i.model.puid||n.pois_b==i.model.puid))return void y("Please delete all the connections attached to this POI first.");var a=i.model;a.username=u.creds.username,a.password=u.creds.password,a.owner_id=u.owner_id;var r=a.puid;!0===a.is_building_entrance||"true"===a.is_building_entrance?a.is_building_entrance="true":a.is_building_entrance="false",u.anyAPI.deletePois(a).then(function(e){e.data;"true"===a.is_building_entrance?a.is_building_entrance=!0:a.is_building_entrance=!1;for(var n=u.myPois,i=n.length,o=0;o<i;o++)if(n[o].puid==r){n.splice(o,1),u.myPoisHashT[r]&&u.myPoisHashT[r].marker&&u.myPoisHashT[r].marker.setMap(null),delete u.myPoisHashT[r],u.anyService.setAllPois(u.myPoisHashT);break}l("Successfully deleted POI.")},function(e){e.data;for(var n=u.myPois,i=n.length,o=0;o<i;o++)if(n[o].puid==r){n.splice(o,1),u.myPoisHashT[r]&&u.myPoisHashT[r].marker&&u.myPoisHashT[r].marker.setMap(null),delete u.myPoisHashT[r],u.anyService.setAllPois(u.myPoisHashT);break}y("Something went wrong while deleting POI.")})},u.updatePoi=function(e){var n=u.myPoisHashT[e];if(!n||!n.model||!n.model.puid){if(!(u.myPoisHashT&&u.myMarkers&&u.myMarkers[e]&&u.myMarkers[e].model&&u.myPoisHashT[u.myMarkers[e].model.puid]))return void y("No valid POI selected to be updated.");if(!(n=u.myPoisHashT[u.myMarkers[e].model.puid])||!n.model||!n.model.puid)return void y("No valid POI selected to be updated.")}0!=n.model.pois_type2.localeCompare("")&&(n.model.pois_type=n.model.pois_type2);var a=n.model;a.username=u.creds.username,a.password=u.creds.password,a.owner_id=u.owner_id;var r=n.marker;if(r){var i=r.position;i&&i.lat()&&i.lng()&&(a.coordinates_lat=String(i.lat()),a.coordinates_lon=String(i.lng()))}a.is_building_entrance?a.is_building_entrance="true":a.is_building_entrance="false",u.anyAPI.updatePois(a).then(function(e){e.data;for(var n in r&&r.infowindow.setMap(null),"true"==a.is_building_entrance?a.is_building_entrance=!0:a.is_building_entrance=!1,u.myConnectionsHashT)if(u.myConnectionsHashT.hasOwnProperty(n)&&(u.myConnectionsHashT[n].pois_a==a.puid||u.myConnectionsHashT[n].pois_b==a.puid)){var i=u.myConnectionsHashT[n].pois_a,o=u.myConnectionsHashT[n].pois_b,t=[new google.maps.LatLng(u.myPoisHashT[i].model.coordinates_lat,u.myPoisHashT[i].model.coordinates_lon),new google.maps.LatLng(u.myPoisHashT[o].model.coordinates_lat,u.myPoisHashT[o].model.coordinates_lon)];u.myConnectionsHashT[n].polyLine.setPath(t),u.anyService.setAllConnection(u.myConnectionsHashT),u.anyService.setAllPois(u.myPoisHashT)}},function(e){e.data;y("Something went wrong while updating POI. Please refresh and try again.")})},u.updatePoiPosition=function(a){var r;a&&a.model&&(r=a.model),r.username=u.creds.username,r.password=u.creds.password,r.owner_id=u.owner_id;var e=a.position;e&&e.lat()&&e.lng()&&(r.coordinates_lat=String(e.lat()),r.coordinates_lon=String(e.lng())),r.is_building_entrance?r.is_building_entrance="true":r.is_building_entrance="false",u.anyAPI.updatePois(r).then(function(e){e.data;for(var n in"true"==r.is_building_entrance||!0===r.is_building_entrance?r.is_building_entrance=!0:r.is_building_entrance=!1,u.myConnectionsHashT)if(u.myConnectionsHashT.hasOwnProperty(n)&&(u.myConnectionsHashT[n].pois_a==a.model.puid||u.myConnectionsHashT[n].pois_b==a.model.puid)){var i=u.myConnectionsHashT[n].pois_a,o=u.myConnectionsHashT[n].pois_b,t=[new google.maps.LatLng(u.myPoisHashT[i].model.coordinates_lat,u.myPoisHashT[i].model.coordinates_lon),new google.maps.LatLng(u.myPoisHashT[o].model.coordinates_lat,u.myPoisHashT[o].model.coordinates_lon)];u.myConnectionsHashT[n].polyLine.setPath(t),u.anyService.setAllConnection(u.myConnectionsHashT),u.anyService.setAllPois(u.myPoisHashT)}},function(e){e.data;y("Something went wrong while moving POI.")})},u.removeMarker=function(e){u.myMarkers[e]?(u.myMarkers[e].marker.setMap(null),delete u.myMarkers[e]):y("It seems that the marker to be deleted does not exist.")},u.placeMarker=function(e,n,i,o){var t=new google.maps.Marker({position:e,map:m.gmap,icon:new google.maps.MarkerImage(n,null,null,null,i),draggable:!0});if(null!==f.getBuildingId()&&void 0!==f.getBuildingId()){var a=new google.maps.InfoWindow({content:"-",maxWidth:500});u.$apply(function(){t.myId=u.myMarkerId,u.myMarkers[t.myId]={},u.myMarkers[t.myId].model={buid:f.getBuildingId(),floor_number:f.getFloorNumber(),floor_name:f.getFloorName(),is_door:"false",is_building_entrance:"false",is_published:"true",description:"connector"===o?"Connector":"",name:"connector"===o?"Connector":"",pois_type:"connector"===o?"None":"",pois_type2:"connector"===o?"None":"",url:"-",image:"url_to_pois_image"},u.myMarkers[t.myId].marker=t,u.myMarkers[t.myId].model.pois_type2=u.myMarkers[t.myId].model.pois_type,u.myMarkerId++});var r='<div class="infowindow-scroll-fix" ng-keydown="onInfoWindowKeyDown($event)"><form name="poiForm"><fieldset class="form-group"><input ng-model="myMarkers['+t.myId+'].model.name" id="poi-name" type="text" class="form-control" placeholder="poi name" tabindex="1" autofocus/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+t.myId+'].model.description" id="poi-description" type="text" class="form-control" placeholder="poi description" tabindex="5"></textarea></fieldset><fieldset class="form-group"><select ng-model="myMarkers['+t.myId+'].model.pois_type" class="form-control" ng-options="type for type in poisTypes" title="POI Types" tabindex="2"><option value="">Select POI Type</option></select></fieldset class="form-group"><fieldset class="form-group">Or ender your one type name:<input ng-model="myMarkers['+t.myId+'].model.pois_type2" id="poi-pois_type2" type="text" class="form-control" placeholder="POI Type" tabindex="2"></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+t.myId+'].model.is_building_entrance" id="poi-entrance" type="checkbox" tabindex="4"><span> is building entrance?</span></fieldset><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addPoi('+t.myId+')" tabindex="3"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempPoi('+t.myId+')" tabindex="6"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form></div>',l='<div class="infowindow-scroll-fix" ng-keydown="onInfoWindowKeyDown($event)"><form name="poiForm"><fieldset class="form-group"><input ng-model="myMarkers['+t.myId+'].model.name" id="poi-name" type="text" class="form-control" placeholder="poi name" tabindex="1" autofocus/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+t.myId+'].model.description" id="poi-description" type="text" class="form-control" placeholder="poi description" tabindex="5"></textarea></fieldset><fieldset class="form-group"><select ng-model="myMarkers['+t.myId+'].model.pois_type" class="form-control" ng-options="type for type in poisTypes" title="POI Types" tabindex="2"><option value="">Select POI Type</option></select></fieldset class="form-group"><fieldset class="form-group">Or ender your one type name:<input ng-model="myMarkers['+t.myId+'].model.pois_type" id="poi-pois_type2" type="text" class="form-control" placeholder="POI Type" tabindex="2"></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+t.myId+'].model.is_building_entrance" id="poi-entrance" type="checkbox" tabindex="4"><span> is building entrance?</span></fieldset><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="updatePoi('+t.myId+')" tabindex="3"><span class="glyphicon glyphicon-pencil"></span> Update</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi('+t.myId+')" tabindex="6"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form></div>',s='<div class="infowindow-scroll-fix" style="text-align: center; width:170px"><div style="margin-bottom: 5px">POI Connector</div><fieldset class="form-group" style="display: inline-block; width: 73%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addPoi('+t.myId+')"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempPoi('+t.myId+')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div>',d='<div class="infowindow-scroll-fix" style="text-align: center; width:170px"><div style="margin-bottom: 5px">POI Connector</div><fieldset class="form-group"><button type="submit" class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deletePoi('+t.myId+')"><span class="glyphicon glyphicon-remove"></span> Remove</button></fieldset></div>';if("poi"==o){var c=g(r)(u);t.tpl2=g(l)(u),a.setContent(c[0]),a.open(m.gmap,t)}else if("connector"==o){var p=g(s)(u);t.tpl2=g(d)(u),a.setContent(p[0]),u.addPoi(t.myId)}u.$apply(u.myMarkers[t.myId].infowindow=a),google.maps.event.addListener(t,"click",function(){u.edgeMode&&u.$apply(h("Only submitted objects can be connected together.")),a.open(m.gmap,t)})}else y("It seems there is no building selected. Please refresh.")},u.deleteTempPoi=function(e){u.myMarkers&&u.myMarkers[e].marker?u.myMarkers[e].marker.setMap(null):y("No valid POI marker to delete found.")},u.toggleEdgeMode=function(){u.edgeMode=!u.edgeMode,u.edgeMode||(u.connectPois.prev=void 0)},$("#draggable-poi").draggable({helper:"clone",stop:function(e){var n=new google.maps.Point(e.pageX,e.pageY),i=t.getProjection().fromContainerPixelToLatLng(n);o(i)?u.placeMarker(i,"build/images/poi-icon.png",new google.maps.Size(21,32),"poi"):u.$apply(h("The marker was placed too far away from the selected building."))}}),$("#draggable-connector").draggable({helper:"clone",stop:function(e){var n=new google.maps.Point(e.pageX,e.pageY),i=t.getProjection().fromContainerPixelToLatLng(n);o(i)?u.placeMarker(i,d,new google.maps.Size(21,21),"connector"):u.$apply(h("The marker was placed too far away from the selected building."))}})}]),app.controller("SelectFloorController",["$scope","AnyplaceService","GMapService","AnyplaceAPIService",function(i,e,n,o){i.anyService=e,i.anyAPI=o,i.gmapService=n,i.xFloors=[],i.$watch("anyService.availableFloors",function(e,n){e&&(i.xFloors=[],i.xFloors=i.anyService.availableFloors)});function t(e){i.anyService.addAlert("danger",e)}i.orderByFloorNo=function(e){return!e||LPUtils.isNullOrUndefined(e.floor_number)?0:parseInt(e.floor_number)},i.floorUp=function(){var e;changedfloor=!0;for(var n=0;n<i.xFloors.length;n++)if(e=n+1,i.xFloors[n].floor_number===i.anyService.selectedFloor.floor_number)return e<i.xFloors.length?void(i.anyService.selectedFloor=i.xFloors[e]):void 0;t("Floor not found.")},i.floorDown=function(){var e;changedfloor=!0;for(var n=0;n<i.xFloors.length;n++)if(e=n-1,i.xFloors[n].floor_number===i.anyService.selectedFloor.floor_number)return 0<=e?void(i.anyService.selectedFloor=i.xFloors[e]):void 0;t("Floor not found.")}}]);var heatmap,heatmapAcc,drawingManager;heatMap=[],heatMap_Location=[],APmap=[],heatmapFingerprints=[],userTimeData=[],fingerPrintsMap=[],connectionsMap={},POIsMap={},_HEATMAP_RSS_IS_ON=!1,_HEATMAP_Localization=!1,_APs_IS_ON=!1,_FINGERPRINTS_IS_ON=!1,_DELETE_FINGERPRINTS_IS_ON=!1,_HEATMAP_F_IS_ON=!1,_CONNECTIONS_IS_ON=!1,_POIS_IS_ON=!1,changedfloor=!1,colorBarGreenClicked=!1,colorBarYellowClicked=!1,colorBarOrangeClicked=!1,colorBarPurpleClicked=!1,colorBarRedClicked=!1,levelOfZoom=1;app.controller("BuildingController",["$cookieStore","$scope","$compile","GMapService","AnyplaceService","AnyplaceAPIService",function(e,m,l,d,s,g){function n(){return(65536*(1+Math.random())|0).toString(16).substring(1)}m.myMarkers={},m.myMarkerId=0,m.laship=33,m.loship=33,m.moveShip=0,m.ShipInterval,m.gmapService=d,m.anyService=s,m.anyAPI=g,m.example9model=[],m.example9data=[],m.example9settings={enableSearch:!0,scrollable:!0},m.example9modeledit=[],m.example9dataedit=[],m.example9settingsedit={enableSearch:!0,scrollable:!0},m.myBuildings=[],m.myShips=[],m.myBuildingsHashT={},m.myCampus=[],m.old_campus=[],m.crudTabSelected=1,m.fileToUpload="",m.logfile="",m.poisTypes={},m.catTypes={},m.pageLoad=!1,m.crudTabSelected=1,m.setCrudTabSelected=function(e){if(m.crudTabSelected=e,m.anyService.getBuilding()){var n=m.myBuildingsHashT[m.anyService.getBuildingId()];if(n){var i=n.marker;i&&(2===e?i.setDraggable(!0):i.setDraggable(!1))}}else h("No building is selected.")},m.isCrudTabSelected=function(e){return m.crudTabSelected===e},m.$on("loggedIn",function(e,n){m.fetchAllBuildings(),m.fetchAllCampus()}),m.$on("loggedOff",function(e,n){t(),m.myMarkers={},m.myMarkerId=0,m.myBuildings=[],m.myBuildingsHashT={}});var i=(n()+n()+"-"+n()+"-4"+n().substr(0,3)+"-"+n()+"-"+n()+n()+n()).toLowerCase(),o=new Date;document.getElementById("CampusID").value="cuid_"+i+"_"+o.getTime(),$("#input-logo").change(function(e){var n=new FileReader;n.onload=function(e){(new Image).src=e.target.result},n.readAsDataURL(e.target.files[0])}),m.setLogoPlan=function(e){var n={is_published:"true",cuid:e,logo:String(m.newFloorNumber),description:String(m.newFloorNumber),floor_number:String(m.newFloorNumber)};m.myFloors[m.myFloorId]=n,m.myFloorId++,canvasOverlay.drawBoundingCanvas();var i=canvasOverlay.bottom_left_coords,o=canvasOverlay.top_right_coords;m.data.floor_plan_coords.bottom_left_lat=i.lat(),m.data.floor_plan_coords.bottom_left_lng=i.lng(),m.data.floor_plan_coords.top_right_lat=o.lat(),m.data.floor_plan_coords.top_right_lng=o.lng(),m.data.floor_plan_coords.zoom=d.gmap.getZoom()+"";var t=canvasOverlay.getCanvas().toDataURL("image/png");m.data.floor_plan_base64_data=t;var a=new google.maps.LatLngBounds(new google.maps.LatLng(i.lat(),i.lng()),new google.maps.LatLng(o.lat(),o.lng()));if(m.data.floor_plan_groundOverlay=new USGSOverlay(a,t,d.gmap),canvasOverlay.setMap(null),$("#input-floor-plan").prop("disabled",!1),m.isCanvasOverlayActive=!1,_floorNoExists(m.newFloorNumber))for(var r=0;r<m.xFloors.length;r++){var l=m.xFloors[r];if(!LPUtils.isNullOrUndefined(l)&&l.floor_number===String(m.newFloorNumber)){m.uploadFloorPlanBase64(m.anyService.selectedBuilding,l,m.data);break}}else m.addFloorObject(n,m.anyService.selectedBuilding,m.data)},m.$watch("anyService.selectedBuilding",function(e,n){e&&e.coordinates_lat&&e.coordinates_lon&&(m.gmapService.gmap.panTo(c(e)),m.gmapService.gmap.setZoom(19),"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastBuilding",e.buid)),m.poisTypes=["Disabled Toilets","Elevator","Entrance","Fire Extinguisher","First Aid/AED","Kitchen","Office","Ramp","Room","Security/Guard","Stair","Toilets","Other"]}),m.$watch("anyService.selectedCampus",function(e,n){e&&e.cuid&&"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("lastCampus",e.cuid)});function f(e){m.anyService.addAlert("success",e)}var t=function(){for(var e in m.myBuildingsHashT)m.myBuildingsHashT.hasOwnProperty(e)&&(m.myBuildingsHashT[e].marker.setMap(null),delete m.myBuildingsHashT[e])},h=function(e){m.anyService.addAlert("danger",e)},c=function(e){if(e&&e.coordinates_lat&&e.coordinates_lon)return{lat:parseFloat(e.coordinates_lat),lng:parseFloat(e.coordinates_lon)}};m.fetchAllPoisTypes=function(){var e={};(e.username=m.creds.username,e.password=m.creds.password,e.access_token=m.gAuth.access_token,e.owner_id=m.owner_id,e.owner_id)?m.anyAPI.retrievePoisTypes(e).then(function(e){var n=e.data;m.catTypes=n.poistypes},function(e){e.data;h("Something went wrong while fetching POIs types")}):h("Could nor authorize user. Please refresh.1")},m.fetchAllBuildings=function(){var e={};(e.username=m.creds.username,e.password=m.creds.password,e.owner_id=m.owner_id,e.owner_id)?m.anyAPI.allBuildings(e).then(function(e){var n=e.data;for(var i in m.myBuildings=[],m.myShips=[],n.buildings){"ship"==n.buildings[i].buid.split("_",1)?m.myShips.push(n.buildings[i]):m.myBuildings.push(n.buildings[i])}var t=new google.maps.InfoWindow({content:"-",maxWidth:500}),o=-1,a=void 0;"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastBuilding")&&(a=localStorage.getItem("lastBuilding"));for(i=0;i<n.buildings.length;i++){var r=n.buildings[i];if(m.example9data[i]={id:r.buid,label:r.name},m.example9dataedit[i]={id:r.buid,label:r.name},a&&a===r.buid&&(o=i),"true"===r.is_published||1==r.is_published?r.is_published=!0:r.is_published=!1,"ship"==r.buid.split("_",1))var l=new google.maps.Marker({position:c(r),map:d.gmap,icon:new google.maps.MarkerImage("build/images/ship_icon.png",null,null,null,new google.maps.Size(54,54)),draggable:!1}),s='<div class="infowindow-scroll-fix"><h5>Ship:</h5><span>'+r.name+'</span><h5>Description:</h5><textarea class="infowindow-text-area"  rows="3" readonly>'+r.description+"</textarea></div>";else l=new google.maps.Marker({position:c(r),map:d.gmap,icon:new google.maps.MarkerImage("build/images/building-icon.png",null,null,null,new google.maps.Size(54,54)),draggable:!1}),s='<div class="infowindow-scroll-fix"><h5>Building:</h5><span>'+r.name+'</span><h5>Description:</h5><textarea class="infowindow-text-area"  rows="3" readonly>'+r.description+"</textarea></div>";l.infoContent=s,l.building=r,m.myBuildingsHashT[r.buid]={marker:l,model:r},google.maps.event.addListener(l,"click",function(){t.setContent(this.infoContent),t.open(d.gmap,this);m.anyService.selectedBuilding=this.building;var i=this.building.buid;if("ship"==i.split("_",1)){function e(){var e=m.myBuildingsHashT[i].marker;m.laship=parseFloat(m.laship)+1e-4,m.loship=parseFloat(m.loship)+1e-4;var n={lat:parseFloat(m.laship),lng:parseFloat(m.loship)};e.setPosition(n),console.log("its work")}if(0==m.moveShip?(m.moveShip=1,console.log("stop")):m.moveShip=0,0==m.moveShip){clearInterval(m.ShipInterval);var n=m.myBuildingsHashT[i];console.log(m.myBuildingsHashT[i]),console.log(n.model.coordinates_lat);var o={lat:parseFloat(n.model.coordinates_lat),lng:parseFloat(n.model.coordinates_lon)};console.log(o),n.marker.setPosition(o)}else e(),m.ShipInterval=setInterval(function(){e()},1e4)}}),console.log("dfgg ")}0<=o?m.anyService.selectedBuilding=m.myBuildings[o]:m.myBuildings[0]&&(m.anyService.selectedBuilding=m.myBuildings[0])},function(e){e.data;h("Something went wrong while fetching buildings.")}):h("Could nor authorize user. Please refresh.")},m.addNewBuilding=function(i){if(m.myMarkers[i]&&m.myMarkers[i].marker){var e,o,t=m.myMarkers[i].model;if(t.owner_id=m.owner_id,!t.owner_id)return void h("Could not authorize user. Please refresh.");if(t.coordinates_lat=String(m.myMarkers[i].marker.position.lat()),t.coordinates_lon=String(m.myMarkers[i].marker.position.lng()),void 0===t.coordinates_lat||null===t.coordinates_lat)return void h("Invalid building latitude.");if(void 0===t.coordinates_lon||null===t.coordinates_lon)return void h("Invalid building longitude.");if(!0===t.is_published?t.is_published="true":t.is_published="false",t.description||(t.description="-"),t.owner_id&&t.name&&t.description&&t.is_published&&t.url&&t.address)o=0==shipselect?(e=m.anyAPI.addBuilding(t),1):(e=m.anyAPI.addShip(t),0),e.then(function(e){var n=e.data;console.log("new buid: "+n.buid),t.buid=n.buid,"true"===t.is_published||1==t.is_published?t.is_published=!0:t.is_published=!1,0==shipselect?(m.myBuildings.push(t),m.anyService.selectedBuilding=m.myBuildings[m.myBuildings.length-1]):m.myShips.push(t),m.myMarkers[i].marker.setDraggable(!1),m.myBuildingsHashT[t.buid]={marker:m.myMarkers[i].marker,model:t},m.myMarkers[i].infowindow&&(m.myMarkers[i].infowindow.setContent(m.myMarkers[i].marker.tpl2[0]),m.myMarkers[i].infowindow.close()),f(o?"Building added successfully.":"Ship added successfully.")},function(e){var n=e.data;h("Something went wrong while adding the building. "+n.message)});else h("Some required fields are missing.")}},m.deleteBuilding=function(){var t=m.anyService.getBuilding(),e=m.creds;m.owner_id?(e.owner_id=m.owner_id,console.log(e.owner_id),t&&t.buid?(e.buid=t.buid,m.anyAPI.deleteBuilding(e).then(function(e){e.data;console.log("building deleted: ",t),m.myBuildingsHashT[t.buid].marker.setMap(null),delete m.myBuildingsHashT[t.buid];for(var n=m.myBuildings,i=n.length,o=0;o<i;o++)if(n[o].buid==t.buid){n.splice(o,1);break}m.myBuildings&&0<m.myBuildings.length&&(m.anyService.selectedBuilding=m.myBuildings[0]),m.setCrudTabSelected(1),f("Successfully deleted building.")},function(e){e.data;h("Something went wrong. It's likely that everything related to the building is deleted but please refresh to make sure or try again.")})):h("No building selected for deletion.")):h("Could not identify user. Please refresh and sign in again.")},m.deleteRadiomaps=function(){var e={buid:m.anyService.getBuildingId(),floor:m.anyService.getFloorNumber()};e.username=m.creds.username,e.password=m.creds.password,m.anyAPI.deleteRadiomaps(e).then(function(e){f("Successfully Delete floor radiomap")},function(e){e.data;h("Something went wrong.The file is not exist ")})},m.updateBuilding=function(){var n=m.anyService.getBuilding();if(LPUtils.isNullOrUndefined(n)||LPUtils.isNullOrUndefined(n.buid))h("No building selected found.");else{var e={};if(e=m.creds,m.owner_id){e.owner_id=m.owner_id,e.buid=n.buid,n.description&&(e.description=n.description),n.name&&(e.name=n.name),!0===n.is_published||"true"==n.is_published?e.is_published="true":e.is_published="false",n.bucode&&(e.bucode=n.bucode);var i=m.myBuildingsHashT[n.buid].marker;if(i){var o=i.position;o&&o.lat()&&o.lng()&&(e.coordinates_lat=String(o.lat()),e.coordinates_lon=String(o.lng()))}m.anyAPI.updateBuilding(e).then(function(e){e.data;"true"===n.is_published||1==n.is_published?n.is_published=!0:n.is_published=!1,f("Successfully updated building.")},function(e){var n=e.data;h("Something went wrong while updating building. "+n.message)})}else h("Could not identify user. Please refresh and sign in again.")}},m.fetchAllCampus=function(){var e={};(e.username=m.creds.username,e.password=m.creds.password,e.owner_id=m.owner_id,m.myCampus=[],e.owner_id)?m.anyAPI.allCampus(e).then(function(e){var n=e.data;m.myCampus=n.buildingsets;var i=-1,o=void 0;"undefined"!=typeof Storage&&localStorage&&localStorage.getItem("lastCampus")&&(o=localStorage.getItem("lastCampus"));for(var t=0;t<m.myCampus.length;t++){var a=m.myCampus[t];o&&o===a.cuid&&(i=t)}0<=i?m.anyService.selectedCampus=m.myCampus[i]:m.myCampus[0]&&(m.anyService.selectedCampus=m.myCampus[0])},function(e){e.data;h("Something went wrong while fetching buildings.")}):h("Could nor authorize user. Please refresh.")},m.updateCampus=function(){var e=m.anyService.getCampus();if(LPUtils.isNullOrUndefined(e)||LPUtils.isNullOrUndefined(e.cuid))h("No campus selected found.");else{var n={};if(n=m.creds,m.owner_id){n.owner_id=m.owner_id,n.cuid=e.cuid,e.description&&(n.description=e.description),e.name&&(n.name=e.name),e.newcuid&&(n.newcuid=e.newcuid);var i=m.example9modeledit.length;if(0!=i){for(var o='"buids":[',t=i-1;0<t;t--)o=o+'"'+m.example9modeledit[t].id+'",';o=o+'"'+m.example9modeledit[0].id+'"]',n.greeklish=document.getElementById("Greeklish-OnOffedit").checked,n.buids=o,m.anyAPI.updateCampus(n).then(function(e){e.data;document.getElementById("CampusIDeditnew").value="",f("Successfully updated campus.")},function(e){var n=e.data;h("Something went wrong while updating campus. "+n.message)})}else h("No buildings selected.")}else h("Could not identify user. Please refresh and sign in again.")}},m.deleteCampus=function(){var t=m.anyService.getCampus(),e=m.creds;m.owner_id?(e.owner_id=m.owner_id,t&&t.cuid?(e.cuid=t.cuid,m.anyAPI.deleteCampus(e).then(function(e){e.data;console.log("campus deleted: ",t);for(var n=m.myCampus,i=n.length,o=0;o<i;o++)if(n[o].cuid==t.cuid){n.splice(o,1);break}m.myCampus&&0<m.myCampus.length?m.anyService.selectedCampus=m.myCampus[0]:0==m.myCampus.length&&(m.anyService.selectedCampus=void 0),m.setCrudTabSelected(1),f("Successfully deleted campus.")},function(e){e.data;h("Something went wrong. It's likely that everything related to the campus is deleted but please refresh to make sure or try again.")})):h("No Campus selected for deletion.")):h("Could not identify user. Please refresh and sign in again.")},m.addCampus=function(){var e='"name":"'+document.getElementById("CampusName").value+'"';0==document.getElementById("CampusDescription").value.localeCompare("")&&(document.getElementById("CampusDescription").value="-");var n='"description":"'+(n=document.getElementById("CampusDescription")).value+'"',i='"cuid":"'+(i=document.getElementById("CampusID")).value+'"',o=document.getElementById("Greeklish-OnOff").checked;o='"greeklish":"'+o+'"';var t=m.example9model.length;if(0!=t){for(var r='"buids":[',a=t-1;0<a;a--)r=r+'"'+m.example9model[a].id+'",';var l="{"+o+","+(r=r+'"'+m.example9model[0].id+'"]')+","+i+","+n+","+e+',"owner_id":"'+m.owner_id+'","access_token":"'+m.gAuth.access_token+'"}';m.anyAPI.addBuildingSet(l).then(function(e){var n=e.data,i={};function o(){return(65536*(1+Math.random())|0).toString(16).substring(1)}i.name=document.getElementById("CampusName").value,i.buids=r.buids,i.description=document.getElementById("CampusDescription").value,i.cuid=n.cuid,m.myCampus.push(i),m.anyService.selectedCampus=m.myCampus[m.myCampus.length-1],f("Successfully added campus.");var t=(o()+o()+"-"+o()+"-4"+o().substr(0,3)+"-"+o()+"-"+o()+o()+o()).toLowerCase(),a=new Date;document.getElementById("CampusID").value="cuid_"+t+"_"+a.getTime()},function(e){var n=e.data;h("Something went wrong while adding the building. "+n.message)})}else h("No buildings selected.")};var a=new google.maps.OverlayView;if(a.draw=function(){},a.setMap(d.gmap),$("#draggable-building").draggable({helper:"clone",stop:function(e){var n=new google.maps.Point(e.pageX,e.pageY),i=a.getProjection().fromContainerPixelToLatLng(n);m.placeMarker(i),shipselect=0}}),$("#draggable-ship").draggable({helper:"clone",stop:function(e){var n=new google.maps.Point(e.pageX,e.pageY),i=a.getProjection().fromContainerPixelToLatLng(n);m.placeMarkership(i),shipselect=1}}),m.placeMarkership=function(e){var n=m.myMarkers[m.myMarkerId-1];if(n&&n.marker&&n.marker.getMap()&&n.marker.getDraggable())console.log("there is a building pending, please add 1 at a time");else{var i=new google.maps.Marker({position:e,map:d.gmap,icon:"build/images/ship_icon.png",draggable:!0}),o=new google.maps.InfoWindow({content:"-",maxWidth:500});m.$apply(function(){i.myId=m.myMarkerId,m.myMarkers[i.myId]={},m.myMarkers[i.myId].model={description:"",name:void 0,is_published:!0,address:"-",url:"-",bucode:""},m.myMarkers[i.myId].marker=i,m.myMarkers[i.myId].infowindow=o,m.myMarkerId++});var t='<form name="buildingForm" class="infowindow-scroll-fix"><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.bucode" id="building-code" type="text" class="form-control" placeholder="Building Code (Optional)"/></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.name" id="building-name" type="text" class="form-control" placeholder="Building Name *"/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+i.myId+'].model.description" id="building-description" type="text" class="form-control" placeholder="Building Description (Optional)"></textarea></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.is_published" id="building-published" type="checkbox"><span> Make building public to view.</span></fieldset><fieldset class="form-group"></fieldset class="form-group"><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addNewBuilding('+i.myId+')"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempBuilding('+i.myId+')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form>',a='<div class="infowindow-scroll-fix"><h5 style="margin: 0">Building:</h5><span>{{myMarkers['+i.myId+'].model.name}}</span><h5 style="margin: 8px 0 0 0">Description:</h5><span>{{myMarkers['+i.myId+"].model.description}}</span></div>",r=l(t)(m);i.tpl2=l(a)(m),o.setContent(r[0]),o.open(d.gmap,i),google.maps.event.addListener(i,"click",function(){o.getMap()||o.open(d.gmap,i)})}},m.placeMarker=function(e){var n=m.myMarkers[m.myMarkerId-1];if(n&&n.marker&&n.marker.getMap()&&n.marker.getDraggable())console.log("there is a building pending, please add 1 at a time");else{var i=new google.maps.Marker({position:e,map:d.gmap,icon:"build/images/building-icon.png",draggable:!0}),o=new google.maps.InfoWindow({content:"-",maxWidth:500});m.$apply(function(){i.myId=m.myMarkerId,m.myMarkers[i.myId]={},m.myMarkers[i.myId].model={description:"",name:void 0,is_published:!0,address:"-",url:"-",bucode:""},m.myMarkers[i.myId].marker=i,m.myMarkers[i.myId].infowindow=o,m.myMarkerId++});var t='<form name="buildingForm" class="infowindow-scroll-fix"><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.bucode" id="building-code" type="text" class="form-control" placeholder="Building Code (Optional)"/></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.name" id="building-name" type="text" class="form-control" placeholder="Building Name *"/></fieldset><fieldset class="form-group"><textarea ng-model="myMarkers['+i.myId+'].model.description" id="building-description" type="text" class="form-control" placeholder="Building Description (Optional)"></textarea></fieldset><fieldset class="form-group"><input ng-model="myMarkers['+i.myId+'].model.is_published" id="building-published" type="checkbox"><span> Make building public to view.</span></fieldset><fieldset class="form-group"></fieldset class="form-group"><div style="text-align: center;"><fieldset class="form-group" style="display: inline-block; width: 75%;"><button type="submit" class="btn btn-success add-any-button" ng-click="addNewBuilding('+i.myId+')"><span class="glyphicon glyphicon-plus"></span> Add</button></fieldset><fieldset class="form-group" style="display: inline-block;width: 23%;"><button class="btn btn-danger add-any-button" style="margin-left:2px" ng-click="deleteTempBuilding('+i.myId+')"><span class="glyphicon glyphicon-remove"></span></button></fieldset></div></form>',a='<div class="infowindow-scroll-fix"><h5 style="margin: 0">Building:</h5><span>{{myMarkers['+i.myId+'].model.name}}</span><h5 style="margin: 8px 0 0 0">Description:</h5><span>{{myMarkers['+i.myId+"].model.description}}</span></div>",r=l(t)(m);i.tpl2=l(a)(m),o.setContent(r[0]),o.open(d.gmap,i),google.maps.event.addListener(i,"click",function(){o.getMap()||o.open(d.gmap,i)})}},m.deleteTempBuilding=function(e){var n=m.myMarkers[e];n&&n.marker&&n.marker.setMap(null)},m.exportBuildingToJson=function(){var c={building:{floors:[]}},p=m.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(p))h("No building selected");else{c.building.buid=p.buid,c.building.name=p.name,c.building.description=p.description,c.building.coordinates_lat=p.coordinates_lat,c.building.coordinates_lon=p.coordinates_lon;var e=s.jsonReq;e.buid=p.buid;var u=0;g.allBuildingFloors(e).then(function(e){var n,s=e.data.floors,d=[];if(s)for(var i=0;i<s.length;i++)n={buid:p.buid,floor_number:s[i].floor_number},g.retrievePoisByBuildingFloor(n).then(function(e){var n=e.data.pois;if(n){for(var i=[],o=n[0].floor_number,t=0;t<n.length;t++){var a=n[t];if("None"!=a.pois_type){if(a.overwrite)var r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:a.overwrite};else r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:"false"};i.push(r)}}if(d.push({floor_number:o,pois:i}),++u===s.length){c.building.floors=d,f("Successfully exported "+p.name+" to JSON.");var l=new Blob([JSON.stringify(c,null,4)],{type:"text/plain;charset=utf-8"});saveAs(l,p.name.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt")}}},function(e){var n=e.data;console.log(n.message)})},function(e){console.log(e.data.message)})}},m.exportCampusToJson=function(){var e={campus:{buids:[]}},n=m.anyService.selectedCampus;if(LPUtils.isNullOrUndefined(n))h("No campus selected");else{e.campus.name=n.name,e.campus.description=n.description,e.campus.buids=n.buids,f("Successfully exported "+n.name+" to JSON.");var i=new Blob([JSON.stringify(e,null,4)],{type:"text/plain;charset=utf-8"});saveAs(i,n.name.toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt")}},document.getElementById("file-input").addEventListener("change",function(e){var n=e.target.files[0];if(n){var i=new FileReader;i.onload=function(e){var n=e.target.result;m.fileToUpload=n},i.readAsText(n)}},!1),m.anyService.downloadlogfile=!1,m.importBuildingFromJson=function(){var e,n,i=m.anyService.progress=0,o=0;""==m.fileToUpload&&h("Something went wrong no file selected");var t=JSON.parse(m.fileToUpload);for(e=0;e<t.building.floors.length;e++)for(n=0;n<t.building.floors[e].pois.length;n++)"true"==t.building.floors[e].pois[n].overwrite&&i++;for(0==i&&h("Something went wrong no pois to update"),e=0;e<t.building.floors.length;e++)for(n=0;n<t.building.floors[e].pois.length;n++)"true"==t.building.floors[e].pois[n].overwrite&&(o++,m.updatePoifromFile(t.building.floors[e].pois[n].puid,t.building.floors[e].pois[n].coordinates_lat,t.building.floors[e].pois[n].coordinates_lon,t.building.floors[e].pois[n].name,t.building.floors[e].pois[n].description,t.building.floors[e].pois[n].pois_type,t.building.floors[e].pois[n].overwrite,t.building.buid,e,n,i,o,t.building.name))},m.allpois={},m.pois={},m.importBuildingFromExcel=function(e){m.anyService.progress=0;var n=document.getElementById("my_file_input").files[0];m.fileToUpload=n.name;var i=new FileReader;i.onload=function(e){var n=e.target.result,i=XLS.CFB.read(n,{type:"binary"}),o=XLS.parse_xlscfb(i);o.SheetNames.forEach(function(e){var n=XLS.utils.sheet_to_row_object_array(o.Sheets[e]);m.uploadloop(0,n,"")})},i.readAsBinaryString(n)},m.uploadloop=function(e,n,i){for(var o=e;o<n.length;o++){if(i!=n[o].buid&&null!=n[o].buid)return m.pois={},i=n[o].buid,void m.fetchAllPoisForBuilding(n[o].buid,n,o,i);var t="";null!=n[o].des3&&""!=n[o].des3&&null!=n[o].des3?null!=n[o].des4&&""!=n[o].des4&&null!=n[o].des4?t=t+n[o].des3+" "+n[o].des4:t+=n[o].des3:null!=n[o].des4&&""!=n[o].des4&&null!=n[o].des4&&(t+=n[o].des4),null!=n[o].des1&&""!=n[o].des1&&null!=n[o].des1&&(""!=t?t=t+"\n"+n[o].des1:t+=n[o].des1),null!=n[o].des2&&""!=n[o].des2&&null!=n[o].des2&&(""!=t?t=t+"\n"+n[o].des2:t+=n[o].des2),m.anyService.progress=o/(n.length-1)*100,n.length-1==0&&(m.anyService.progress=100),m.pois[n[o].name]?m.updatePoifromExcel(m.pois[n[o].name].puid,m.pois[n[o].name].coordinates_lat,m.pois[n[o].name].coordinates_lon,m.pois[n[o].name].is_building_entrance,n[o].name,t,m.pois[n[o].name].pois_type,m.pois[n[o].name].overwrite,m.pois[n[o].name].buid,""):m.updatePoifromExcel("","","","",n[o].name,t,"","","","")}},m.fetchAllPoisForBuilding=function(e,t,a,r){var n=s.jsonReq;n.buid=e,g.retrievePoisByBuilding(n).then(function(e){var n=e.data;m.myPois=n.pois;for(var i=m.myPois.length-1;0<=i;i--){var o=m.myPois[i].name;m.pois[o]=m.myPois[i]}m.uploadloop(a,t,r)},function(e){e.data;h("Something went wrong while fetching POIs")})},m.logfile={pois:[]},m.updatePoifromExcel=function(i,e,n,o,t,a,r,l,s,d){var c={};c.username=m.creds.username,c.password=m.creds.password,c.owner_id=m.owner_id,c.coordinates_lat=e,c.coordinates_lon=n,c.is_building_entrance=o,c.name=t,c.puid=i,c.description=a,c.pois_type=r,c.overwrite="false",c.buid=s,m.anyAPI.updatePois(c).then(function(e){e.data;if(100==m.anyService.progress)if(m.anyService.downloadlogfile){m.anyService.downloadlogfile=!1,f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(m.fileToUpload+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),setTimeout(function(){m.anyService.progress=void 0},2500)}else f("Successfully updated POIs."),setTimeout(function(){m.anyService.progress=void 0,location.reload()},2500)},function(e){e.data;if(m.logfile.pois.push({name:t,puid:i,description:a,status:"Something went wrong while updating POI."}),m.anyService.downloadlogfile=!0,100==m.anyService.progress){m.anyService.downloadlogfile=!1,f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(m.fileToUpload+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),m.logfile.pois=[],setTimeout(function(){m.anyService.progress=void 0},2500)}})},m.updatePoifromFile=function(i,e,n,o,t,a,r,l,s,d,c,p,u){var g={};g.username=m.creds.username,g.password=m.creds.password,g.owner_id=m.owner_id,g.coordinates_lat=e,g.coordinates_lon=n,g.name=o,g.puid=i,g.description=t,g.pois_type=a,g.overwrite="false",g.buid=l,m.anyAPI.updatePois(g).then(function(e){e.data;if(m.anyService.progress=p/c*100,100==m.anyService.progress)if(m.anyService.downloadlogfile){f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(u+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),setTimeout(function(){m.anyService.progress=void 0},2500)}else f("Successfully updated POIs."),setTimeout(function(){m.anyService.progress=void 0,location.reload()},2500)},function(e){e.data;if(m.logfile.pois.push({name:o,puid:i,description:t,status:"Something went wrong while updating POI."}),m.anyService.downloadlogfile=!0,m.anyService.progress=p/c*100,100==m.anyService.progress)if(m.anyService.downloadlogfile){f("Successfully updated POIs.A log file will be downloaded");var n=new Blob([JSON.stringify(m.logfile,null,4)],{type:"text/plain;charset=utf-8"});saveAs(n,(u+"-log_file").toLowerCase().replace(/[^a-zA-Z0-9]+/g,"-")+".txt"),m.logfile.pois=[],setTimeout(function(){m.anyService.progress=void 0},2500)}else f("Successfully updated POIs."),setTimeout(function(){m.anyService.progress=void 0,location.reload()},2500)})},m.Poisresult={building:{floors:[]}},m.Connectionsresult={building:{}},m.zip=new JSZip,m.DownloadBackup=function(){var o=m.anyService.selectedBuilding,l=[],e=s.jsonReq;e.buid=o.buid,m.anyService.progress=0,g.allBuildingFloors(e).then(function(e){l=e.data.floors;for(var a="",n=0;n<l.length;n++)a=0==n?l[n].floor_number:a+" "+l[n].floor_number;m.anyService.progress=10;var r=o.buid,i=s.jsonReq;g.downloadFloorPlanAll(i,r,a).then(function(e){for(var n=e.data,i=m.zip.folder("floor_plans"),o=0;o<n.all_floors.length;o++)""!=n.all_floors[o]&&i.file(l[o].floor_number+".png",n.all_floors[o],{base64:!0});m.anyService.progress=25;var t=s.jsonReq;t.buid=r,t.floor=a,g.getRadioByBuildingFloorAll(t).then(function(e){var n=e.data,i=m.zip.folder("radiomaps");if(n.rss_log_files)for(var o=0;o<n.rss_log_files.length;o++)i.file(l[o].floor_number+"-radiomap.txt",n.rss_log_files[o]);m.anyService.progress=70,m.exportPoisBuildingToJson()},function(e){})},function(e){})},function(e){console.log(e.data.message),h("Something went wrong while fetching all floors")})},m.exportPoisBuildingToJson=function(){var o=m.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(o))h("No building selected");else{m.Poisresult.building.buid=o.buid,m.Poisresult.building.name=o.name,m.Poisresult.building.description=o.description,m.Poisresult.building.coordinates_lat=o.coordinates_lat,m.Poisresult.building.coordinates_lon=o.coordinates_lon;var e=s.jsonReq;e.buid=o.buid;var d=0;g.allBuildingFloors(e).then(function(e){var n,l=e.data.floors,s=[];if(m.anyService.progress=80,l)for(var i=0;i<l.length;i++)n={buid:o.buid,floor_number:l[i].floor_number},g.retrievePoisByBuildingFloor(n).then(function(e){var n=e.data.pois;if(n){var i=[];if(null!=n[0]){for(var o=n[0].floor_number,t=0;t<n.length;t++){var a=n[t];if("None"!=a.pois_type){if(a.overwrite)var r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:a.overwrite};else r={name:a.name,description:a.description,puid:a.puid,pois_type:a.pois_type,coordinates_lat:a.coordinates_lat,coordinates_lon:a.coordinates_lon,overwrite:"false"};"true"==a.is_building_entrance?r.is_building_entrance="true":r.is_building_entrance="false",i.push(r)}}s.push({floor_number:o,pois:i})}++d===l.length&&(m.Poisresult.building.floors=s,m.zip.file("allpois.json",JSON.stringify(m.Poisresult,null,4)),m.anyService.progress=90,m.exportConnectionBuildingToJson())}},function(e){var n=e.data;console.log(n.message)})},function(e){console.log(e.data.message)})}},m.exportConnectionBuildingToJson=function(){var d=m.anyService.selectedBuilding;if(LPUtils.isNullOrUndefined(d))h("No building selected");else{m.Connectionsresult.building.buid=d.buid,m.Connectionsresult.building.name=d.name,m.Connectionsresult.building.description=d.description,m.Connectionsresult.building.coordinates_lat=d.coordinates_lat,m.Connectionsresult.building.coordinates_lon=d.coordinates_lon;var e=s.jsonReq;e.buid=d.buid;var c=0;g.allBuildingFloors(e).then(function(e){var n,l=e.data.floors,s=[];if(l)for(var i=0;i<l.length;i++)n={buid:d.buid,floor_number:l[i].floor_number},g.retrieveConnectionsByBuildingFloor(n).then(function(e){m.anyService.progress=100;var n=e.data.connections;if(n){var i=[];if(null!=n[0]){for(var o=n[0].floor_a,t=0;t<n.length;t++){var a=n[t],r={name:a.name,description:a.description,cuid:a.puid,weight:a.weight,pois_a:a.pois_a,pois_b:a.pois_b,floor_a:a.floor_a,floor_b:a.floor_b,is_published:a.is_published,buid_a:a.buid_a,buid_b:a.buid_b};i.push(r)}s.push({floor_number:o,connections:i})}++c===l.length&&(m.Connectionsresult.building.floors=s,m.zip.file("allconnections.json",JSON.stringify(m.Connectionsresult,null,4)),m.zip.generateAsync({type:"blob"}).then(function(e){saveAs(e,d.buid+".zip")}),m.anyService.progress=void 0)}},function(e){var n=e.data;console.log(n.message)})},function(e){console.log(e.data.message)})}},$("#dismiss").on("click",function(){"undefined"!=typeof Storage&&localStorage&&localStorage.setItem("dismissClicked","YES")}),"YES"!==localStorage.getItem("dismissClicked")){window.onload=function(){$("#myModal_Welcome").modal("show")}}}]);